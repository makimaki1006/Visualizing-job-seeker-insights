# V3 CSV完全仕様

**バージョン**: 2.2 (MAP統合版)
**最終更新**: 2025年11月22日
**対応フェーズ**: Phase 1, 2, 3, 6, 7, 8, 10, 12, 13, 14
**総ファイル数**: 43ファイル
**品質スコア**: 82.86/100 (EXCELLENT)

このドキュメントでは、V3 CSV生成エンジン（run_complete_v2_perfect.py）が出力する全43ファイルの完全仕様を説明します。

---

## 📋 概要

### 出力先
- **ベースディレクトリ**: `data/output_v2/`
- **Phase別サブディレクトリ**: `phase1/`, `phase2/`, `phase3/`, `phase6/`, `phase7/`, `phase8/`, `phase10/`, `phase12/`, `phase13/`, `phase14/`

### ファイル命名規則
- **データファイル**: `Phase{Phase}_{AnalysisType}.csv`（例: `Phase1_Applicants.csv`）
- **品質レポート**: `P{Phase}_QualityReport.csv`、`P{Phase}_QualityReport_Descriptive.csv`、`P{Phase}_QualityReport_Inferential.csv`

### エンコーディング
- **統一**: UTF-8 with BOM（`utf-8-sig`）
- **目的**: Excel等での文字化け防止

---

## 🔬 Phase 1: 基礎集計（6ファイル）

**目的**: 求職者の基本情報と希望勤務地の集計。

**利用目的**: **観察的記述**（事実の記述、集計値・件数・割合の提示）

**品質検証モード**: Descriptive

### 1. Applicants.csv

**目的**: 申請者基本情報

**カラム構造**:
```csv
ID,性別,年齢,年齢バケット,居住地_都道府県,居住地_市区町村
```

| カラム名 | データ型 | 説明 | サンプル値 | 備考 |
|---------|---------|------|-----------|------|
| ID | 文字列 | 一意の申請者ID | `ID_1`, `ID_2` | 連番 |
| 性別 | 文字列 | 性別 | `女性`, `男性` | 正規化済み |
| 年齢 | 整数 | 年齢 | `50`, `28` | - |
| 年齢バケット | 文字列 | 年齢区分 | `50代`, `20代` | 10歳刻み |
| 居住地_都道府県 | 文字列 | 都道府県名 | `京都府`, `栃木県` | 正規化済み |
| 居住地_市区町村 | 文字列 | 市区町村名 | `京都市西京区`, `宇都宮市` | 区レベル保持 |

**サンプルデータ**:
```csv
ID,性別,年齢,年齢バケット,居住地_都道府県,居住地_市区町村
ID_1,女性,50,50代,栃木県,宇都宮市
ID_2,男性,28,20代,京都府,京都市西京区
```

**行数**: 可変（入力データに依存、数千〜数万行想定）

---

### 2. DesiredWork.csv

**目的**: 希望勤務地詳細（複数希望地対応）

**カラム構造**:
```csv
ID,希望勤務地_都道府県,希望勤務地_市区町村,優先順位
```

| カラム名 | データ型 | 説明 | サンプル値 | 備考 |
|---------|---------|------|-----------|------|
| ID | 文字列 | 申請者ID | `ID_1` | Applicants.csvと紐付け |
| 希望勤務地_都道府県 | 文字列 | 希望都道府県 | `京都府` | - |
| 希望勤務地_市区町村 | 文字列 | 希望市区町村 | `京都市西京区` | - |
| 優先順位 | 整数 | 希望順位 | `1`, `2`, `3` | 1が最優先 |

**行数**: 可変（1人あたり複数行、数万行想定）

---

### 3. AggDesired.csv

**目的**: 希望勤務地集計データ

**カラム構造**:
```csv
都道府県,市区町村,キー,カウント
```

| カラム名 | データ型 | 説明 | サンプル値 | 備考 |
|---------|---------|------|-----------|------|
| 都道府県 | 文字列 | 都道府県名 | `京都府` | - |
| 市区町村 | 文字列 | 市区町村名 | `京都市西京区` | - |
| キー | 文字列 | 統合キー | `京都府京都市西京区` | 都道府県+市区町村 |
| カウント | 整数 | 希望者数 | `15`, `3` | - |

**行数**: 数百〜数千行（市区町村数に依存）

---

### 4. MapMetrics.csv

**目的**: 地図表示用データ（座標付き）

**カラム構造**:
```csv
都道府県,市区町村,latitude,longitude,カウント
```

| カラム名 | データ型 | 説明 | サンプル値 | 備考 |
|---------|---------|------|-----------|------|
| 都道府県 | 文字列 | 都道府県名 | `京都府` | - |
| 市区町村 | 文字列 | 市区町村名 | `京都市西京区` | - |
| latitude | 浮動小数点 | 緯度 | `35.0116` | Google Maps API取得 |
| longitude | 浮動小数点 | 経度 | `135.6895` | Google Maps API取得 |
| カウント | 整数 | 希望者数 | `15` | AggDesired.csvと同値 |

**座標範囲**:
- 緯度: 24.0〜46.0（日本国内）
- 経度: 122.0〜154.0（日本国内）

**行数**: AggDesired.csvと同数

---

### 5. P1_QualityReport.csv

**目的**: Phase 1データ品質レポート

**カラム構造**:
```csv
カラム名,欠損数,欠損率,ユニーク数,信頼性レベル,警告
```

---

### 6. P1_QualityReport_Descriptive.csv

**目的**: Phase 1観察的記述用品質レポート

**カラム構造**:
```csv
カラム名,信頼性レベル,警告
```

**信頼性レベル**:
- `DESCRIPTIVE`: 観察的記述用（件数明記すれば問題なし）

---

## 📊 Phase 2: 統計分析（3ファイル）

**目的**: カイ二乗検定、ANOVA検定による統計的有意性検証。

**利用目的**: **推論的考察**（傾向分析、関係性の推論）

**品質検証モード**: Inferential

### 7. ChiSquareTests.csv

**目的**: カイ二乗検定結果

**カラム構造**:
```csv
変数1,変数2,カイ二乗値,P値,有意性,サンプル数
```

| カラム名 | データ型 | 説明 | サンプル値 |
|---------|---------|------|-----------|
| 変数1 | 文字列 | 第1変数名 | `性別` |
| 変数2 | 文字列 | 第2変数名 | `年齢バケット` |
| カイ二乗値 | 浮動小数点 | χ²統計量 | `12.345` |
| P値 | 浮動小数点 | 有意確率 | `0.023` |
| 有意性 | 文字列 | 有意性判定 | `有意`, `非有意` |
| サンプル数 | 整数 | 分析対象数 | `500` |

**有意性判定基準**: P値 < 0.05で「有意」

---

### 8. ANOVATests.csv

**目的**: ANOVA検定結果

**カラム構造**:
```csv
従属変数,独立変数,F値,P値,有意性,グループ数
```

---

### 9. P2_QualityReport_Inferential.csv

**目的**: Phase 2推論的考察用品質レポート

**信頼性レベル**:
- `HIGH`: 推論用に十分なサンプル数
- `MEDIUM`: 推論用に若干不足
- `LOW`: 推論用に不足（傾向分析注意）
- `CRITICAL`: 推論用最小グループ不足（推論不可）

---

## 👥 Phase 3: ペルソナ分析（4ファイル）

**目的**: 求職者のペルソナ分類と特徴分析。

**利用目的**: **推論的考察**（ペルソナ間の関係性推論）

**品質検証モード**: Inferential

### 10. PersonaSummary.csv

**目的**: ペルソナサマリー

**カラム構造**:
```csv
ペルソナID,ペルソナ名,特徴,人数,割合
```

---

### 11. PersonaDetails.csv

**目的**: ペルソナ詳細

**カラム構造**:
```csv
ペルソナID,ID,性別,年齢,居住地_都道府県,居住地_市区町村,希望勤務地数,平均通勤距離
```

---

### 12. PersonaSummaryByMunicipality.csv

**目的**: 市町村別ペルソナ分析

**カラム構造**:
```csv
都道府県,市区町村,ペルソナID,ペルソナ名,人数,割合
```

---

### 13. P3_QualityReport_Inferential.csv

**目的**: Phase 3推論的考察用品質レポート

---

## 🌊 Phase 6: フロー分析（5ファイル）

**目的**: 居住地→希望勤務地の人材フローを分析。

**利用目的**: **推論的考察**（地域間移動パターンの推論）

**品質検証モード**: Inferential

### 14. MunicipalityFlowEdges.csv

**目的**: 自治体間フローエッジ

**カラム構造**:
```csv
source,target,flow_count,source_prefecture,target_prefecture
```

| カラム名 | データ型 | 説明 | サンプル値 |
|---------|---------|------|-----------|
| source | 文字列 | 出発地（市区町村） | `京都市西京区` |
| target | 文字列 | 目的地（市区町村） | `宇都宮市` |
| flow_count | 整数 | フロー人数 | `15` |
| source_prefecture | 文字列 | 出発地都道府県 | `京都府` |
| target_prefecture | 文字列 | 目的地都道府県 | `栃木県` |

---

### 15. AggregatedFlowEdges.csv

**目的**: 集約フローエッジ（都道府県レベル）

**カラム構造**:
```csv
source,target,flow_count
```

---

### 16. MunicipalityFlowNodes.csv

**目的**: 自治体間フローノード

**カラム構造**:
```csv
municipality,prefecture,latitude,longitude,inflow,outflow,net_flow
```

---

### 17. ProximityAnalysis.csv

**目的**: 移動パターン分析

**カラム構造**:
```csv
ID,居住地_都道府県,居住地_市区町村,希望勤務地_都道府県,希望勤務地_市区町村,移動タイプ,距離_km
```

**移動タイプ**:
- `同一市区町村`: 同じ市区町村内
- `同一都道府県`: 同じ都道府県内（異なる市区町村）
- `都道府県間移動`: 異なる都道府県

---

### 18. P6_QualityReport_Inferential.csv

**目的**: Phase 6推論的考察用品質レポート

---

## 🎓 Phase 7: 高度分析（6ファイル）

**目的**: 人材供給密度、資格分布、年齢×性別クロス分析等。

**利用目的**: **推論的考察**（属性間の関係性推論）

**品質検証モード**: Inferential

### 19. SupplyDensityMap.csv

**目的**: 人材供給密度マップ

**カラム構造**:
```csv
都道府県,市区町村,latitude,longitude,supply_count,density_rank
```

| カラム名 | データ型 | 説明 | サンプル値 |
|---------|---------|------|-----------|
| 都道府県 | 文字列 | 都道府県名 | `京都府` |
| 市区町村 | 文字列 | 市区町村名 | `京都市西京区` |
| latitude | 浮動小数点 | 緯度 | `35.0116` |
| longitude | 浮動小数点 | 経度 | `135.6895` |
| supply_count | 整数 | 供給人数 | `150` |
| density_rank | 文字列 | 密度ランク | `高`, `中`, `低` |

---

### 20. QualificationDistribution.csv

**目的**: 資格別人材分布

**カラム構造**:
```csv
資格名,保有者数,割合,平均年齢
```

---

### 21. AgeGenderCrossAnalysis.csv

**目的**: 年齢層×性別クロス分析

**カラム構造**:
```csv
年齢バケット,男性,女性,合計
```

---

### 22. MobilityScore.csv

**目的**: 移動許容度スコアリング

**カラム構造**:
```csv
ID,希望勤務地数,平均通勤距離,最大通勤距離,移動許容度,mobility_score
```

**mobility_score**:
- 計算式: `希望勤務地数 × (平均通勤距離 / 10)`
- スコアが高いほど移動許容度が高い

---

### 23. DetailedPersonaProfile.csv

**目的**: ペルソナ詳細プロファイル

**カラム構造**:
```csv
ペルソナID,ID,性別,年齢,居住地_都道府県,居住地_市区町村,希望勤務地数,平均通勤距離,主要資格,就業状況
```

---

### 24. P7_QualityReport_Inferential.csv

**目的**: Phase 7推論的考察用品質レポート

---

## 💼 Phase 8: キャリア・学歴分析（6ファイル）

**目的**: キャリア分布、学歴×年齢のクロス分析。

**利用目的**: **推論的考察**（キャリアパスの傾向分析）

**品質検証モード**: Inferential

### 25. CareerDistribution.csv

**目的**: キャリア分布

**カラム構造**:
```csv
キャリア,人数,割合
```

**キャリア正規化**:
- 正規化前: `介護福祉士`, `ケアマネ`, `ケアマネージャー`, `ケアマネ（介護支援専門員）`
- 正規化後: `介護福祉士`, `ケアマネージャー`（表記ゆれ統一）

---

### 26. CareerAgeCross.csv

**目的**: キャリア×年齢クロス集計

**カラム構造**:
```csv
キャリア,20代,30代,40代,50代,60代以上,合計
```

---

### 27. CareerAgeCross_Matrix.csv

**目的**: キャリア×年齢マトリクス（ヒートマップ用）

**カラム構造**: CareerAgeCross.csvと同じだが、フォーマットが異なる（ピボットテーブル形式）

---

### 28. GraduationYearDistribution.csv

**目的**: 卒業年分布

**カラム構造**:
```csv
卒業年,人数,割合
```

---

### 29. P8_QualityReport.csv

**目的**: Phase 8データ品質レポート

---

### 30. P8_QualityReport_Inferential.csv

**目的**: Phase 8推論的考察用品質レポート

---

## 🔥 Phase 10: 転職意欲・緊急度分析（10ファイル）

**目的**: 転職意欲・緊急度の分布と属性間の関係性分析。

**利用目的**: **推論的考察**（転職意欲パターンの推論）

**品質検証モード**: Inferential

### 31. UrgencyDistribution.csv

**目的**: 緊急度分布

**カラム構造**:
```csv
緊急度レベル,人数,割合
```

**緊急度レベル**:
- `高`: 即座に転職したい
- `中`: 3ヶ月以内に転職したい
- `低`: 良い求人があれば転職したい

---

### 32. UrgencyAgeCross.csv

**目的**: 緊急度×年齢クロス集計

**カラム構造**:
```csv
緊急度レベル,20代,30代,40代,50代,60代以上,合計
```

---

### 33. UrgencyAgeCross_Matrix.csv

**目的**: 緊急度×年齢マトリクス（ヒートマップ用）

---

### 34. UrgencyEmploymentCross.csv

**目的**: 緊急度×就業状況クロス集計

**カラム構造**:
```csv
緊急度レベル,就業中,非就業,合計
```

---

### 35. UrgencyEmploymentCross_Matrix.csv

**目的**: 緊急度×就業状況マトリクス

---

### 36. UrgencyByMunicipality.csv

**目的**: 市区町村別緊急度

**カラム構造**:
```csv
都道府県,市区町村,緊急度レベル,人数,割合
```

---

### 37. UrgencyAgeCross_ByMunicipality.csv

**目的**: 市区町村別緊急度×年齢クロス集計

**カラム構造**:
```csv
都道府県,市区町村,緊急度レベル,20代,30代,40代,50代,60代以上,合計
```

---

### 38. UrgencyEmploymentCross_ByMunicipality.csv

**目的**: 市区町村別緊急度×就業状況クロス集計

**カラム構造**:
```csv
都道府県,市区町村,緊急度レベル,就業中,非就業,合計
```

---

### 39. P10_QualityReport.csv

**目的**: Phase 10データ品質レポート

---

### 40. P10_QualityReport_Inferential.csv

**目的**: Phase 10推論的考察用品質レポート

---

## ⚖️ Phase 12: 需給ギャップ分析（2ファイル）

**目的**: 求人数と求職者数のギャップを分析。

**利用目的**: **観察的記述**（需給バランスの事実記述）

**品質検証モード**: Descriptive

### 41. Phase12_SupplyDemandGap.csv

**目的**: 需給ギャップ分析

**カラム構造**:
```csv
都道府県,市区町村,latitude,longitude,supply_count,demand_count,gap,gap_ratio
```

| カラム名 | データ型 | 説明 | サンプル値 |
|---------|---------|------|-----------|
| supply_count | 整数 | 求職者数 | `150` |
| demand_count | 整数 | 求人数 | `200` |
| gap | 整数 | ギャップ | `-50`（負は供給不足） |
| gap_ratio | 浮動小数点 | ギャップ比率 | `0.75`（supply/demand） |

---

### 42. P12_QualityReport_Descriptive.csv

**目的**: Phase 12観察的記述用品質レポート

---

## 💎 Phase 13: 希少性スコア（2ファイル）

**目的**: 希少人材のスコアリング。

**利用目的**: **観察的記述**（希少性の事実記述）

**品質検証モード**: Descriptive

---

## 🏆 Phase 14: 競合分析（2ファイル）

**目的**: 人材プロファイル分析。

**利用目的**: **観察的記述**（競合状況の事実記述）

**品質検証モード**: Descriptive

---

## 📈 統合ファイル（3ファイル）

### 43. OverallQualityReport.csv

**目的**: 全Phase統合品質レポート

**カラム構造**:
```csv
Phase,総合スコア,ステータス,ファイル数,警告数
```

**総合スコア**:
- 80-100: EXCELLENT
- 60-79: GOOD
- 40-59: ACCEPTABLE
- 0-39: POOR

---

### geocache.json

**目的**: ジオコーディングキャッシュ

**形式**: JSON

**構造**:
```json
{
  "京都府京都市西京区": {
    "lat": 35.0116,
    "lng": 135.6895
  }
}
```

**件数**: 1,901件

---

### OverallQualityReport_Inferential.csv

**目的**: 全Phase推論的考察用統合品質レポート

---

## 🎯 データ品質検証システム

### 2つの検証モード

#### 1. 観察的記述モード（Descriptive）

**用途**: 事実の記述（集計値・件数・割合の提示）

**特徴**:
- ✅ サンプル数1件でも事実として提示可能
- ✅ 件数を明記すれば問題なし
- ❌ 「傾向」「差異」の言葉は使用不可

**適用Phase**: Phase 1, 12, 13, 14

---

#### 2. 推論的考察モード（Inferential）

**用途**: 傾向分析（クロス集計・関係性の推論）

**特徴**:
- ⚠️ 最小サンプル数必要（グループ30件以上、全体100件以上推奨）
- ⚠️ サンプル数不足は警告表示
- ✅ 「傾向が見られる」「関係性がある」使用可能

**適用Phase**: Phase 2, 3, 6, 7, 8, 10

---

### 品質スコア算出方法

```
品質スコア = (HIGH数 × 100 + MEDIUM数 × 70 + LOW数 × 40 + CRITICAL数 × 0) / 総カラム数
```

**信頼性レベル**:
- `HIGH`: 推論用に十分なサンプル数（グループ30件以上）
- `MEDIUM`: 推論用に若干不足（グループ15-29件）
- `LOW`: 推論用に不足（グループ5-14件、傾向分析注意）
- `CRITICAL`: 推論用最小グループ不足（グループ5件未満、推論不可）

---

## 🚀 V3実行例

```bash
cd "C:\Users\fuji1\OneDrive\Pythonスクリプト保管\job_medley_project\python_scripts"
python run_complete_v2_perfect.py
```

**実行内容**:
1. GUIでCSVファイル選択（results_*.csv）
2. データ正規化（表記ゆれ対応）
3. Phase 1-3, 6-8, 10, 12-14のCSVファイル生成
4. 品質検証レポート自動生成（Descriptive + Inferential）
5. geocache.json更新（新しい市区町村があれば追加）

**出力先**: `data/output_v2/phase*/`

**所要時間**: 約5-10分（入力データ規模に依存）

---

## 📊 データ利用ガイドライン

### 観察的記述（Descriptive）

**使用可能な表現**:
- 「京都府○○村: 1件」
- 「○○市の求職者数: 150人」
- 「20代の割合: 30%」

**使用不可の表現**:
- ❌ 「○○村（n=1）は20代が多い傾向」（推論的考察）
- ❌ 「○○市は供給過多の傾向がある」（推論的考察）

---

### 推論的考察（Inferential）

**使用可能な表現**（サンプル数十分な場合）:
- 「20代は30代より移動許容度が高い傾向がある」
- 「就業中の人は緊急度が低い傾向が見られる」

**使用不可の表現**（サンプル数不足の場合）:
- ❌ 「○○村（n=3）は20代が多い傾向」
- ❌ 「n=5のデータから関係性が推測できる」

---

## 🔗 関連ドキュメント

- **[README.md](../README.md)** - プロジェクトメインドキュメント
- **[PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md)** - プロジェクト構造詳細
- **[DATA_USAGE_GUIDELINES.md](DATA_USAGE_GUIDELINES.md)** - データ利用ガイドライン
- **[DATA_SPECIFICATION.md](DATA_SPECIFICATION.md)** - データ仕様書（旧版）

---

**作成**: Claude Code
**日付**: 2025年11月22日
**プロジェクト**: ジョブメドレー求職者データ分析 V3 CSV拡張
