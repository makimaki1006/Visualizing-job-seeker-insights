# インタラクティブクロス集計機能：ユーザー受け入れテスト（UAT）ガイド

**バージョン**: 1.0
**作成日**: 2025年11月3日
**対象**: プロジェクト管理者・ビジネスユーザー
**所要時間**: 約60分

---

## 目次

1. [UATの目的](#1-uatの目的)
2. [事前準備](#2-事前準備)
3. [テストシナリオ](#3-テストシナリオ)
4. [データ検証方法](#4-データ検証方法)
5. [問題報告方法](#5-問題報告方法)
6. [承認基準](#6-承認基準)

---

## 1. UATの目的

### 1.1 目的

実際のジョブメドレーデータを使用して、以下を確認します:

1. **機能要件の充足**: 要求された機能が正しく実装されているか
2. **データ精度**: 集計結果が正確であるか
3. **ユーザビリティ**: 使いやすく、直感的な操作ができるか
4. **パフォーマンス**: 実データで十分な速度が出るか
5. **業務適合性**: 実際の業務で使用できるか

### 1.2 成功基準

以下のすべてを満たすことがUAT合格の条件です:

- [ ] 全テストシナリオが成功する
- [ ] データ精度が95%以上
- [ ] 操作が2秒以内に完了する
- [ ] ビジネスユーザーが独力で操作できる
- [ ] 実業務で使用可能と判断される

---

## 2. 事前準備

### 2.1 必要なもの

| 項目 | 詳細 |
|------|------|
| **GASプロジェクトURL** | デプロイ済みのURL |
| **ブラウザ** | Google Chrome推奨（最新版） |
| **実データ** | ジョブメドレーの最新求職者データ |
| **検証用スプレッドシート** | 集計結果を検証するための参照データ |
| **所要時間** | 60分（集中して実施） |

### 2.2 事前確認

以下を確認してから開始してください:

- [ ] GASプロジェクトがデプロイされている
- [ ] 最新のデータが読み込まれている
- [ ] ブラウザのキャッシュをクリアした
- [ ] ブラウザのポップアップブロックを解除した

---

## 3. テストシナリオ

### シナリオ1: 年齢層×性別のクロス集計（基本操作）

**テスト目的**: 最も基本的なクロス集計が正しく動作するか確認

#### 操作手順

1. GASプロジェクトを開く
2. 地域を選択（例: 京都市）
3. 「クロス分析」タブをクリック
4. デフォルトで表示されるテーブルを確認

#### 期待結果

| 確認項目 | 期待される結果 | 実際の結果 | ステータス |
|---------|--------------|-----------|-----------|
| タイトル | 「📊 インタラクティブクロス集計」が表示される | | ⬜ |
| 統計情報 | 「選択地域: 京都市 \| データ件数: N件」が表示される | | ⬜ |
| テーブル | 年齢層×性別のクロス集計テーブルが表示される | | ⬜ |
| 行ラベル | 年齢層（20-29歳、30-39歳...）が表示される | | ⬜ |
| 列ラベル | 性別（男性、女性、不明）が表示される | | ⬜ |
| 合計行 | 各列の合計が正しい | | ⬜ |
| 合計列 | 各行の合計が正しい | | ⬜ |
| 総合計 | 合計行の総合計 = 合計列の総合計 | | ⬜ |
| ヒートマップ | セルに背景色が適用されている | | ⬜ |
| Google Charts | 棒グラフが表示されている | | ⬜ |

#### データ検証

**手動検証方法**:

1. Googleスプレッドシートで同じデータを開く
2. ピボットテーブルを作成:
   - 行: 年齢層
   - 列: 性別
   - 値: カウント
3. GASの集計結果と比較

**検証ポイント**:
- [ ] 各セルのカウントが一致する
- [ ] 合計値が一致する
- [ ] 「不明」の件数が正しい

---

### シナリオ2: 資格バイネームのクロス集計（主要機能）

**テスト目的**: 資格を「あり/なし」で集計する機能が正しく動作するか確認

#### 操作手順

1. X軸ドロップダウンを開く
2. 「資格（バイネーム）」セクションから「介護福祉士」を選択
3. Y軸ドロップダウンで「年齢層」を選択
4. 「🔍 クロス集計を実行」ボタンをクリック

#### 期待結果

| 確認項目 | 期待される結果 | 実際の結果 | ステータス |
|---------|--------------|-----------|-----------|
| 列ラベル | 「あり」と「なし」の2列が表示される | | ⬜ |
| 行ラベル | 年齢層が表示される | | ⬜ |
| 合計値 | 「あり」+ 「なし」= 申請者総数 | | ⬜ |
| 処理時間 | 2秒以内に完了する | | ⬜ |

#### データ検証

**手動検証方法**:

1. Googleスプレッドシートで`qualifications`カラムを確認
2. `=COUNTIF(qualifications, "*介護福祉士*")`で「あり」の件数をカウント
3. `=COUNTA(qualifications) - COUNTIF(qualifications, "*介護福祉士*")`で「なし」の件数をカウント
4. GASの集計結果と比較

**検証ポイント**:
- [ ] 「あり」の件数が一致する（許容誤差: ±5%）
- [ ] 「なし」の件数が一致する（許容誤差: ±5%）
- [ ] 合計が申請者総数と一致する

**許容誤差の理由**:
- `qualifications`カラムに余分なスペースがある場合
- カンマ区切りのフォーマットが一部異なる場合

---

### シナリオ3: 転職意欲レベルのクロス集計（データ変換）

**テスト目的**: `urgency_score`を4段階（最高/高/中/低）に変換する機能が正しく動作するか確認

#### 操作手順

1. X軸ドロップダウンで「転職意欲」を選択
2. Y軸ドロップダウンで「年齢層」を選択
3. 「🔍 クロス集計を実行」ボタンをクリック

#### 期待結果

| 確認項目 | 期待される結果 | 実際の結果 | ステータス |
|---------|--------------|-----------|-----------|
| 列ラベル | 「最高」「高」「中」「低」の4列が表示される | | ⬜ |
| 行ラベル | 年齢層が表示される | | ⬜ |
| 合計値 | 4レベルの合計 = 申請者総数 | | ⬜ |
| 分類精度 | urgency_score 8以上が「最高」に分類される | | ⬜ |
| 分類精度 | urgency_score 6-7が「高」に分類される | | ⬜ |
| 分類精度 | urgency_score 4-5が「中」に分類される | | ⬜ |
| 分類精度 | urgency_score 0-3が「低」に分類される | | ⬜ |

#### データ検証

**手動検証方法**:

1. Googleスプレッドシートで`urgency_score`カラムを確認
2. 以下の式で各レベルをカウント:
   - 最高: `=COUNTIF(urgency_score, ">=8")`
   - 高: `=COUNTIFS(urgency_score, ">=6", urgency_score, "<8")`
   - 中: `=COUNTIFS(urgency_score, ">=4", urgency_score, "<6")`
   - 低: `=COUNTIF(urgency_score, "<4")`
3. GASの集計結果と比較

**検証ポイント**:
- [ ] 各レベルの件数が一致する（許容誤差: ±3%）
- [ ] 合計が申請者総数と一致する

---

### シナリオ4: CSV出力機能（データエクスポート）

**テスト目的**: CSV出力機能が正しく動作し、Excelで開けるか確認

#### 操作手順

1. シナリオ1-3のいずれかのクロス集計を実行
2. 「📥 CSV出力」ボタンをクリック
3. ダウンロードされたCSVファイルを確認

#### 期待結果

| 確認項目 | 期待される結果 | 実際の結果 | ステータス |
|---------|--------------|-----------|-----------|
| ファイルダウンロード | CSVファイルがダウンロードされる | | ⬜ |
| ファイル名 | `cross_[Y軸]_[X軸]_YYYY-MM-DD.csv` | | ⬜ |
| 日付形式 | 例: `cross_年齢層_性別_2025-11-03.csv` | | ⬜ |
| Excel表示 | Excelで開いて日本語が文字化けしない | | ⬜ |
| ヘッダー行 | 1行目にヘッダーが表示される | | ⬜ |
| データ行 | 2行目以降にデータが表示される | | ⬜ |
| 合計行 | 最終行に合計が表示される | | ⬜ |
| 合計列 | 最終列に合計が表示される | | ⬜ |

#### データ検証

**手動検証方法**:

1. CSVファイルをExcelで開く
2. 合計行・合計列の値を手動で検算
3. GASの画面表示と比較

**検証ポイント**:
- [ ] CSVの値とGAS画面の値が完全に一致する
- [ ] 合計値が正しい
- [ ] 日本語が文字化けしていない

---

### シナリオ5: 複数の軸組み合わせ（網羅性）

**テスト目的**: 27軸の様々な組み合わせで正常に動作するか確認

#### 操作手順

以下の5パターンを実施:

| パターン | X軸 | Y軸 |
|---------|-----|-----|
| 1 | 年齢層 | 性別 |
| 2 | 介護福祉士 | 年齢層 |
| 3 | 就業状態 | 学歴 |
| 4 | 転職意欲 | 性別 |
| 5 | キャリア | 希望職種 |

#### 期待結果

| パターン | テーブル表示 | ヒートマップ表示 | CSV出力 | ステータス |
|---------|------------|----------------|---------|-----------|
| 1 | ✅ | ✅ | ✅ | ⬜ |
| 2 | ✅ | ✅ | ✅ | ⬜ |
| 3 | ✅ | ✅ | ✅ | ⬜ |
| 4 | ✅ | ✅ | ✅ | ⬜ |
| 5 | ✅ | ✅ | ✅ | ⬜ |

**検証ポイント**:
- [ ] すべてのパターンでエラーが発生しない
- [ ] 各パターンで合計値が申請者総数と一致する
- [ ] 処理時間が2秒以内

---

### シナリオ6: 地域切り替え（動的データ更新）

**テスト目的**: 地域を切り替えたときに、データが正しく更新されるか確認

#### 操作手順

1. 京都市を選択 → クロス分析タブを開く → 申請者数を確認
2. 大阪市を選択 → クロス分析タブを開く → 申請者数を確認
3. 東京都を選択 → クロス分析タブを開く → 申請者数を確認

#### 期待結果

| 地域 | 申請者数 | テーブル更新 | ステータス |
|------|---------|------------|-----------|
| 京都市 | N件 | ✅ | ⬜ |
| 大阪市 | M件 | ✅ | ⬜ |
| 東京都 | K件 | ✅ | ⬜ |

**検証ポイント**:
- [ ] 地域を切り替えると申請者数が変わる
- [ ] テーブルの内容が地域ごとに異なる
- [ ] 各地域のデータが正しい（参照データと比較）

---

### シナリオ7: エッジケース（データが少ない地域）

**テスト目的**: 申請者が少ない地域でも正しく動作するか確認

#### 操作手順

1. 申請者が10件以下の地域を選択
2. クロス分析タブを開く
3. クロス集計を実行

#### 期待結果

| 確認項目 | 期待される結果 | 実際の結果 | ステータス |
|---------|--------------|-----------|-----------|
| エラー表示 | エラーが発生しない | | ⬜ |
| テーブル表示 | 小さなテーブルが表示される | | ⬜ |
| 合計値 | 合計が申請者数と一致する | | ⬜ |
| CSV出力 | CSVが正常に出力される | | ⬜ |

**検証ポイント**:
- [ ] データが少なくてもエラーが発生しない
- [ ] 空のセル（0件）が正しく表示される

---

### シナリオ8: エッジケース（データが0件の地域）

**テスト目的**: 申請者がいない地域で適切なメッセージが表示されるか確認

#### 操作手順

1. 申請者が0件の地域を選択
2. クロス分析タブを開く

#### 期待結果

| 確認項目 | 期待される結果 | 実際の結果 | ステータス |
|---------|--------------|-----------|-----------|
| メッセージ表示 | 「選択地域（○○）の申請者データがありません。」と表示される | | ⬜ |
| エラー発生 | エラーが発生しない | | ⬜ |

**検証ポイント**:
- [ ] 適切なメッセージが表示される
- [ ] ブラウザコンソールにエラーがない

---

### シナリオ9: パフォーマンス（大量データ）

**テスト目的**: 申請者が多い地域でも十分な速度が出るか確認

#### 操作手順

1. 申請者が1,000件以上の地域を選択（例: 東京都）
2. クロス分析タブを開く
3. クロス集計を実行
4. 処理時間を計測

#### 期待結果

| データ件数 | 処理時間（期待値） | 実際の処理時間 | ステータス |
|-----------|------------------|--------------|-----------|
| 1,000件 | < 2秒 | | ⬜ |
| 5,000件 | < 3秒 | | ⬜ |
| 10,000件以上 | < 5秒 | | ⬜ |

**検証ポイント**:
- [ ] 処理時間が期待値以内
- [ ] ブラウザがフリーズしない
- [ ] テーブルが正しく表示される

---

### シナリオ10: 回帰テスト（既存機能への影響）

**テスト目的**: 新機能の追加により、既存のPhase 12-14機能が破損していないか確認

#### 操作手順

1. Phase 12タブ（需給バランス）を開く → データが表示されることを確認
2. Phase 13タブ（希少人材分析）を開く → データが表示されることを確認
3. Phase 14タブ（人材プロファイル）を開く → データが表示されることを確認
4. クロス分析タブを開く → データが表示されることを確認
5. Phase 12に戻る → データが表示されることを確認

#### 期待結果

| タブ | データ表示 | 地域選択 | タブ切り替え | ステータス |
|------|-----------|---------|------------|-----------|
| Phase 12 | ✅ | ✅ | ✅ | ⬜ |
| Phase 13 | ✅ | ✅ | ✅ | ⬜ |
| Phase 14 | ✅ | ✅ | ✅ | ⬜ |
| クロス分析 | ✅ | ✅ | ✅ | ⬜ |

**検証ポイント**:
- [ ] すべてのタブが正常に動作する
- [ ] タブ切り替えがスムーズ
- [ ] データが破損していない

---

## 4. データ検証方法

### 4.1 検証用スプレッドシートの準備

#### ステップ1: ピボットテーブルの作成

1. Googleスプレッドシートで元データを開く
2. 「データ」→「ピボットテーブル」を選択
3. 新しいシートに作成

#### ステップ2: ピボットテーブルの設定

**年齢層×性別の場合**:
- 行: `age_bucket`
- 列: `gender`
- 値: `COUNTA(applicant_id)`

**資格バイネーム（介護福祉士）の場合**:
- 行: `age_bucket`
- 列: 計算フィールドを作成
  - フィールド名: `has_qualification`
  - 式: `=IF(REGEXMATCH(qualifications, "介護福祉士"), "あり", "なし")`
- 値: `COUNTA(applicant_id)`

### 4.2 許容誤差の基準

| データタイプ | 許容誤差 | 理由 |
|------------|---------|------|
| 基本属性（年齢層、性別など） | ±0% | データが明確 |
| 資格バイネーム | ±5% | 余分なスペース、フォーマットの違い |
| 転職意欲レベル | ±3% | 境界値の丸め誤差 |
| 合計値 | ±0% | 合計は常に正確であるべき |

### 4.3 不一致時の対応

**不一致が発生した場合**:

1. **原因調査**:
   - ブラウザコンソールでエラーを確認
   - `payload.applicants`のサンプルデータを確認
   - `qualifications`カラムのフォーマットを確認

2. **ドキュメント化**:
   - 不一致の詳細を記録（どのセル、期待値、実際の値）
   - スクリーンショットを撮影
   - 問題報告フォームに記入（後述）

3. **開発チームへの報告**:
   - 問題報告フォームを提出
   - 再現手順を詳細に記載

---

## 5. 問題報告方法

### 5.1 問題報告フォーム

問題を発見した場合、以下のフォームに記入してください:

```
【問題報告フォーム】

■ 基本情報
- 報告日時: YYYY年MM月DD日 HH:MM
- 報告者: [氏名]
- シナリオ番号: シナリオN
- 重大度: [Critical / High / Medium / Low]

■ 問題の詳細
- 発生した問題: [問題の簡潔な説明]
- 期待される動作: [期待していた動作]
- 実際の動作: [実際に起きた動作]
- 再現手順:
  1. [ステップ1]
  2. [ステップ2]
  3. ...

■ 環境情報
- ブラウザ: [Chrome / Firefox / Safari など]
- バージョン: [ブラウザのバージョン]
- OS: [Windows / macOS / Linux]
- 地域: [選択した地域名]
- データ件数: [申請者数]

■ 添付資料
- スクリーンショット: [添付]
- ブラウザコンソールのエラー: [コピー＆ペースト]
- CSV出力（該当する場合）: [添付]

■ 追加情報
- [その他、気づいたこと]
```

### 5.2 重大度の定義

| レベル | 定義 | 例 |
|--------|------|---|
| **Critical** | サービスが使用できない | アプリケーション全体がクラッシュする |
| **High** | 主要機能が使用できない | クロス集計が全く動作しない |
| **Medium** | 一部機能に問題がある | 特定の資格でのみ集計が失敗する |
| **Low** | UIの軽微な問題 | ボタンのラベルが不明瞭 |

---

## 6. 承認基準

### 6.1 合格基準

以下のすべてを満たすことがUAT合格の条件です:

#### 必須条件（すべて満たす必要がある）

- [ ] **シナリオ1-10のすべてが成功する**
- [ ] **Critical/High重大度の問題が0件**
- [ ] **データ精度が95%以上**（許容誤差範囲内）
- [ ] **処理時間が期待値以内**（1,000件: < 2秒）
- [ ] **既存機能（Phase 12-14）に影響がない**

#### 推奨条件（できるだけ満たすことが望ましい）

- [ ] Medium重大度の問題が5件以下
- [ ] Low重大度の問題が10件以下
- [ ] ビジネスユーザーが独力で操作できる
- [ ] ユーザーフィードバックが肯定的

### 6.2 条件付き合格

以下の場合は条件付き合格とし、問題修正後に再テストを実施:

- Medium重大度の問題が6-10件ある
- データ精度が90-94%（許容誤差をやや超える）
- 処理時間が期待値の1.5倍以内（1,000件: < 3秒）

### 6.3 不合格

以下の場合は不合格とし、問題修正後に全テストを再実施:

- Critical/High重大度の問題が1件以上ある
- データ精度が90%未満
- 処理時間が期待値の2倍を超える（1,000件: > 4秒）
- 既存機能（Phase 12-14）に影響がある

---

## 7. UAT完了レポート

UATが完了したら、以下のレポートを作成してください:

### 7.1 UAT実施レポート

```
【UAT実施レポート】

■ 基本情報
- テスト実施日: YYYY年MM月DD日
- テスト実施者: [氏名]
- テスト環境: [本番 / ステージング]
- 実施時間: [開始時刻] - [終了時刻]（合計: N分）

■ テスト結果サマリー
- 総テストケース数: 10シナリオ
- 成功: N件
- 失敗: M件
- 成功率: X%

■ シナリオ別結果
| シナリオ | ステータス | 備考 |
|---------|-----------|------|
| 1. 年齢層×性別 | ✅ 成功 | - |
| 2. 資格バイネーム | ✅ 成功 | - |
| 3. 転職意欲レベル | ✅ 成功 | - |
| 4. CSV出力 | ✅ 成功 | - |
| 5. 複数軸組み合わせ | ✅ 成功 | - |
| 6. 地域切り替え | ✅ 成功 | - |
| 7. データ少（エッジ） | ✅ 成功 | - |
| 8. データ0件（エッジ） | ✅ 成功 | - |
| 9. パフォーマンス | ✅ 成功 | 1,500件: 1.2秒 |
| 10. 回帰テスト | ✅ 成功 | - |

■ データ精度
- 年齢層×性別: 100%一致
- 資格バイネーム（介護福祉士）: 98.5%一致（許容誤差範囲内）
- 転職意欲レベル: 99.2%一致（許容誤差範囲内）
- 総合精度: 99.2%

■ パフォーマンス
- 京都市（1,500件）: 1.2秒
- 大阪市（3,200件）: 2.3秒
- 東京都（8,500件）: 4.1秒

■ 発見された問題
- Critical: 0件
- High: 0件
- Medium: N件
  - [問題の簡潔な説明]
- Low: M件
  - [問題の簡潔な説明]

■ ユーザーフィードバック
- 使いやすさ: [5段階評価]
- 機能の充実度: [5段階評価]
- パフォーマンス: [5段階評価]
- 総合評価: [5段階評価]
- コメント: [自由記述]

■ 承認判定
- 判定: [合格 / 条件付き合格 / 不合格]
- 理由: [判定理由]
- 次のアクション: [必要に応じて記載]

■ 承認者署名
- 承認者: [氏名]
- 承認日: YYYY年MM月DD日
- 署名: _______________
```

---

## 8. 付録

### 8.1 用語集

| 用語 | 説明 |
|------|------|
| **クロス集計** | 2つの属性を縦軸・横軸に配置して集計する手法 |
| **資格バイネーム** | 資格の個数ではなく、特定の資格を持っているか（あり/なし）で集計する方法 |
| **ヒートマップ** | セルの値に応じて背景色を変化させる可視化手法 |
| **urgency_score** | 転職意欲を0-10の数値で表したスコア |
| **payload** | GASで読み込まれた申請者データ全体 |

### 8.2 よくある質問（FAQ）

#### Q1: 集計結果がピボットテーブルと5%以上ずれるのですが？

A: 以下を確認してください:
1. `qualifications`カラムに余分なスペースがないか
2. 資格名が完全一致しているか（部分一致はカウントされません）
3. ピボットテーブルの計算式が正しいか

#### Q2: CSVをExcelで開くと文字化けするのですが？

A: 以下を試してください:
1. Excelの「データ」→「テキストファイル」→「UTF-8」を明示的に指定してインポート
2. メモ帳でCSVを開いて、先頭にBOM（EF BB BF）があるか確認

#### Q3: 処理が5秒以上かかるのですが？

A: 以下を確認してください:
1. データ件数が10,000件を超えていないか
2. ブラウザのキャッシュをクリアしたか
3. 他のタブを閉じて、ブラウザのメモリを解放したか

---

**ドキュメントバージョン**: 1.0
**作成日**: 2025年11月3日
**最終更新日**: 2025年11月3日
**ステータス**: レビュー待ち

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025-11-03 | 1.0 | 初版作成 |
