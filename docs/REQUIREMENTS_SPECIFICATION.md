# MapComplete統合ダッシュボード Reflex移行プロジェクト 要件定義書

**バージョン**: 1.0
**作成日**: 2025年11月12日
**ステータス**: 承認待ち
**文書ID**: PRD-MAPCOMPLETE-REFLEX-001

---

## エグゼクティブサマリー

本ドキュメントは、Google Apps Script（GAS）で実装されたMapComplete統合ダッシュボードを、次世代Pythonフレームワーク「Reflex」へ完全移行するプロジェクトの要件定義書です。

**主要目標**:
- パフォーマンス50倍改善（初回ロード: 98秒→5秒）
- 10ユーザー同時利用実現（セッション完全独立）
- 保守性向上（構造化コード、モダン開発環境）
- 新技術体験（Reflex v0.5.x採用）

**プロジェクト規模**:
- 開発期間: 3日間
- 開発者: 1名
- 予算: $0（無料ツール活用）
- データ規模: 20,590行×36列

**成功基準**:
- 初回ロード5秒以内 ✅
- 10ユーザー同時利用成功率100% ✅
- GAS全機能完全再現 ✅
- ビジュアル品質GAS同等以上 ✅

---

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [機能要件](#2-機能要件)
3. [非機能要件](#3-非機能要件)
4. [データ要件](#4-データ要件)
5. [UI/UX要件](#5-uiux要件)
6. [技術要件](#6-技術要件)
7. [品質要件](#7-品質要件)
8. [制約条件](#8-制約条件)
9. [リスク分析](#9-リスク分析)
10. [成功基準](#10-成功基準)
11. [要件トレーサビリティマトリクス](#11-要件トレーサビリティマトリクス)
12. [MECE準拠性評価](#12-mece準拠性評価)

---

## 1. プロジェクト概要

### 1.1 プロジェクト基本情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | MapComplete統合ダッシュボード Reflex移行プロジェクト |
| プロジェクトコード | MCRD-2025-001 |
| 開発期間 | 3日間（2025年11月13日～15日） |
| 開発体制 | 開発者1名 |
| 予算 | $0（Reflex無料、Render無料プラン、オープンソースツール） |
| プロジェクトオーナー | 人事部門 |
| 技術責任者 | 開発チームリーダー |

### 1.2 プロジェクト目的

#### 1.2.1 ビジネス目的

1. **業務効率化**:
   - 現状98秒の待機時間を5秒に短縮（年間作業時間削減: 約200時間/10ユーザー）
   - リアルタイム分析による意思決定高速化

2. **複数ユーザー対応**:
   - 現状1ユーザー制約から10ユーザー同時利用へ
   - 採用チーム全員が同時にデータ分析可能

3. **保守コスト削減**:
   - GAS特有のデバッグ困難性解消
   - モダンなPython開発環境によるメンテナンス効率化

4. **技術投資**:
   - 最新技術（Reflex）への挑戦による開発知見獲得
   - 将来的な他システムへの応用可能性

#### 1.2.2 技術的目的

1. **パフォーマンス改善**:
   - 初回ロード: 98秒→5秒（50倍高速化）
   - タブ切替: 5-10秒→0.1秒（50-100倍高速化）
   - データフィルタリング: 3-5秒→0.05秒（60-100倍高速化）

2. **スケーラビリティ確保**:
   - 10ユーザー同時利用（現状1ユーザー）
   - 将来50ユーザーまで拡張可能な設計

3. **保守性向上**:
   - GAS 1,200行の複雑コード→Reflex構造化コード
   - Git管理、Pylint、自動テスト導入

4. **拡張性確保**:
   - 新分析機能の追加容易性
   - row_type追加時のコード変更最小化

#### 1.2.3 ユーザー目的

1. **即座のデータ洞察**:
   - 待機時間ゼロでの分析実施
   - 複数仮説の迅速検証

2. **柔軟な分析**:
   - 複数地域の比較分析（任意機能）
   - データダウンロードによる二次利用（任意機能）

3. **直感的操作**:
   - 学習コスト5分以内
   - GASより優れたUI/UX

### 1.3 背景と課題

#### 1.3.1 現状（GAS実装）の詳細

**実装規模**:
- 10ファイル（.gs + .html）
- 約3,550行（Phase 1-14統合）
- 11種類のrow_type対応
- 1,901件のジオコーディングキャッシュ

**パフォーマンス**:
| 操作 | GAS | 影響 |
|------|-----|------|
| 初回ロード | 98秒 | ユーザー待機時間大 |
| タブ切替 | 5-10秒 | ストレス大 |
| 都道府県変更 | 3-5秒 | 分析フロー中断 |
| グラフ更新 | 2-3秒 | インタラクティブ性低 |

**保守性の課題**:
1. **GAS特有の制約**:
   - デバッグ機能貧弱
   - バージョン管理困難（.gsファイル）
   - テスト自動化不可

2. **コード複雑化**:
   - 1,200行の単一ファイル
   - グローバル変数多用
   - 関数間の依存関係不明瞭

3. **セッション管理不明**:
   - 複数ユーザー対応未検証
   - データ混在リスク

#### 1.3.2 課題の優先順位（MoSCoW分析）

**Must（必須）**:
- M-001: パフォーマンス改善（初回ロード5秒以内）
- M-002: 10ユーザー同時利用（セッション独立）
- M-003: GAS全機能再現（10タブ、11種類row_type）
- M-004: ビジュアル品質維持（GAS同等以上）

**Should（重要）**:
- S-001: 保守性向上（構造化コード、Git管理）
- S-002: テスト自動化（ユニット、統合、E2E）
- S-003: セッションタイムアウト管理（30分）

**Could（任意）**:
- C-001: データダウンロード機能（CSV/Excel）
- C-002: 複数地域比較機能（2地域並列）
- C-003: 差分ハイライト表示

**Won't（実装しない）**:
- W-001: ユーザー認証（社内専用のため不要）
- W-002: データ編集機能（読み取り専用）
- W-003: モバイルアプリ（デスクトップ優先）
- W-004: 外部API公開（社内専用）

#### 1.3.3 既存資産と活用方針

| 資産ID | 資産名 | サイズ/内容 | 活用方法 | 重要度 |
|--------|--------|------------|---------|--------|
| A-001 | MapComplete_Complete_All_FIXED.csv | 2.1MB, 20,590行×36列 | Reflexで同一データロード | 必須 |
| A-002 | geocache.json | 1,901件のジオコーディング | 地図表示の座標取得 | 必須 |
| A-003 | GASバグ修正版 | 11種row_type対応ロジック | 機能仕様参照、ロジック移植 | 重要 |
| A-004 | Streamlitプロトタイプ3種 | 却下版（ビジュアル不足） | 失敗教訓、UIアンチパターン | 参考 |
| A-005 | フレームワーク比較ドキュメント | Reflex vs Dash比較 | 技術選定根拠 | 参考 |

### 1.4 ステークホルダー

#### 1.4.1 ステークホルダーマトリクス

| 役割 | 名前/部門 | 影響度 | 関心度 | エンゲージメント戦略 |
|------|----------|--------|--------|---------------------|
| プロダクトオーナー | 人事部長 | 高 | 高 | 週次報告、要件変更承認 |
| 開発リーダー | 技術チーム | 高 | 高 | 日次進捗、技術判断 |
| エンドユーザー | 採用担当者10名 | 高 | 高 | UAT参加、フィードバック |
| 技術レビュアー | CTO | 中 | 中 | コードレビュー、アーキテクチャ承認 |
| IT運用 | インフラチーム | 中 | 低 | デプロイ支援 |

#### 1.4.2 ステークホルダー要求の詳細

**プロダクトオーナー要求**:
1. 3日以内のリリース（期限厳守）
2. GAS全機能再現（機能削減なし）
3. パフォーマンス改善実感（体感速度向上）
4. 予算$0（無料ツール活用）

**開発リーダー要求**:
1. 保守性の高いコード（将来の拡張容易）
2. 新技術体験（Reflex知見獲得）
3. テスト自動化（品質保証）
4. ドキュメント整備

**エンドユーザー要求**:
1. 高速動作（待機時間ゼロ）
2. 直感的UI（学習コスト5分以内）
3. 10ユーザー同時利用（データ混在なし）
4. データダウンロード（CSV）

**技術レビュアー要求**:
1. セキュリティ基準遵守
2. スケーラビリティ設計
3. コード品質（Pylint 8.0+）

### 1.5 スコープ定義（MECE）

#### 1.5.1 含む項目（In-Scope）- 階層構造

**Level 1: データ処理機能**
- **L1-A: データロード**
  - L1-A-1: CSVファイルアップロード（20,590行×36列、5秒以内）
  - L1-A-2: データ解析・分類（11種類のrow_type、0.5秒以内）
  - L1-A-3: geocache.json統合（1,901件、0.1秒以内）

- **L1-B: データフィルタリング**
  - L1-B-1: 都道府県フィルタ（47都道府県+全国、0.1秒以内）
  - L1-B-2: 市区町村フィルタ（複数選択、動的更新、0.1秒以内）
  - L1-B-3: リアルタイムフィルタ連動（グラフ即座更新）

**Level 2: 可視化機能**
- **L2-A: 10タブ統合ダッシュボード**
  - L2-A-1: タブ1 - サマリー（SUMMARY row_type）
  - L2-A-2: タブ2 - 年齢×性別（AGE_GENDER）
  - L2-A-3: タブ3 - ペルソナ（PERSONA）
  - L2-A-4: タブ4 - ペルソナ×自治体（PERSONA_MUNI）
  - L2-A-5: タブ5 - キャリア×学歴（CAREER_CROSS）
  - L2-A-6: タブ6 - 転職意欲×年齢（URGENCY_AGE）
  - L2-A-7: タブ7 - 転職意欲×雇用（URGENCY_EMPLOYMENT）
  - L2-A-8: タブ8 - フロー分析（FLOW）
  - L2-A-9: タブ9 - 需給ギャップ（GAP）
  - L2-A-10: タブ10 - レアリティ・競争（RARITY, COMPETITION）

- **L2-B: 地図表示機能**
  - L2-B-1: バブルマップ（バブルサイズ=求職者数、色=平均年齢、1秒以内）
  - L2-B-2: ヒートマップ（密度=求職者数、1秒以内）

- **L2-C: インタラクティブ性**
  - L2-C-1: ホバーツールチップ（詳細データ表示）
  - L2-C-2: ズーム・パン操作（Plotly標準機能）
  - L2-C-3: フィルタ連動（地域選択→グラフ即座更新）

**Level 3: ユーザー管理機能**
- **L3-A: セッション管理**
  - L3-A-1: ユーザー別State独立（Reflex標準機能、10ユーザー）
  - L3-A-2: セッションタイムアウト（30分無操作、任意）
  - L3-A-3: データキャッシュ管理（State内キャッシュ、再読み込み不要）

**Level 4: UI/UX機能**
- **L4-A: レイアウト**
  - L4-A-1: サイドバーナビゲーション（地域選択、固定表示）
  - L4-A-2: メインエリア（タブ表示、グラフエリア）
  - L4-A-3: レスポンシブデザイン（デスクトップ優先、モバイル対応任意）

- **L4-B: フィードバック**
  - L4-B-1: ローディング表示（データ処理中）
  - L4-B-2: エラーメッセージ（明確な説明）
  - L4-B-3: 進捗バー（CSVアップロード時）

**Level 5: データダウンロード機能（任意）**
- **L5-A: CSV形式ダウンロード**
  - L5-A-1: 現在表示中データのCSV出力
  - L5-A-2: フィルタリング結果反映
  - L5-A-3: ファイル名自動生成（`MapComplete_{row_type}_{日時}.csv`）

- **L5-B: Excel形式ダウンロード（任意）**
  - L5-B-1: 11シート構成（各row_type）
  - L5-B-2: openpyxl使用

**Level 6: 複数地域比較機能（任意）**
- **L6-A: 2地域並列表示**
  - L6-A-1: 画面左右2分割
  - L6-A-2: 各地域独立選択

- **L6-B: 差分ハイライト**
  - L6-B-1: 差分自動計算
  - L6-B-2: ハイライト表示（差分>10%）

#### 1.5.2 含まない項目（Out-of-Scope）- 階層構造

**Level 1: 認証・権限管理**
- **L1-X: ユーザー認証**
  - 理由: 社内専用、ネットワークレベルで制限
- **L1-Y: ロールベースアクセス制御（RBAC）**
  - 理由: 全員同一権限
- **L1-Z: 監査ログ**
  - 理由: ビジネス要件外

**Level 2: データ編集機能**
- **L2-X: CSV編集**
  - 理由: 読み取り専用ダッシュボード
- **L2-Y: データ追加・削除**
  - 理由: 別システム（Python処理）で管理

**Level 3: 外部連携**
- **L3-X: REST API公開**
  - 理由: 社内専用、API不要
- **L3-Y: 他システム連携**
  - 理由: スコープ外、Phase 2検討

**Level 4: モバイル最適化**
- **L4-X: モバイルアプリ**
  - 理由: デスクトップ優先
- **L4-Y: タッチジェスチャー最適化**
  - 理由: マウス操作前提

**Level 5: 高度な分析機能**
- **L5-X: 機械学習予測**
  - 理由: Phase 7までで実装済み、Reflex移行では既存機能再現のみ
- **L5-Y: リアルタイムデータ更新**
  - 理由: バッチ処理（日次更新）

**Level 6: 管理機能**
- **L6-X: ユーザー管理画面**
  - 理由: 管理者不要（全員同一権限）
- **L6-Y: システム設定画面**
  - 理由: コード変更で対応

### 1.6 前提条件

| 前提ID | カテゴリ | 内容 | 検証方法 | リスク |
|--------|---------|------|---------|--------|
| P-001 | 技術 | Reflex v0.5.x安定版リリース済み | pip install reflex成功 | 低 |
| P-002 | 環境 | Python 3.10+環境構築済み | python --version確認 | 極小 |
| P-003 | データ | MapComplete_Complete_All_FIXED.csv品質保証済み | 行数・列数確認 | 極小 |
| P-004 | インフラ | Render無料プランアカウント取得済み | render.com登録確認 | 極小 |
| P-005 | ネットワーク | 社内から外部アクセス可能 | curl https://render.com成功 | 低 |
| P-006 | ブラウザ | Chrome/Edge最新版使用 | バージョン確認 | 極小 |
| P-007 | データ | geocache.json完全性 | 1,901件確認 | 低 |
| P-008 | スキル | 開発者のPython経験（中級以上） | - | 極小 |

### 1.7 依存関係

#### 1.7.1 外部依存関係

| 依存ID | 依存先 | 依存内容 | バージョン | リスク評価 | 軽減策 |
|--------|--------|---------|-----------|-----------|--------|
| D-001 | Reflex | フレームワーク本体 | v0.5.x | 中（新技術） | Dashバックアップ |
| D-002 | Plotly | グラフ描画 | v5.17+ | 極小（安定） | なし |
| D-003 | pandas | データ処理 | v2.0+ | 極小（安定） | なし |
| D-004 | Chakra UI | UIコンポーネント | Reflex依存 | 低 | Reflexに組み込み済み |
| D-005 | Render | ホスティング | 無料プラン | 低 | 有料プラン切替可能 |

#### 1.7.2 内部依存関係

| 依存ID | 機能A | 機能B | 依存内容 | 影響 |
|--------|------|------|---------|------|
| D-101 | FR-102（データ分類） | FR-101（CSVアップロード） | CSVロード完了後に分類実行 | FR-101遅延でFR-102も遅延 |
| D-102 | FR-202（市区町村選択） | FR-201（都道府県選択） | 都道府県選択後に市区町村リスト生成 | FR-201不具合でFR-202動作不可 |
| D-103 | FR-300（可視化） | FR-102（データ分類） | 分類済みDataFrame使用 | FR-102不具合で全タブ影響 |
| D-104 | FR-400（地図表示） | FR-103（geocache統合） | geocacheで座標取得 | FR-103不具合で地図表示不可 |
| D-105 | FR-600（ダウンロード） | FR-300（可視化） | 表示中データをダウンロード | FR-300不具合でダウンロード不可 |

---

## 2. 機能要件（詳細）

### 2.1 機能要件の全体像（MECE階層構造）

```
FR-000: MapComplete統合ダッシュボード（ルート）
│
├── FR-100: データ管理機能（Must）
│   ├── FR-101: CSVファイルアップロード
│   ├── FR-102: データ解析・分類
│   └── FR-103: geocache統合
│
├── FR-200: 地域選択機能（Must）
│   ├── FR-201: 都道府県選択
│   └── FR-202: 市区町村選択
│
├── FR-300: データ可視化機能（Must）
│   ├── FR-301: タブ1 - サマリー
│   ├── FR-302: タブ2 - 年齢×性別
│   ├── FR-303: タブ3 - ペルソナ
│   ├── FR-304: タブ4 - ペルソナ×自治体
│   ├── FR-305: タブ5 - キャリア×学歴
│   ├── FR-306: タブ6 - 転職意欲×年齢
│   ├── FR-307: タブ7 - 転職意欲×雇用
│   ├── FR-308: タブ8 - フロー分析
│   ├── FR-309: タブ9 - 需給ギャップ
│   └── FR-310: タブ10 - レアリティ・競争
│
├── FR-400: 地図表示機能（Must）
│   ├── FR-401: バブルマップ
│   └── FR-402: ヒートマップ
│
├── FR-500: セッション管理機能（Must）
│   ├── FR-501: ユーザー別State独立
│   ├── FR-502: セッションタイムアウト
│   └── FR-503: データキャッシュ管理
│
├── FR-600: データダウンロード機能（Could）
│   ├── FR-601: CSV形式ダウンロード
│   └── FR-602: Excel形式ダウンロード
│
└── FR-700: 複数地域比較機能（Could）
    ├── FR-701: 2地域並列表示
    └── FR-702: 差分ハイライト
```

### 2.2 機能要件サマリーテーブル

| FR-ID | 機能名 | 優先度 | GAS対応 | 開発工数 | 依存関係 |
|-------|--------|--------|---------|---------|---------|
| FR-101 | CSVアップロード | Must | ✅ | 0.5日 | なし |
| FR-102 | データ解析・分類 | Must | ✅ | 0.5日 | FR-101 |
| FR-103 | geocache統合 | Must | ✅ | 0.2日 | なし |
| FR-201 | 都道府県選択 | Must | ✅ | 0.3日 | FR-102 |
| FR-202 | 市区町村選択 | Must | ✅ | 0.3日 | FR-201 |
| FR-301-310 | 10タブ可視化 | Must | ✅ | 1.5日 | FR-102, FR-201/202 |
| FR-401 | バブルマップ | Must | ✅ | 0.3日 | FR-103 |
| FR-402 | ヒートマップ | Must | ✅ | 0.2日 | FR-103 |
| FR-501 | State独立 | Must | ❌ | 0.1日 | なし |
| FR-502 | タイムアウト | Should | ❌ | 0.2日 | FR-501 |
| FR-503 | キャッシュ管理 | Must | ❌ | 0.1日 | FR-501 |
| FR-601 | CSVダウンロード | Could | ❌ | 0.2日 | FR-300 |
| FR-602 | Excelダウンロード | Could | ❌ | 0.3日 | FR-300 |
| FR-701 | 2地域比較 | Could | ❌ | 0.5日 | FR-300 |
| FR-702 | 差分ハイライト | Could | ❌ | 0.3日 | FR-701 |

**合計工数**: 5.9日（Must: 4.0日、Should: 0.2日、Could: 1.7日）

※実開発期間3日のため、Must機能のみ実装、Could機能はPhase 2

---

## 3. 非機能要件（NFR）

### 3.1 非機能要件の全体像（品質特性別）

```
NFR-000: 非機能要件（ルート）
│
├── NFR-100: パフォーマンス
│   ├── NFR-101: 初回ロード時間
│   ├── NFR-102: タブ切替時間
│   ├── NFR-103: データフィルタリング時間
│   └── NFR-104: 地図描画時間
│
├── NFR-200: スケーラビリティ
│   ├── NFR-201: 同時ユーザー数
│   ├── NFR-202: メモリ使用量
│   ├── NFR-203: データサイズ拡張性
│   └── NFR-204: row_type拡張性
│
├── NFR-300: セキュリティ
│   ├── NFR-301: 認証（不要）
│   ├── NFR-302: データ保護
│   ├── NFR-303: 通信暗号化
│   └── NFR-304: インジェクション防止
│
├── NFR-400: ユーザビリティ
│   ├── NFR-401: 学習コスト
│   ├── NFR-402: 直感的UI
│   ├── NFR-403: エラーメッセージ
│   └── NFR-404: アクセシビリティ
│
├── NFR-500: 保守性
│   ├── NFR-501: コード品質
│   ├── NFR-502: ドキュメント
│   ├── NFR-503: テストカバレッジ
│   └── NFR-504: デバッグ容易性
│
└── NFR-600: 互換性
    ├── NFR-601: ブラウザ互換性
    ├── NFR-602: OS互換性
    └── NFR-603: 画面解像度対応
```

### 3.2 パフォーマンス要件（NFR-100）- 詳細

| NFR-ID | 項目 | 目標値 | 測定条件 | 測定方法 | 受入基準 |
|--------|------|--------|---------|---------|---------|
| NFR-101 | 初回ロード時間 | ≤5秒 | 20,590行×36列CSV、初回アクセス | Chrome DevTools Performance | DOMContentLoaded + データロード完了 ≤5秒 |
| NFR-102 | タブ切替時間 | ≤0.1秒 | 10タブ間切替 | Chrome Performance、体感 | クリック→グラフ表示完了 ≤0.1秒 |
| NFR-103 | 都道府県選択 | ≤0.1秒 | 47都道府県選択 | Chrome Performance | 選択→グラフ更新完了 ≤0.1秒 |
| NFR-104 | 市区町村選択 | ≤0.1秒 | 複数選択（最大50件） | Chrome Performance | 選択→グラフ更新完了 ≤0.1秒 |
| NFR-105 | バブルマップ描画 | ≤1秒 | 1,901件座標 | Chrome Performance | 座標計算+Plotly描画完了 ≤1秒 |
| NFR-106 | ヒートマップ描画 | ≤1秒 | 1,901件座標 | Chrome Performance | 密度計算+Plotly描画完了 ≤1秒 |
| NFR-107 | データフィルタリング | ≤0.05秒 | 20,590行→1,000行 | pandas処理時間測定 | DataFrame.query()実行完了 ≤0.05秒 |
| NFR-108 | グラフ描画時間 | ≤0.2秒 | Plotlyグラフ（最大1,000点） | Plotly描画時間 | fig.show()→描画完了 ≤0.2秒 |
| NFR-109 | セッション独立性 | 影響なし | 10ユーザー同時操作 | 各ユーザーのレスポンスタイム | ユーザーAの操作がユーザーBに遅延を与えない |

**パフォーマンステスト計画**:

1. **Lighthouseテスト**（目標スコア）:
   - Performance: ≥90点
   - Accessibility: ≥85点
   - Best Practices: ≥90点
   - SEO: N/A（社内専用）

2. **負荷テスト**（Locust使用）:
   - シナリオ: 10ユーザーが同時に都道府県選択、タブ切替を1分間実行
   - 測定項目: レスポンスタイム平均、エラー率、CPU使用率、メモリ使用率
   - 受入基準: レスポンスタイム平均≤0.2秒、エラー率0%

3. **パフォーマンスプロファイリング**:
   - Chrome DevTools Performanceで1分間記録
   - ボトルネック特定（Long Task >50ms）
   - 最適化対象の優先順位付け

**最適化戦略**:

| 最適化対象 | 手法 | 期待効果 |
|-----------|------|---------|
| CSVロード | pandas dtype指定、chunk読み込み | 30%高速化 |
| データフィルタリング | DataFrame.query()、インデックス活用 | 50%高速化 |
| グラフ描画 | Plotly scattergl（WebGL）、点数制限1,000 | 60%高速化 |
| State更新 | @rx.var キャッシュ、不要更新抑制 | 40%高速化 |
| geocache | 起動時一括ロード、辞書ルックアップO(1) | 90%高速化 |

### 3.3 スケーラビリティ要件（NFR-200）- 詳細

| NFR-ID | 項目 | 現状 | 目標 | 将来拡張 | 設計方針 |
|--------|------|------|------|---------|---------|
| NFR-201 | 同時ユーザー数 | 1 | 10 | 50 | Reflexセッション管理、水平スケーリング |
| NFR-202 | メモリ使用量 | N/A | ≤512MB | ≤2GB | Render無料プラン制約、効率的キャッシュ |
| NFR-203 | データサイズ | 20,590行 | 20,590行 | 100,000行 | pandas chunk読み込み、DB移行検討 |
| NFR-204 | row_type数 | 11種類 | 11種類 | 20種類 | 動的row_type登録、設定ファイル化 |
| NFR-205 | 都道府県数 | 47 | 47 | 50 | 動的都道府県リスト生成 |
| NFR-206 | グラフ点数 | 最大20,590 | 制限1,000 | 制限5,000 | サンプリング、WebGL使用 |

**スケーラビリティテスト**:

1. **10ユーザー同時アクセステスト**:
   ```
   シナリオ:
   - 10ブラウザ（Chrome Incognito）で同時アクセス
   - 各ユーザーが異なる都道府県選択
   - 1分間連続でタブ切替

   測定項目:
   - 各ユーザーのレスポンスタイム（目標: 0.2秒以内）
   - サーバーCPU使用率（目標: 70%以下）
   - メモリ使用量（目標: 400MB以下）
   - エラー率（目標: 0%）
   ```

2. **メモリリークテスト**:
   ```
   シナリオ:
   - 1ユーザーが10分間連続操作
   - 都道府県選択、タブ切替を100回繰り返し

   測定項目:
   - メモリ使用量推移（目標: 増加率10%以下）
   - GC（ガベージコレクション）頻度
   ```

**スケーラビリティ設計**:

| 設計項目 | 現状設計 | 将来拡張時の変更 |
|---------|---------|----------------|
| アーキテクチャ | モノリシック（単一プロセス） | マイクロサービス化（API分離） |
| データストア | インメモリ（State） | PostgreSQL + Redis |
| セッション管理 | Reflex標準（メモリ） | Redis Session Store |
| ファイル配信 | アプリサーバー | CDN（CloudFlare） |
| デプロイ | Render無料プラン（512MB） | Render Pro（2GB）+ 複数インスタンス |

---

## 4. データ要件

### 4.1 データソース仕様

#### 4.1.1 MapComplete_Complete_All_FIXED.csv

| 項目 | 詳細 |
|------|------|
| ファイル名 | MapComplete_Complete_All_FIXED.csv |
| サイズ | 2.1MB |
| 行数 | 20,590行（ヘッダー含む） |
| 列数 | 36列 |
| エンコーディング | UTF-8 with BOM |
| 改行コード | CRLF（Windows） |
| 区切り文字 | カンマ（,） |
| クォート文字 | ダブルクォート（"） |
| 欠損値表現 | 空文字列または"NaN" |

#### 4.1.2 データ構造（36列の詳細）

| 列番号 | 列名 | データ型 | 説明 | 必須 | 例 |
|--------|------|---------|------|------|-----|
| 1 | row_type | str | データ種別（11種類） | ✅ | SUMMARY, AGE_GENDER, ... |
| 2 | prefecture | str | 都道府県 | ✅ | 東京都, 大阪府, ... |
| 3 | municipality | str | 市区町村 | ✅ | 渋谷区, 大阪市中央区, ... |
| 4 | category1 | str | カテゴリ1（row_type依存） | ❌ | 20代, 男性, ... |
| 5 | category2 | str | カテゴリ2（row_type依存） | ❌ | 30代, 女性, ... |
| 6 | count | int | 人数 | ❌ | 384, 1520, ... |
| 7 | percentage | float | 割合（%） | ❌ | 12.5, 67.8, ... |
| 8-36 | （その他29列） | mixed | row_type別の専用列 | ❌ | ... |

#### 4.1.3 row_type別データ構造

**SUMMARY（サマリー情報）**:
| 列名 | 型 | 説明 | 例 |
|------|-----|------|-----|
| total_applicants | int | 求職者総数 | 384 |
| avg_age | float | 平均年齢 | 35.2 |
| male_ratio | float | 男性比率 | 0.65 |
| female_ratio | float | 女性比率 | 0.35 |

**AGE_GENDER（年齢×性別）**:
| 列名 | 型 | 説明 | 例 |
|------|-----|------|-----|
| category1 | str | 年齢層 | 20代, 30代, 40代, 50代以上 |
| category2 | str | 性別 | 男性, 女性 |
| count | int | 人数 | 50 |
| percentage | float | 割合（%） | 12.5 |

**FLOW（フロー分析）**:
| 列名 | 型 | 説明 | 例 |
|------|-----|------|-----|
| source_muni | str | 居住地 | 渋谷区 |
| target_muni | str | 希望勤務地 | 新宿区 |
| flow_count | int | 移動人数 | 50 |
| distance_km | float | 距離（km） | 5.2 |

（他8種類のrow_typeも同様に定義）

### 4.2 データ品質要件

| 品質ID | 項目 | 要件 | 検証方法 | 対応 |
|--------|------|------|---------|------|
| DQ-001 | 完全性 | 必須列（row_type, prefecture, municipality）の欠損率0% | `df.isnull().sum()` | 欠損行スキップ |
| DQ-002 | 整合性 | 行数合計=20,590行 | `len(df)` | アップロード時検証 |
| DQ-003 | 整合性 | 列数=36列 | `len(df.columns)` | アップロード時検証 |
| DQ-004 | 一意性 | row_type値が11種類のみ | `df['row_type'].unique()` | 不明row_type警告 |
| DQ-005 | 妥当性 | count列が非負整数 | `df['count'] >= 0` | 負値スキップ |
| DQ-006 | 妥当性 | percentage列が0-100範囲 | `0 <= df['percentage'] <= 100` | 範囲外スキップ |
| DQ-007 | 一貫性 | prefecture値が47都道府県+α | `df['prefecture'].unique()` | マスタ照合 |

### 4.3 geocache.json仕様

| 項目 | 詳細 |
|------|------|
| ファイル名 | geocache.json |
| サイズ | 約50KB |
| エントリ数 | 1,901件 |
| エンコーディング | UTF-8 |
| フォーマット | JSON（辞書型） |

**データ構造**:
```json
{
  "東京都渋谷区": {
    "lat": 35.6617,
    "lng": 139.7040,
    "prefecture": "東京都",
    "municipality": "渋谷区"
  },
  "大阪府大阪市中央区": {
    "lat": 34.6937,
    "lng": 135.5023,
    "prefecture": "大阪府",
    "municipality": "大阪市中央区"
  }
}
```

---

## 5. UI/UX要件

### 5.1 画面構成

#### 5.1.1 レイアウト構造

```
┌─────────────────────────────────────────────────┐
│  ヘッダー: MapComplete統合ダッシュボード          │
├──────────┬──────────────────────────────────────┤
│          │  タブバー                             │
│          ├──────────────────────────────────────┤
│ サイド   │                                       │
│ バー     │  メインエリア（グラフ・テーブル）      │
│          │                                       │
│ ・都道府県│                                       │
│ ・市区町村│                                       │
│          │                                       │
│ ・統計    │                                       │
│          │                                       │
└──────────┴──────────────────────────────────────┘
```

#### 5.1.2 レスポンシブデザイン

| 画面サイズ | レイアウト | 対応優先度 |
|-----------|-----------|-----------|
| ≥1920px（4K） | サイドバー20% + メインエリア80% | Should |
| 1366px-1919px（Full HD） | サイドバー25% + メインエリア75% | Must |
| 1024px-1365px（HD） | サイドバー30% + メインエリア70% | Must |
| 768px-1023px（タブレット） | サイドバー折りたたみ | Could |
| <768px（モバイル） | 非対応 | Won't |

### 5.2 カラースキーム

#### 5.2.1 プライマリカラー

| 色名 | HEX | RGB | 用途 |
|------|-----|-----|------|
| Primary Blue | #4A90E2 | rgb(74, 144, 226) | メインボタン、アクセント |
| Secondary Green | #7ED321 | rgb(126, 211, 33) | 成功メッセージ、ポジティブ指標 |
| Warning Orange | #F5A623 | rgb(245, 166, 35) | 警告、注意喚起 |
| Error Red | #D0021B | rgb(208, 2, 27) | エラーメッセージ、ネガティブ指標 |
| Neutral Gray | #4A4A4A | rgb(74, 74, 74) | テキスト、ボーダー |

#### 5.2.2 グラフカラーパレット

| パレット名 | 色数 | 用途 |
|-----------|------|------|
| Categorical | 10色 | 年齢層、性別、ペルソナ |
| Sequential | 連続 | 密度、数値スケール |
| Diverging | 連続 | 差分、正負比較 |

**Categoricalパレット**:
```python
CATEGORICAL_COLORS = [
    "#4A90E2",  # Blue
    "#E94B8A",  # Pink
    "#7ED321",  # Green
    "#F5A623",  # Orange
    "#BD10E0",  # Purple
    "#50E3C2",  # Cyan
    "#F8E71C",  # Yellow
    "#8B572A",  # Brown
    "#417505",  # Dark Green
    "#9013FE",  # Violet
]
```

### 5.3 タイポグラフィ

| 要素 | フォント | サイズ | 太さ | 行間 |
|------|---------|-------|------|------|
| H1（ページタイトル） | Noto Sans JP | 32px | Bold | 1.2 |
| H2（タブタイトル） | Noto Sans JP | 24px | Bold | 1.3 |
| H3（セクション） | Noto Sans JP | 18px | Semi-Bold | 1.4 |
| 本文 | Noto Sans JP | 14px | Regular | 1.5 |
| キャプション | Noto Sans JP | 12px | Regular | 1.4 |
| ボタン | Noto Sans JP | 14px | Semi-Bold | 1.0 |

### 5.4 インタラクティブ性

| インタラクション | 挙動 | フィードバック |
|----------------|------|--------------|
| ホバー（グラフ） | ツールチップ表示 | 0.1秒遅延、詳細データ表示 |
| クリック（タブ） | タブ切替 | 0.1秒以内、アクティブタブハイライト |
| 選択（ドロップダウン） | フィルタ適用 | 0.1秒以内、グラフ更新 |
| ズーム（地図） | 拡大・縮小 | スムーズアニメーション |
| パン（地図） | 移動 | スムーズドラッグ |

### 5.5 アクセシビリティ（WCAG 2.1 Level A準拠）

| 基準ID | 項目 | 要件 | 実装方法 |
|--------|------|------|---------|
| A-001 | キーボード操作 | すべての機能をキーボードで操作可能 | Tab, Enter, Spaceキー対応 |
| A-002 | コントラスト比 | テキストと背景のコントラスト比≥4.5:1 | カラーチェックツール使用 |
| A-003 | alt属性 | すべての画像にalt属性 | 地図以外は装飾画像なし |
| A-004 | フォーカス表示 | フォーカス状態を視覚的に表示 | アウトライン表示 |
| A-005 | エラーメッセージ | 明確なエラーメッセージ | "ファイル形式が不正です" |

---

## 6. 技術要件

### 6.1 技術スタック

#### 6.1.1 フロントエンド

| 技術 | バージョン | 用途 | 選定理由 |
|------|-----------|------|---------|
| Reflex | v0.5.x | フレームワーク | Next.js相当UI、セッション管理完璧 |
| Chakra UI | Reflex依存 | UIコンポーネント | プロフェッショナルなデザイン |
| Plotly | v5.17+ | グラフ描画 | インタラクティブ、豊富なチャート |

#### 6.1.2 バックエンド

| 技術 | バージョン | 用途 | 選定理由 |
|------|-----------|------|---------|
| Python | 3.10+ | 開発言語 | pandas互換、Reflex要件 |
| pandas | v2.0+ | データ処理 | 高速、豊富な機能 |
| FastAPI | Reflex依存 | APIサーバー | Reflexが内部使用 |

#### 6.1.3 インフラ

| 技術 | プラン | 用途 | コスト |
|------|-------|------|--------|
| Render | 無料プラン | ホスティング | $0/月 |
| GitHub | 無料プラン | バージョン管理 | $0/月 |

#### 6.1.4 開発ツール

| ツール | バージョン | 用途 |
|--------|-----------|------|
| VS Code | 最新 | IDE |
| Pylint | v3.0+ | 静的解析 |
| pytest | v7.0+ | ユニットテスト |
| Black | v23.0+ | コードフォーマッタ |
| mypy | v1.0+ | 型チェック |

### 6.2 依存ライブラリ（requirements.txt）

```txt
# Core Framework
reflex>=0.5.0,<0.6.0

# Data Processing
pandas>=2.0.0,<3.0.0
numpy>=1.24.0,<2.0.0

# Visualization
plotly>=5.17.0,<6.0.0

# File I/O
openpyxl>=3.1.0,<4.0.0  # Excel export

# Development Tools
pylint>=3.0.0
pytest>=7.4.0
black>=23.0.0
mypy>=1.5.0
```

### 6.3 アーキテクチャ

#### 6.3.1 システムアーキテクチャ図

```
┌─────────────────────────────────────────┐
│  ユーザー（ブラウザ）                    │
│  Chrome, Edge 最新版                     │
└───────────┬─────────────────────────────┘
            │ HTTPS
            ↓
┌─────────────────────────────────────────┐
│  Render（ホスティング）                  │
│  ┌───────────────────────────────────┐  │
│  │  Reflex App（FastAPI）            │  │
│  │  ├─ WebSocketサーバー             │  │
│  │  ├─ セッション管理                │  │
│  │  └─ 静的ファイル配信              │  │
│  └───────────┬───────────────────────┘  │
│              │                           │
│  ┌───────────▼───────────────────────┐  │
│  │  State管理（ユーザーごと独立）     │  │
│  │  ├─ User A State                  │  │
│  │  ├─ User B State                  │  │
│  │  └─ ...                           │  │
│  └───────────┬───────────────────────┘  │
│              │                           │
│  ┌───────────▼───────────────────────┐  │
│  │  データ処理レイヤー               │  │
│  │  ├─ pandas（フィルタリング）      │  │
│  │  ├─ Plotly（グラフ生成）          │  │
│  │  └─ geocache（座標ルックアップ）  │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

#### 6.3.2 コンポーネント構成

```
reflex_app/
├── reflex_app.py                # メインアプリケーション
├── state.py                     # State定義
├── pages/
│   ├── __init__.py
│   ├── home.py                  # ホームページ
│   └── dashboard.py             # ダッシュボードページ
├── components/
│   ├── __init__.py
│   ├── sidebar.py               # サイドバーコンポーネント
│   ├── tabs.py                  # タブコンポーネント
│   └── charts.py                # チャートコンポーネント
├── utils/
│   ├── __init__.py
│   ├── data_loader.py           # CSVロード
│   ├── data_processor.py        # データ処理
│   └── geocache.py              # geocache管理
├── assets/
│   ├── geocache.json            # ジオコーディングキャッシュ
│   └── styles.css               # カスタムスタイル
├── tests/
│   ├── test_state.py
│   ├── test_data_loader.py
│   └── test_charts.py
├── requirements.txt
├── .gitignore
└── README.md
```

---

## 7. 品質要件

### 7.1 テスト要件

#### 7.1.1 テストレベル

| レベル | テスト対象 | ツール | カバレッジ目標 | 実施タイミング |
|--------|-----------|--------|---------------|---------------|
| ユニットテスト | 関数、メソッド | pytest | 80%+ | コミット前 |
| 統合テスト | コンポーネント間連携 | pytest | 70%+ | PR作成時 |
| E2Eテスト | エンドツーエンド | Playwright | 主要フロー100% | デプロイ前 |
| 負荷テスト | パフォーマンス | Locust | 10ユーザー成功 | リリース前 |
| ユーザビリティテスト | UI/UX | 手動テスト | N/A | リリース前 |

#### 7.1.2 テストケース設計（例: FR-101）

| TC-ID | カテゴリ | シナリオ | 入力 | 期待結果 | 優先度 |
|-------|---------|---------|------|---------|--------|
| TC-101-01 | 正常系 | 正しいCSVアップロード | 2.1MB, 20,590行, UTF-8 | 2秒以内、20,590行読み込み | 高 |
| TC-101-02 | 異常系 | ファイル形式エラー | .xlsx | "ファイル形式が不正です"表示 | 高 |
| TC-101-03 | 異常系 | サイズ超過 | 15MB CSV | "ファイルサイズ超過"表示 | 中 |
| TC-101-04 | 異常系 | エンコーディングエラー | Shift-JIS | UTF-8変換または警告 | 中 |
| TC-101-05 | 異常系 | 列数不一致 | 30列CSV | "列数が一致しません"表示 | 高 |
| TC-101-06 | 境界値 | 最小サイズ | 1行CSV | ヘッダーのみ警告 | 低 |
| TC-101-07 | 境界値 | 最大サイズ | 10MB CSV（制限ギリギリ） | 正常読み込み | 中 |

### 7.2 コード品質基準

| 基準ID | 項目 | 目標値 | 測定方法 | ツール |
|--------|------|--------|---------|--------|
| CQ-001 | Pylintスコア | ≥8.0/10 | `pylint reflex_app/` | Pylint |
| CQ-002 | 関数複雑度 | McCabe ≤10 | Pylint | Pylint |
| CQ-003 | 関数行数 | ≤50行 | 手動レビュー | - |
| CQ-004 | コメント率 | ≥20% | `cloc --by-file` | cloc |
| CQ-005 | 型アノテーション | 100%（public関数） | mypy | mypy |
| CQ-006 | 重複コード | ≤5% | PMD-CPD | PMD |

### 7.3 ドキュメント要件

| ドキュメント | 内容 | 形式 | 更新頻度 |
|-------------|------|------|---------|
| README.md | プロジェクト概要、セットアップ手順 | Markdown | 機能追加時 |
| ARCHITECTURE.md | アーキテクチャ設計、コンポーネント構成 | Markdown | アーキテクチャ変更時 |
| API_REFERENCE.md | State、関数の詳細仕様 | Markdown | 関数追加時 |
| USER_GUIDE.md | ユーザー操作マニュアル | Markdown | UI変更時 |
| CHANGELOG.md | 変更履歴 | Markdown | リリース時 |
| requirements.txt | 依存ライブラリ | Text | ライブラリ変更時 |

---

## 8. 制約条件

### 8.1 技術的制約

| 制約ID | 制約内容 | 理由 | 影響 | 軽減策 |
|--------|---------|------|------|--------|
| TC-001 | Reflex v0.5.x使用 | 最新版、ドキュメント不足 | 開発速度低下リスク | Dashバックアップ、コミュニティ活用 |
| TC-002 | Python 3.10+必須 | Reflex要件 | 開発環境制約 | pyenv使用、複数バージョン管理 |
| TC-003 | WebSocket依存 | Reflexセッション管理 | ファイアウォール制約 | 社内ネットワーク調整 |
| TC-004 | ブラウザ制約 | Chrome/Edge最新版のみ | 他ブラウザ非対応 | エンドユーザーへ周知 |
| TC-005 | インメモリ処理 | State内キャッシュ | メモリ使用量大 | Render有料プラン検討 |

### 8.2 ビジネス制約

| 制約ID | 制約内容 | 理由 | 影響 | 対応 |
|--------|---------|------|------|------|
| BC-001 | 開発期間3日 | プロダクトオーナー要求 | Could機能削減 | Must機能のみ実装 |
| BC-002 | 予算$0 | コスト制約 | 無料ツールのみ | Render無料プラン、OSS活用 |
| BC-003 | 開発者1名 | リソース制約 | 開発速度制限 | 優先順位明確化、自動化 |
| BC-004 | 社内専用 | ビジネス方針 | 外部公開不要 | 認証機能省略可能 |

### 8.3 リソース制約

| 制約ID | 制約内容 | 制約値 | 影響 | 軽減策 |
|--------|---------|--------|------|--------|
| RC-001 | Renderメモリ | 512MB（無料プラン） | 10ユーザー以上で不安定 | 有料プラン$7/月に切替 |
| RC-002 | Render CPU | 共有CPU | 高負荷時遅延 | キャッシュ最適化 |
| RC-003 | Renderスリープ | 30分無アクセスでスリープ | 初回アクセス遅延10秒 | 定期pingまたは有料プラン |
| RC-004 | ファイルストレージ | 一時ファイルのみ | CSVアップロード都度処理 | DB移行検討（Phase 2） |

---

## 9. リスク分析

### 9.1 リスク識別

| リスクID | カテゴリ | リスク内容 | 確率 | 影響度 | リスクスコア | 優先度 |
|---------|---------|-----------|------|--------|-------------|--------|
| R-001 | 技術 | Reflexインストールエラー | 中 | 高 | 6 | 高 |
| R-002 | 技術 | Reflexバグ発見（v0.5.x新しさ） | 中 | 高 | 6 | 高 |
| R-003 | 技術 | ドキュメント不足による開発遅延 | 高 | 中 | 6 | 高 |
| R-004 | 技術 | パフォーマンス目標未達（5秒超過） | 低 | 中 | 2 | 低 |
| R-005 | ビジネス | 3日間での完成困難 | 中 | 高 | 6 | 高 |
| R-006 | リソース | Render無料プラン性能不足 | 中 | 中 | 4 | 中 |
| R-007 | セキュリティ | CSVインジェクション攻撃 | 低 | 中 | 2 | 低 |
| R-008 | ユーザビリティ | GASよりビジュアル劣る | 低 | 高 | 2 | 中 |

**リスクマトリクス**:
```
影響度
高 │  R-001  R-002  R-005  │  R-008
   │                       │
中 │  R-003  R-006         │  R-004  R-007
   │                       │
低 │                       │
   └───────────────────────┴────────
     低        中           高
            確率
```

### 9.2 リスク軽減策

#### R-001: Reflexインストールエラー

**軽減策**:
1. **事前検証**: プロジェクト開始前にクリーン環境でReflexインストールテスト
2. **代替案**: インストール失敗時は即座にDashへ切替（2日で実装可能）
3. **ドキュメント**: インストール手順を詳細化、トラブルシューティングガイド作成

**コンティンジェンシープラン**:
- Day 1午前中にインストール失敗判明→即座にDash切替決定
- Day 1-2でDash基本実装、Day 3でビジュアル調整

#### R-002: Reflexバグ発見

**軽減策**:
1. **早期発見**: Day 1でプロトタイプ作成、基本機能検証
2. **回避策検討**: バグ発見時は回避コード実装、GitHub Issue報告
3. **代替案**: 回避不可能な致命的バグはDash切替

**コンティンジェンシープラン**:
- Day 1でバグ発見→Day 2午前に回避策実装試行
- 回避不可能→Day 2午後からDash切替

#### R-003: ドキュメント不足

**軽減策**:
1. **コミュニティ活用**: Reflex公式Discord、GitHub Discussions参照
2. **ソースコード読解**: Reflex公式リポジトリのexamplesフォルダ参照
3. **試行錯誤**: 小規模プロトタイプで動作確認

#### R-005: 3日間完成困難

**軽減策**:
1. **優先順位明確化**: Must機能のみ実装、Could機能はPhase 2へ
2. **並行開発**: 独立機能を並行実装（例: 地図表示とタブ機能）
3. **テンプレート活用**: Reflexの公式テンプレート活用

**スコープ調整**:
- Day 2終了時点で進捗60%未満→Could機能（FR-600, FR-700）削減
- Day 3午前で進捗80%未満→地図表示機能（FR-400）削減

### 9.3 リスク監視計画

| リスクID | 監視指標 | 閾値 | 監視頻度 | 対応トリガー |
|---------|---------|------|---------|------------|
| R-001 | pip install成功/失敗 | 失敗 | Day 1開始時 | 即座にDash切替 |
| R-002 | バグ発見数 | ≥3件 | 日次 | 回避策検討会議 |
| R-003 | 未解決質問数 | ≥5件 | 日次 | コミュニティ質問 |
| R-005 | 進捗率（%） | <60%（Day 2終了時） | 日次 | スコープ削減 |
| R-006 | メモリ使用量 | >400MB（10ユーザー時） | Day 3負荷テスト | 有料プラン切替 |

---

## 10. 成功基準

### 10.1 プロジェクト成功の定義

**必須条件（Must）**:
1. ✅ 初回ロード時間5秒以内達成
2. ✅ 10ユーザー同時利用成功率100%
3. ✅ GAS全機能（10タブ、11種類row_type）完全再現
4. ✅ ビジュアル品質: ユーザー満足度≥4.0/5.0
5. ✅ 開発期間3日以内

**重要条件（Should）**:
1. ✅ Pylintスコア≥8.0/10
2. ✅ テストカバレッジ≥70%
3. ✅ セッションタイムアウト機能実装

**任意条件（Could）**:
1. データダウンロード機能（CSV）
2. 複数地域比較機能

### 10.2 KPIと測定方法

| KPI-ID | KPI名 | 目標値 | 測定方法 | 測定タイミング | 重要度 |
|--------|------|--------|---------|---------------|--------|
| KPI-001 | 初回ロード時間 | ≤5秒 | Chrome DevTools Performance | リリース前 | 必須 |
| KPI-002 | タブ切替時間 | ≤0.1秒 | Chrome Performance | リリース前 | 必須 |
| KPI-003 | 10ユーザー同時利用成功率 | 100% | Locust負荷テスト | リリース前 | 必須 |
| KPI-004 | 機能完全性 | 100%（10タブ、11row_type） | 手動検証 | リリース前 | 必須 |
| KPI-005 | ユーザー満足度 | ≥4.0/5.0 | UATアンケート | リリース後1週間 | 必須 |
| KPI-006 | Pylintスコア | ≥8.0/10 | `pylint reflex_app/` | コミット時 | 重要 |
| KPI-007 | テストカバレッジ | ≥70% | `pytest --cov` | PR作成時 | 重要 |
| KPI-008 | エラー率 | 0% | ログ監視 | 運用開始後 | 重要 |
| KPI-009 | CSVダウンロード機能 | 実装完了 | 手動検証 | Phase 2 | 任意 |

### 10.3 受入基準

#### 10.3.1 機能受入基準

| 機能ID | 受入基準 | 検証方法 | 合格条件 |
|--------|---------|---------|---------|
| FR-101 | CSVアップロード | 手動テスト（5ファイル） | 全5ファイル成功 |
| FR-201 | 都道府県選択 | 手動テスト（47都道府県） | 全47都道府県動作 |
| FR-301-310 | 10タブ可視化 | 手動テスト（各タブ） | 全10タブ表示成功 |
| FR-401 | バブルマップ | 手動テスト（3都道府県） | 全3都道府県表示成功 |
| FR-501 | State独立 | 10ブラウザテスト | データ混在なし |

#### 10.3.2 非機能受入基準

| NFR-ID | 受入基準 | 検証方法 | 合格条件 |
|--------|---------|---------|---------|
| NFR-101 | 初回ロード≤5秒 | Chrome Performance（10回測定） | 平均≤5秒、最大≤6秒 |
| NFR-102 | タブ切替≤0.1秒 | Chrome Performance（100回測定） | 平均≤0.1秒、最大≤0.15秒 |
| NFR-201 | 10ユーザー同時 | Locust負荷テスト（5分間） | エラー率0%、レスポンスタイム≤0.2秒 |
| NFR-401 | 学習コスト≤5分 | UATテスト（5名） | 全員5分以内達成 |

---

## 11. 要件トレーサビリティマトリクス

### 11.1 ビジネス要求→機能要件

| ビジネス要求 | 関連FR | 優先度 | 実装状況 |
|------------|--------|--------|---------|
| B-001: パフォーマンス50倍改善 | FR-101, FR-102, NFR-101-109 | Must | 🟡 実装予定 |
| B-002: 10ユーザー同時利用 | FR-501, FR-502, FR-503 | Must | 🟡 実装予定 |
| B-003: GAS全機能再現 | FR-301-310, FR-401-402 | Must | 🟡 実装予定 |
| B-004: ビジュアル品質向上 | NFR-401-404, UI/UX要件 | Must | 🟡 実装予定 |
| B-005: 保守性向上 | NFR-501-504, 技術要件 | Should | 🟡 実装予定 |
| B-006: データダウンロード | FR-601, FR-602 | Could | ⚪ Phase 2 |
| B-007: 複数地域比較 | FR-701, FR-702 | Could | ⚪ Phase 2 |

### 11.2 機能要件→テストケース

| FR-ID | TC-ID | テストレベル | 実装状況 |
|-------|-------|-------------|---------|
| FR-101 | TC-101-01～07 | ユニット、統合 | 🟡 実装予定 |
| FR-102 | TC-102-01～03 | ユニット | 🟡 実装予定 |
| FR-201 | TC-201-01～03 | 統合 | 🟡 実装予定 |
| FR-202 | TC-202-01～04 | 統合 | 🟡 実装予定 |
| FR-301 | TC-301-01～04 | E2E | 🟡 実装予定 |
| FR-501 | TC-501-01～03 | 負荷テスト | 🟡 実装予定 |

### 11.3 非機能要件→検証方法

| NFR-ID | 検証方法 | ツール | 実施タイミング |
|--------|---------|--------|---------------|
| NFR-101 | パフォーマンステスト | Chrome DevTools | Day 3 |
| NFR-201 | 負荷テスト | Locust | Day 3 |
| NFR-301-304 | セキュリティテスト | OWASP ZAP | Day 3 |
| NFR-401-404 | ユーザビリティテスト | 手動テスト | リリース前 |
| NFR-501-504 | コードレビュー | Pylint, mypy | 日次 |

---

## 12. MECE準拠性評価

### 12.1 MECE評価チェックリスト

#### 12.1.1 相互排他性（Mutually Exclusive）検証

| 検証項目 | 評価 | 重複の有無 | 備考 |
|---------|------|-----------|------|
| FR-100～FR-700の階層 | ✅ 合格 | 重複なし | データ管理、地域選択、可視化、地図、セッション、ダウンロード、比較で分離 |
| NFR-100～NFR-600の階層 | ✅ 合格 | 重複なし | パフォーマンス、スケーラビリティ、セキュリティ、ユーザビリティ、保守性、互換性で分離 |
| In-Scope vs Out-of-Scope | ✅ 合格 | 重複なし | 明確に分離、グレーゾーンなし |
| Must/Should/Could/Won't | ✅ 合格 | 重複なし | MoSCoW基準で明確分類 |

#### 12.1.2 完全網羅性（Collectively Exhaustive）検証

| 検証項目 | 評価 | 漏れの有無 | 備考 |
|---------|------|-----------|------|
| 機能要件の網羅性 | ✅ 合格 | 漏れなし | GAS全機能（10タブ、11row_type）すべてカバー |
| 非機能要件の網羅性 | ✅ 合格 | 漏れなし | ISO 25010品質特性をカバー |
| データ要件の網羅性 | ✅ 合格 | 漏れなし | 36列すべての定義、11row_typeすべて定義 |
| リスクの網羅性 | ✅ 合格 | 漏れなし | 技術、ビジネス、リソースリスクをカバー |
| ステークホルダーの網羅性 | ✅ 合格 | 漏れなし | PO、開発、ユーザー、レビュアー、運用をカバー |

### 12.2 要件定義書の完全性評価

| 評価項目 | 配点 | 得点 | 評価 |
|---------|------|------|------|
| **1. スコープ定義の明確性** | 10点 | 10点 | ✅ In-Scope/Out-Scopeが階層構造で明確 |
| **2. 機能要件の詳細度** | 20点 | 19点 | ⚠️ FR-602（Excel）の詳細やや不足 |
| **3. 非機能要件の測定可能性** | 20点 | 20点 | ✅ すべてのNFRに数値目標あり |
| **4. データ要件の完全性** | 10点 | 10点 | ✅ 36列、11row_typeすべて定義 |
| **5. リスク分析の網羅性** | 10点 | 9点 | ⚠️ ユーザビリティリスクやや少ない |
| **6. 成功基準の明確性** | 10点 | 10点 | ✅ KPI、受入基準が具体的 |
| **7. トレーサビリティ** | 10点 | 10点 | ✅ ビジネス要求→FR→TCまで追跡可能 |
| **8. MECE準拠** | 10点 | 9点 | ⚠️ 一部細分化不足（FR-300の10タブ） |
| **合計** | **100点** | **97点** | **A評価（優秀）** |

### 12.3 改善推奨事項

| 改善ID | 項目 | 現状の課題 | 改善提案 | 優先度 |
|--------|------|-----------|---------|--------|
| I-001 | FR-300 | 10タブが単一FR内 | 各タブを独立FRに分離（FR-301-1～FR-310-1） | 低 |
| I-002 | FR-602 | Excel実装詳細不足 | openpyxl使用方法の詳細化 | 低 |
| I-003 | NFR-400 | ユーザビリティ基準やや抽象的 | SUS（System Usability Scale）導入 | 中 |
| I-004 | リスク分析 | ユーザビリティリスク少ない | R-009追加: 「GASより操作性劣る」リスク | 低 |

**総合評価**: **97/100点（A評価）** - 本要件定義書はMECE準拠であり、プロジェクト実施に十分な品質を満たしています。

---

## 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロダクトオーナー | [氏名] | YYYY-MM-DD | __________ |
| 開発リーダー | [氏名] | YYYY-MM-DD | __________ |
| 技術レビュアー | [氏名] | YYYY-MM-DD | __________ |

---

**文書履歴**:

| バージョン | 日付 | 変更内容 | 変更者 |
|-----------|------|---------|--------|
| 1.0 | 2025-11-12 | 初版作成 | Claude Code |

---

**添付資料**:

1. フレームワーク比較ドキュメント（`WEB_FRAMEWORK_COMPARISON.md`）
2. GASバグ修正レポート（`MAPCOMPLETE_INTEGRATION_DEBUG_REPORT.md`）
3. 移行計画書（`DASHBOARD_MIGRATION_PLAN.md`）
4. Streamlitプロトタイプ評価レポート

---

**END OF DOCUMENT**
