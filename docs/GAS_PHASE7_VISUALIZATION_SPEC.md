# GAS Phase 7 可視化仕様書

## 概要

Phase 7の5つのCSVファイルをGoogle Apps Script（GAS）で可視化し、インタラクティブなダッシュボードを提供します。

---

## 実装方針

### 1. データインポート方式
- **方式**: PythonCSVImporter.gsを拡張
- **保存先**: 専用シート「Phase7_SupplyDensity」「Phase7_QualificationDist」等
- **メニュー**: 「📊 データ処理 > 🐍 Python連携 > Phase 7データ取り込み」

### 2. 可視化方式
- **方式1**: Google Charts API（リアルタイム、インタラクティブ）
- **方式2**: 条件付き書式（シート内ヒートマップ）
- **方式3**: HTMLダッシュボード（統合ビュー）

### 3. メニュー構成
```
📊 データ処理
├── 🐍 Python連携
│   ├── 📥 Python結果CSVを取り込み（既存）
│   ├── 📄 処理済みCSVを一括インポート（既存）
│   ├── 📊 Phase 7データ取り込み（NEW）
│   └── 📈 Phase 7ダッシュボード表示（NEW）
└── 📈 Phase 7高度分析（NEW）
    ├── 🗺️ 人材供給密度マップ
    ├── 🎓 資格別人材分布
    ├── 👥 年齢層×性別クロス分析
    ├── 🚗 移動許容度分析
    └── 📊 ペルソナ詳細プロファイル
```

---

## CSV別可視化仕様

### 1. SupplyDensityMap.csv - 人材供給密度マップ

**データ構造:**
| カラム | 型 | 例 |
|--------|----|----|
| 市区町村 | String | 沖縄県那覇市 |
| 求職者数 | Number | 150 |
| 資格保有率 | Number (0-1) | 0.65 |
| 平均年齢 | Number | 35.2 |
| 緊急度 | Number (0-1) | 0.42 |
| 総合スコア | Number | 78.5 |
| ランク | String (S/A/B/C/D) | A |

**可視化1: バブルチャート**
- **X軸**: 求職者数
- **Y軸**: 総合スコア
- **バブルサイズ**: 求職者数
- **色**: ランク（S=金、A=青、B=緑、C=橙、D=灰）
- **ツールチップ**: 市区町村、全データ

**可視化2: ランク別地域リスト**
- **テーブル**: ランクでグループ化
- **条件付き書式**: ランク別背景色
- **ソート**: 総合スコア降順

**可視化3: ヒートマップ**
- **行**: 市区町村
- **列**: 求職者数、資格保有率、平均年齢、緊急度、総合スコア
- **色**: 値の大小で緑→黄→赤

**GAS関数:**
```javascript
function showSupplyDensityMap() {
  // 1. データ読み込み
  // 2. バブルチャート生成
  // 3. HTMLダイアログ表示
}
```

---

### 2. QualificationDistribution.csv - 資格別人材分布

**データ構造:**
| カラム | 型 | 例 |
|--------|----|----|
| 資格カテゴリ | String | 介護福祉士 |
| 総保有者数 | Number | 320 |
| 分布TOP3 | String | 那覇市(50名); 浦添市(35名); 沖縄市(28名) |
| 希少地域TOP3 | String | 石垣市(2.1%); 宮古島市(3.5%); 名護市(4.2%) |

**可視化1: 横棒グラフ**
- **X軸**: 総保有者数
- **Y軸**: 資格カテゴリ
- **ソート**: 保有者数降順
- **色**: カテゴリ別グラデーション

**可視化2: 分布TOP3テーブル**
- **カラム**: 資格カテゴリ、TOP3地域
- **条件付き書式**: 保有者数に応じた色

**可視化3: 希少地域アラート**
- **フィルター**: 希少地域のみ表示
- **ハイライト**: 保有率5%未満を赤色

**GAS関数:**
```javascript
function showQualificationDistribution() {
  // 1. データ読み込み
  // 2. 横棒グラフ生成
  // 3. TOP3テーブル作成
  // 4. HTMLダイアログ表示
}
```

---

### 3. AgeGenderCrossAnalysis.csv - 年齢層×性別クロス分析

**データ構造:**
| カラム | 型 | 例 |
|--------|----|----|
| 市区町村 | String | 沖縄県那覇市 |
| 総求職者数 | Number | 150 |
| 支配的セグメント | String | 中年層-F |
| 若年女性比率 | Number (0-1) | 0.25 |
| 中年女性比率 | Number (0-1) | 0.35 |
| ダイバーシティスコア | Number (0-1) | 0.72 |

**可視化1: 積み上げ棒グラフ**
- **X軸**: 市区町村
- **Y軸**: 求職者数（100%）
- **色**: 若年女性（青）、中年女性（緑）、その他（灰）

**可視化2: ダイバーシティスコアヒートマップ**
- **行**: 市区町村
- **列**: ダイバーシティスコア
- **色**: 0.8以上=緑、0.5-0.8=黄、0.5未満=赤

**可視化3: 支配的セグメント円グラフ**
- **セグメント**: 若年層-F、中年層-F、準高齢層-F等
- **値**: 該当地域数

**GAS関数:**
```javascript
function showAgeGenderCrossAnalysis() {
  // 1. データ読み込み
  // 2. 積み上げ棒グラフ生成
  // 3. ダイバーシティヒートマップ作成
  // 4. HTMLダイアログ表示
}
```

---

### 4. MobilityScore.csv - 移動許容度スコアリング

**データ構造:**
| カラム | 型 | 例 |
|--------|----|----|
| 申請者ID | Number | 1 |
| 希望地数 | Number | 3 |
| 最大移動距離km | Number | 25.3 |
| 移動許容度スコア | Number (0-100) | 65.2 |
| 移動許容度レベル | String (A/B/C/D) | B |
| 移動許容度 | String | 中距離OK |
| 居住地 | String | 沖縄県那覇市 |

**可視化1: ヒストグラム（スコア分布）**
- **X軸**: 移動許容度スコア（0-100、10刻み）
- **Y軸**: 求職者数
- **色**: レベル別（A=青、B=緑、C=橙、D=灰）

**可視化2: 円グラフ（レベル別割合）**
- **セグメント**: 広域移動OK、中距離OK、近距離のみ、地元限定
- **値**: 各レベルの人数
- **色**: レベル別カラー

**可視化3: 移動距離散布図**
- **X軸**: 希望地数
- **Y軸**: 最大移動距離km
- **色**: レベル別
- **ツールチップ**: 申請者ID、居住地

**可視化4: 居住地別平均スコア**
- **テーブル**: 居住地、平均スコア、人数
- **ソート**: 平均スコア降順

**GAS関数:**
```javascript
function showMobilityScoreAnalysis() {
  // 1. データ読み込み
  // 2. ヒストグラム生成
  // 3. 円グラフ生成
  // 4. 散布図生成
  // 5. HTMLダッシュボード表示
}
```

---

### 5. DetailedPersonaProfile.csv - ペルソナ詳細プロファイル

**データ構造:**
| カラム | 型 | 例 |
|--------|----|----|
| セグメントID | Number | 0 |
| ペルソナ名 | String | 中堅キャリア層 |
| 人数 | Number | 320 |
| 構成比 | Number (0-1) | 0.35 |
| 平均年齢 | Number | 42.5 |
| 女性比率 | Number (0-1) | 0.68 |
| 資格保有率 | Number (0-1) | 0.72 |
| 平均資格数 | Number | 1.8 |
| 平均希望地数 | Number | 2.3 |
| 緊急度 | Number (0-1) | 0.45 |
| 主要居住地TOP3 | String | 那覇市(50名); 浦添市(35名) |
| 特徴 | String | 中年層中心・女性多数・高資格保有 |

**可視化1: レーダーチャート（ペルソナ別特性）**
- **軸**: 平均年齢、女性比率、資格保有率、平均資格数、平均希望地数、緊急度
- **系列**: 各ペルソナ
- **色**: ペルソナ別

**可視化2: ペルソナ比較テーブル**
- **行**: ペルソナ名
- **列**: 全カラム
- **条件付き書式**: 値の大小で色分け
- **ソート**: 人数降順

**可視化3: 構成比円グラフ**
- **セグメント**: ペルソナ名
- **値**: 人数
- **ラベル**: 構成比（%）

**可視化4: 特徴一覧**
- **カード形式**: ペルソナごとにカード
- **内容**: ペルソナ名、人数、構成比、特徴、主要居住地

**GAS関数:**
```javascript
function showDetailedPersonaProfile() {
  // 1. データ読み込み
  // 2. レーダーチャート生成
  // 3. 比較テーブル作成
  // 4. 円グラフ生成
  // 5. HTMLダッシュボード表示
}
```

---

## 統合ダッシュボード仕様

### Phase 7 統合ダッシュボード (HTML)

**レイアウト:**
```
┌─────────────────────────────────────────┐
│ Phase 7 高度分析ダッシュボード           │
├─────────────────────────────────────────┤
│ [タブ1: 概要] [タブ2: 地域分析]         │
│ [タブ3: 資格分析] [タブ4: 移動分析]     │
│ [タブ5: ペルソナ分析]                   │
├─────────────────────────────────────────┤
│ タブ1: 概要                              │
│ ┌─────────┐ ┌─────────┐               │
│ │ KPI1    │ │ KPI2    │               │
│ │ 総求職者 │ │ 平均スコア│               │
│ └─────────┘ └─────────┘               │
│ ┌─────────────────────────────┐       │
│ │ 人材供給密度マップ（バブル）  │       │
│ └─────────────────────────────┘       │
├─────────────────────────────────────────┤
│ [データ更新] [エクスポート] [閉じる]     │
└─────────────────────────────────────────┘
```

**タブ構成:**
1. **概要タブ**: KPI + 人材供給密度マップ
2. **地域分析タブ**: 年齢層×性別クロス分析
3. **資格分析タブ**: 資格別人材分布
4. **移動分析タブ**: 移動許容度スコアリング
5. **ペルソナ分析タブ**: ペルソナ詳細プロファイル

**GAS関数:**
```javascript
function showPhase7Dashboard() {
  // 1. 全データ読み込み
  // 2. HTML生成
  // 3. Google Charts埋め込み
  // 4. モーダルダイアログ表示
}
```

---

## 実装優先順位

### Phase 1（必須）:
1. **CSVインポート機能** - Phase 7の5ファイルを専用シートに取り込み
2. **人材供給密度マップ** - バブルチャート + ランク別テーブル
3. **移動許容度分析** - ヒストグラム + 円グラフ

### Phase 2（推奨）:
4. **ペルソナ詳細プロファイル** - レーダーチャート + 比較テーブル
5. **年齢層×性別クロス分析** - 積み上げ棒グラフ

### Phase 3（オプション）:
6. **資格別人材分布** - 横棒グラフ
7. **統合ダッシュボード** - HTML版

---

## 技術仕様

### 使用ライブラリ:
- **Google Charts API** (可視化)
- **Google Apps Script** (バックエンド)
- **HTML Service** (UI)

### データ保存先:
- **シート名規則**: `Phase7_{機能名}`
  - `Phase7_SupplyDensity`
  - `Phase7_QualificationDist`
  - `Phase7_AgeGenderCross`
  - `Phase7_MobilityScore`
  - `Phase7_PersonaProfile`

### ファイル構成:
```
gas_files/
├── scripts/
│   ├── Phase7DataImporter.gs（NEW）
│   ├── Phase7SupplyDensityViz.gs（NEW）
│   ├── Phase7MobilityScoreViz.gs（NEW）
│   ├── Phase7PersonaProfileViz.gs（NEW）
│   ├── Phase7AgeGenderCrossViz.gs（NEW）
│   ├── Phase7QualificationDistViz.gs（NEW）
│   └── Phase7MenuIntegration.gs（NEW）
└── html/
    ├── Phase7Dashboard.html（NEW）
    ├── Phase7SupplyDensityChart.html（NEW）
    ├── Phase7MobilityScoreChart.html（NEW）
    └── Phase7PersonaProfileChart.html（NEW）
```

---

## 次のステップ

1. **Phase 7データインポート機能実装** (`Phase7DataImporter.gs`)
2. **人材供給密度マップ実装** (`Phase7SupplyDensityViz.gs`)
3. **移動許容度分析実装** (`Phase7MobilityScoreViz.gs`)
4. **メニュー統合** (`Phase7MenuIntegration.gs`)
5. **動作テスト** (実データでの可視化確認)

---

## 補足: 既存機能との統合

### 既存メニューとの関係:
- **Phase 1-6**: 基礎集計、統計分析、ペルソナ、フロー分析
- **Phase 7**: 高度分析（密度マップ、資格分布、クロス分析、移動スコア、詳細ペルソナ）

### データフロー:
```
Python (run_complete.py)
  ↓
Phase 1-6 CSV + Phase 7 CSV (16ファイル)
  ↓
GAS (PythonCSVImporter.gs + Phase7DataImporter.gs)
  ↓
Google スプレッドシート (11シート + 5シート)
  ↓
GAS 可視化関数
  ↓
インタラクティブダッシュボード
```

---

## ビジネス価値

各可視化のビジネスインパクト:

| 可視化 | 意思決定 | ROI |
|--------|---------|-----|
| 人材供給密度マップ | 広告予算配分 | 高 |
| 資格別人材分布 | ターゲティング精度向上 | 中 |
| 年齢層×性別クロス | メッセージング最適化 | 中 |
| 移動許容度分析 | リモート求人戦略 | 高 |
| ペルソナ詳細プロファイル | 営業提案精度向上 | 高 |
