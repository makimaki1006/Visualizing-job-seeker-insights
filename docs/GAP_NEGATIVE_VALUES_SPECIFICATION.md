# GAP列の負の値について（仕様説明）

**作成日**: 2025年11月12日
**ステータス**: ✅ 仕様確認完了

---

## 結論

**GAP列の負の値は正常な状態であり、修正不要です。**

---

## GAP列の意味

```
gap = demand_count - supply_count
```

### 値の解釈

| gap値 | 意味 | 状態 | 例 |
|-------|------|------|-----|
| **gap > 0** | 需要過多 | 人材不足 | demand=10, supply=3 → gap=7（7人不足） |
| **gap = 0** | 需給均衡 | バランス | demand=5, supply=5 → gap=0（均衡） |
| **gap < 0** | 供給過多 | 人材余剰 | demand=4, supply=6 → gap=-2（2人余剰） |

---

## 実際のデータ（26市町村で負の値）

### パターン1: 小規模な供給過多

| 都道府県 | 市町村 | demand | supply | gap | 解釈 |
|---------|--------|--------|--------|-----|------|
| 京都府 | 相楽郡笠置町 | 4 | 6 | **-2** | 2人の供給過多 |
| 奈良県 | 宇陀郡御杖村 | 1 | 2 | **-1** | 1人の供給過多 |
| 兵庫県 | 朝来市 | 4 | 5 | **-1** | 1人の供給過多 |
| 兵庫県 | 洲本市 | 2 | 3 | **-1** | 1人の供給過多 |

### パターン2: 需要0・供給1のケース（21市町村）

| 都道府県 | 市町村 | demand | supply | gap | 解釈 |
|---------|--------|--------|--------|-----|------|
| 福井県 | あわら市 | 0 | 1 | **-1** | 需要なし、供給あり |
| 千葉県 | 香取郡東庄町 | 0 | 1 | **-1** | 需要なし、供給あり |
| 和歌山県 | 伊都郡九度山町 | 0 | 1 | **-1** | 需要なし、供給あり |
| 和歌山県 | 有田市 | 0 | 1 | **-1** | 需要なし、供給あり |
| ...他17市町村... | - | 0 | 1 | **-1** | 需要なし、供給あり |

---

## ビジネス的意味

### 負のgapが示すこと

1. **地域の魅力不足**: その地域に希望勤務地として選ぶ求職者が少ない
2. **採用難易度低**: 人材余剰のため、採用しやすい
3. **競合少**: 他の企業と競合する必要が低い

### 正のgapが示すこと

1. **人気エリア**: 多くの求職者が希望勤務地として選ぶ
2. **採用難易度高**: 人材不足のため、採用が困難
3. **競合多**: 他の企業と人材獲得競争が激しい

---

## 修正履歴

### 誤った修正（BUG 5）

**以前の仕様誤解**:
```python
# fix_all_bugs.py BUG 5
df.loc[df['gap'] < 0, 'gap'] = 0  # 負の値を0にクリップ
```

**問題点**:
- gap < 0は異常値ではなく、**供給過多を示す正常な値**
- 0にクリップすると、需給均衡と誤解される
- ビジネス分析で誤った意思決定につながる

### 正しい対応（BUG 6修正）

**gap列の再計算**:
```python
# fix_gap_calculation.py
df.loc[df['row_type'] == 'GAP', 'gap'] = (
    df.loc[df['row_type'] == 'GAP', 'demand_count'] -
    df.loc[df['row_type'] == 'GAP', 'supply_count']
)
```

**結果**:
- demand < supply の場合、正しく gap < 0 を計算
- 26市町村で負の値が復元された
- ビジネス分析に正確な情報を提供

---

## GAS可視化での扱い

### 推奨表示方法

1. **カラーコーディング**:
   - 赤: gap > 0（人材不足）
   - 緑: gap = 0（均衡）
   - 青: gap < 0（人材余剰）

2. **ラベル表示**:
   - gap = 7 → 「7人不足」
   - gap = 0 → 「均衡」
   - gap = -2 → 「2人余剰」

3. **絶対値での並び替え**:
   - |gap|の大きい順に表示
   - 需要過多・供給過多の両方で注目すべき地域を強調

---

## 最終判断

**GAP列の負の値は仕様として正しく、修正不要**

- ✅ BUG 6（GAP計算不整合）の修正により、正しく計算されている
- ✅ demand_count - supply_count = gap が100%一致
- ✅ 負の値は供給過多を示す正常な状態

**`fix_all_bugs.py`のBUG 5は削除すべき**
- BUG 5の「負の値を0にクリップ」は仕様誤解
- 次回の修正では、BUG 5を削除し、BUG 1-4, 6のみを実施

---

**検証日**: 2025年11月12日
**検証者**: Claude Code（Ultrathink分析）
**ステータス**: ✅ 仕様確認完了、修正不要
