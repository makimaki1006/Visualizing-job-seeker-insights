# Phase 7 HTMLアップロード完全ガイド

**最終更新**: 2025年10月26日
**対象**: Phase 7高度分析機能のCSVインポート
**推奨方法**: HTMLアップロード（最も簡単）

---

## 📋 概要

Phase 7のデータインポートには**3つの方法**があります：

| 方法 | 難易度 | 推奨度 | 説明 |
|------|--------|--------|------|
| **📤 HTMLアップロード** | ⭐ 簡単 | ✅ 最推奨 | ブラウザから直接CSVをアップロード |
| **🚀 クイックインポート** | ⭐⭐ 普通 | ✅ 推奨 | Google Driveから自動インポート |
| **📂 手動インポート** | ⭐⭐⭐ やや難 | △ 非推奨 | Google Driveフォルダを手動作成 |

**このガイドでは最も簡単な「HTMLアップロード」を推奨します。**

---

## 🚀 方法1: HTMLアップロード（最も簡単）

### ステップ1: Pythonでデータ生成

```bash
cd "C:\Users\fuji1\OneDrive\Pythonスクリプト保管\job_medley_project\python_scripts"
python run_complete.py
```

**出力確認**:
```
C:\Users\fuji1\OneDrive\Pythonスクリプト保管\job_medley_project\python_scripts\gas_output_phase7\
├── SupplyDensityMap.csv          # 人材供給密度マップ
├── QualificationDistribution.csv # 資格別人材分布（データがある場合）
├── AgeGenderCrossAnalysis.csv    # 年齢層×性別クロス分析
├── MobilityScore.csv             # 移動許容度スコアリング
└── DetailedPersonaProfile.csv    # ペルソナ詳細プロファイル
```

### ステップ2: GASでHTMLアップロードダイアログを開く

1. Googleスプレッドシートを開く
2. メニュー: `📊 データ処理` → `📈 Phase 7高度分析` → `📥 データインポート` → `📤 HTMLアップロード（最も簡単）`

### ステップ3: CSVファイルをアップロード

**HTMLダイアログが表示されます**:

```
┌─────────────────────────────────────────────────────┐
│ 📈 Phase 7高度分析 - データアップロード               │
├─────────────────────────────────────────────────────┤
│                                                       │
│ 📋 アップロード手順                                   │
│ 1. Python で run_complete.py を実行                  │
│ 2. gas_output_phase7 フォルダから5つのCSVを選択       │
│ 3. 「アップロード開始」をクリック                      │
│                                                       │
├─────────────────────────────────────────────────────┤
│                                                       │
│  🗺️        🎓        👥        🚗        📊         │
│ 人材供給   資格別   年齢×性別  移動許容  ペルソナ     │
│ 密度マップ 人材分布  クロス分析 スコア    プロファイル │
│                                                       │
│ [ファイルを選択] [ファイルを選択] ...                 │
│                                                       │
├─────────────────────────────────────────────────────┤
│                                                       │
│ 選択済みファイル: 5 / 5                               │
│ 合計サイズ: 320.5 KB                                 │
│                                                       │
│        [🚀 アップロード開始]  [🔄 クリア]             │
│                                                       │
└─────────────────────────────────────────────────────┘
```

**操作**:

1. **各アイコンをクリック**してファイルを選択
   - 🗺️ 人材供給密度マップ → `SupplyDensityMap.csv`
   - 🎓 資格別人材分布 → `QualificationDistribution.csv` (オプション)
   - 👥 年齢×性別クロス → `AgeGenderCrossAnalysis.csv`
   - 🚗 移動許容度スコア → `MobilityScore.csv`
   - 📊 ペルソナプロファイル → `DetailedPersonaProfile.csv`

2. **または、ドラッグ&ドロップ**
   - CSVファイルを各アイコンにドラッグ&ドロップ

3. **アップロード開始をクリック**
   - プログレスバーが表示される
   - 自動的にシートが作成される
   - 完了後、ダイアログが自動で閉じる

### ステップ4: アップロード状況確認

メニュー: `📊 データ処理` → `📈 Phase 7高度分析` → `📥 データインポート` → `✅ アップロード状況確認`

**表示例**:
```
【Phase 7アップロード状況】

✅ Phase7_SupplyDensity
   OK
   データ: 42行 × 7列

✅ Phase7_AgeGenderCross
   OK
   データ: 42行 × 6列

✅ Phase7_MobilityScore
   OK
   データ: 7390行 × 7列

✅ Phase7_PersonaProfile
   OK
   データ: 10行 × 12列

すべてのシートが正常にアップロードされています！
可視化機能を使用できます。
```

---

## 🎯 方法2: Google Drive経由（従来方式）

### Google Drive不要でより簡単な方法1を推奨しますが、こちらも可能です。

**ステップ1**: Pythonでデータ生成（同上）

**ステップ2**: Google Driveにアップロード
1. Google Driveで `gas_output_phase7` フォルダを作成
2. 5つのCSVファイルをアップロード

**ステップ3**: GASでクイックインポート
- メニュー: `📊 データ処理` → `📈 Phase 7高度分析` → `📥 データインポート` → `🚀 クイックインポート（Google Drive）`

---

## 📊 アップロード後の使用方法

### 完全統合ダッシュボード（推奨）

メニュー: `📊 データ処理` → `📈 Phase 7高度分析` → `🎯 完全統合ダッシュボード`

**タブ構成**:
- 📋 概要（KPI表示）
- 🗺️ 人材供給密度マップ
- 🎓 資格別人材分布
- 👥 年齢層×性別クロス分析
- 🚗 移動許容度スコアリング
- 📊 ペルソナ詳細プロファイル

### 個別分析

メニュー: `📊 データ処理` → `📈 Phase 7高度分析` → `📊 個別分析`

各機能を個別に詳細表示

---

## 🔧 技術的詳細

### HTMLアップロードの仕組み

```
ブラウザ（HTMLフォーム）
    ↓ File API（ファイル読み込み）
JavaScriptでCSVパース
    ↓ BOM除去、改行処理
2次元配列に変換
    ↓ google.script.run
GASサーバー（importPhase7CSV関数）
    ↓ スプレッドシートAPI
Googleスプレッドシートに書き込み
```

### 対応ブラウザ

- ✅ Google Chrome（推奨）
- ✅ Firefox
- ✅ Microsoft Edge
- ✅ Safari

### ファイルサイズ制限

- **最大ファイルサイズ**: 50MB（GAS制限）
- **実際のPhase 7ファイル**: 通常500KB以下
- **制限に達することはほぼない**

---

## ❓ FAQ

### Q1: HTMLアップロードとGoogle Driveインポートの違いは？

**HTMLアップロード**:
- ✅ Google Drive不要
- ✅ ブラウザから直接アップロード
- ✅ 1クリックで完了
- ❌ ファイルを毎回選択する必要がある

**Google Driveインポート**:
- ✅ 一度アップロードすれば再利用可能
- ✅ 自動検出機能
- ❌ Google Driveへのアップロードが必要
- ❌ フォルダ作成が必要

### Q2: 資格別人材分布のCSVが生成されない

**原因**: データに資格情報が含まれていない

**対処法**: 問題ありません。HTMLアップロードでは必須ではありません。他の4ファイルのみアップロードしてください。

### Q3: アップロード中にエラーが発生した

**確認項目**:
1. ファイル名が正しいか（例: `SupplyDensityMap.csv`）
2. ファイルがUTF-8エンコーディングか
3. CSVファイルが破損していないか

**解決方法**:
1. Pythonで `run_complete.py` を再実行
2. 新しく生成されたCSVファイルで再度アップロード

### Q4: アップロード後、可視化が表示されない

**確認項目**:
1. アップロード状況確認でデータ件数を確認
2. ブラウザをリロード（F5）
3. データ検証を実行

**メニュー**: `📊 データ処理` → `📈 Phase 7高度分析` → `🔧 データ管理` → `✅ データ検証`

---

## 🎨 HTMLアップロードUIの特徴

### デザイン

- **グラデーション背景**: 紫のグラデーション（#667eea → #764ba2）
- **5つのドロップゾーン**: アイコン付き直感的UI
- **ドラッグ&ドロップ対応**: ファイルを直接ドロップ可能
- **リアルタイムフィードバック**: 選択状況を即座に表示
- **プログレスバー**: アップロード進行状況を視覚化

### ユーザビリティ

- **ワンストップ**: 1つのダイアログで完結
- **エラーハンドリング**: わかりやすいエラーメッセージ
- **自動クローズ**: 完了後、自動的にダイアログを閉じる
- **キャンセル機能**: いつでもクリア可能

---

## 📞 サポート

### トラブルシューティング

**問題が解決しない場合**:
1. ブラウザのコンソールログを確認（F12 → Console）
2. GASの実行ログを確認（Apps Script → 実行ログ）
3. Pythonの出力を再確認

### 関連ドキュメント

- **完全実装サマリー**: `PHASE7_COMPLETE_IMPLEMENTATION_SUMMARY.md`
- **E2Eテスト結果**: `GAS_E2E_TEST_REPORT.md`
- **クイックスタートガイド**: GASメニュー → `❓ Phase 7クイックスタート`

---

## ✅ チェックリスト

### アップロード前

- [ ] Pythonで `run_complete.py` を実行済み
- [ ] `gas_output_phase7` フォルダが存在
- [ ] 4-5個のCSVファイルが存在
- [ ] Googleスプレッドシートを開いている

### アップロード中

- [ ] HTMLアップロードダイアログを開いた
- [ ] 各CSVファイルを選択した
- [ ] 「アップロード開始」をクリックした
- [ ] プログレスバーが100%になった

### アップロード後

- [ ] アップロード状況確認で全シートOK
- [ ] 統合ダッシュボードが表示される
- [ ] 個別分析機能が使える
- [ ] データ検証が成功

---

**HTMLアップロード完了！これでPhase 7の全機能が使用可能です。** ✅
