# MapComplete ダッシュボード 完全ガイド

**医療・介護人材採用を、データで変える**

---

## 第1章: プロダクト概要

### 1.1 プロダクト名
MapComplete ダッシュボード（job_ap_analyzer_gui）

### 1.2 キャッチコピー
**「採用したい地域に、どんな求職者が、何人いるか」が一目で分かる**

### 1.3 一言説明
ジョブメドレーの求職者データを可視化し、データに基づいた戦略的採用活動を実現するダッシュボードアプリケーション。従来は「求人を出して、応募を待つ」だけだった採用活動を、データドリブンな戦略的採用に変革するツール。

### 1.4 本番URL
https://visualizationj-job-ap-analyzer-gui.onrender.com

### 1.5 データ規模
- 総求職者データ: 659,949人
- データベース行数: 1,336,297行
- カバレッジ: 全国47都道府県、1,700以上の市区町村

---

## 第2章: このシステムができること（6つの主要機能）

### 2.1 市場概況
求職者数、年齢分布、性別・雇用形態の可視化

**具体的な機能:**
- KPIカード表示（総求職者数、年齢中央値、女性比率）
- 年齢分布の棒グラフ（20代/30代/40代/50代/60代以上）
- 性別分布の円グラフ（男性/女性）
- 雇用形態分布の円グラフ（正職員/パート/派遣/その他）
- 都道府県TOP10ランキング
- 市区町村TOP10ランキング

**活用シーン:**
- 新規拠点の採用計画策定
- 年度採用目標の根拠作成
- 経営会議への報告資料作成

**得られる洞察の例:**
「京都市には介護職希望者が1,305人おり、40代女性が最多（23%）。パート希望が6割を占めるため、柔軟なシフト制度がアピールポイントになる」

### 2.2 人材属性
資格ランキング、ペルソナ分析、年齢×性別クロス

**具体的な機能:**
- 資格保有状況のランキング表示（全467種類対応）
- ペルソナ分析（年齢×性別の組み合わせ別人数）
- 年齢×性別クロス分析マトリックス
- 定着率分析
- 資格フラグ別統計

**活用シーン:**
- 採用ターゲットの絞り込み
- 求人原稿のペルソナ設定
- 資格要件の見直し検討

**得られる洞察の例:**
「介護福祉士保有者は全体の35%。50代女性に集中している。若手（20-30代）で介護福祉士を持つ人材は希少価値が高い」

### 2.3 移動パターン
地元志向/近隣移動/広域移動の割合、フロー分析

**具体的な機能:**
- 移動パターン円グラフ（地元志向/近隣移動/広域移動）
- 居住地→希望勤務地のフロー分析
- ペルソナシェア（地域内人材構成比）
- 希望勤務地TOP10
- co_desired フロー分析

**活用シーン:**
- 採用エリアの拡大検討
- 通勤手当・送迎バスの検討
- 近隣施設との差別化戦略

**得られる洞察の例:**
「この地域の求職者の49%は地元希望だが、34%は近隣市区町村への移動も可。隣の○○市からの採用を視野に入れれば、候補者が1.5倍に増加する」

### 2.4 レアリティ分析（人材組み合わせ検索）
年齢・性別・資格の組み合わせで人材検索

**具体的な機能:**
- 年代選択（20代/30代/40代/50代/60代以上、複数選択可）
- 性別選択（男性/女性/その他、複数選択可）
- 資格選択（467種類から複数選択可）
- 該当者数のリアルタイム表示
- 構成比（全体に占める割合）表示

**活用シーン:**
- 採用要件に合致する人材数の事前把握
- 条件緩和の効果シミュレーション
- 競合との獲得競争の見極め

**得られる洞察の例:**
「30代・男性・介護福祉士保有者」は該当45人（全体の0.3%）= 超希少人材
→ 条件を「40代まで」に広げると200人に増加。要件緩和の検討を推奨

### 2.5 需給バランス
需要と供給のギャップ可視化

**具体的な機能:**
- 需要（求人数）と供給（求職者数）の比較
- 需給ギャップの可視化
- 市場シェア分析
- 資格フラグ別定着率

**活用シーン:**
- 採用難易度の事前把握
- 条件設定の妥当性検証
- 競合分析

### 2.6 地図機能
求人地図、人材地図

**具体的な機能:**
- 求人地図（Google Apps Script連携、新しいタブで表示）
- 人材地図（NiceGUI Leaflet統合、開発中）
- 都道府県・市区町村レベルのマーカー表示
- 流入元可視化（計画中）
- 流出/流入バランス表示（計画中）

---

## 第3章: 効果・役立つ理由

### 3.1 採用担当者の悩みと解決策

| 従来の悩み | このツールで解決 |
|-----------|-----------------|
| 「うちの地域に人材はいる？」 | 数値で把握可能（例: 東京都132,690人） |
| 「どの資格が多い？」 | ランキングで可視化（467種類対応） |
| 「隣の市から来てくれる？」 | 移動パターン分析（地元/近隣/広域の割合） |
| 「採用条件が厳しすぎる？」 | レアリティ分析で検証（該当者数を即時表示） |
| 「競合と比べて採用しやすい？」 | 需給バランスで判定 |

### 3.2 導入効果

#### 採用コスト削減
- **無駄な求人出稿の削減**: 人材がいない地域への出稿を事前に回避
- **ターゲット精度向上**: 実在する人材層に絞った訴求
- **採用期間短縮**: データに基づく迅速な意思決定

#### 採用成功率向上
- **競合分析**: 需給バランスで採用難易度を事前把握
- **条件最適化**: 市場に合った給与・条件設定
- **エリア戦略**: 移動パターンを考慮した広域採用

#### 経営判断の高度化
- **新規拠点判断**: 人材確保可能性を事前検証
- **事業計画策定**: 採用計画の数値的根拠
- **取締役会報告**: データに基づく客観的説明

---

## 第4章: 想定ユーザー

### 4.1 プライマリターゲット

| 業種 | 役職 | 課題 |
|------|------|------|
| 医療法人 | 採用担当 | 看護師・介護士の慢性的不足 |
| 介護施設 | 施設長 | 新規開設時の人材確保 |
| 訪問介護事業所 | エリアマネージャー | 地域ごとの人材把握が困難 |

### 4.2 セカンダリターゲット

| 業種 | 役職 | 課題 |
|------|------|------|
| 人材紹介会社 | コンサルタント | 提案の説得力向上 |
| 自治体 | 福祉担当 | 地域の人材動向把握 |
| コンサルティングファーム | 医療・介護担当 | M&A・再編時のデューデリジェンス |

---

## 第5章: 競合との差別化

| 比較項目 | 求人サイト管理画面 | 市場調査レポート | このツール |
|---------|-------------------|-----------------|-----------|
| データ鮮度 | 応募者のみ | 年1回更新 | リアルタイム |
| 地域粒度 | 都道府県まで | 地方ブロック | 市区町村単位 |
| 資格分析 | なし | 主要資格のみ | 全467資格対応 |
| 操作性 | 複雑 | PDF固定 | インタラクティブ |
| コスト | 月額数万円〜 | 数十万円/回 | 低コスト |

---

## 第6章: 技術アーキテクチャ

### 6.1 技術スタック

| レイヤー | 技術 | 詳細 |
|---------|------|------|
| フロントエンド | NiceGUI | Python製WebUIフレームワーク（1.4.0以上） |
| バックエンド | Python 3.11 | pandas（2.0以上）、httpx（0.25以上） |
| データベース | Turso (libSQL) | クラウドSQLite、無料プラン対応 |
| ホスティング | Render | Starterプラン（$7/月） |
| 認証 | メール + ドメイン制限 | f-a-c.co.jp / cyxen.co.jp ドメイン限定 |
| 外部連携 | Google Apps Script | 求人地図機能の連携 |

### 6.2 システム構成図

```
┌─────────────────────────────────────────────────────────┐
│                    Render ($7/月)                       │
│  ┌───────────────────────────────────────────────────┐ │
│  │              NiceGUI App (main.py)                │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌───────────┐ │ │
│  │  │ ログイン    │→│ ダッシュボード│→│ 各種分析  │ │ │
│  │  └─────────────┘  └─────────────┘  └───────────┘ │ │
│  │                        ↓                          │ │
│  │              db_helper.py (キャッシュ層)           │ │
│  └───────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
                            ↓ HTTPS
┌─────────────────────────────────────────────────────────┐
│                 Turso Database (無料枠)                 │
│  ┌───────────────────────────────────────────────────┐ │
│  │ job_seeker_data テーブル (1,336,297行)            │ │
│  │ インデックス: prefecture, municipality, row_type  │ │
│  └───────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 6.3 データフロー

```
生CSV (659,949行)
    ↓ turso_fast_import.py（重複除去処理込み）
Turso Database (1,336,297行)
    ↓ HTTP API (libsql)
db_helper.py (2層キャッシュ)
    ↓ 永続キャッシュ
NiceGUI State
    ↓ リアクティブ更新
ブラウザ表示
```

### 6.4 データベース設計

#### テーブル構造
```sql
CREATE TABLE job_seeker_data (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    row_type TEXT,           -- データ種別（APPLICANT, DESIRED, MAP_METRICS等）
    prefecture TEXT,         -- 都道府県
    municipality TEXT,       -- 市区町村
    age TEXT,                -- 年齢
    gender TEXT,             -- 性別
    employment_status TEXT,  -- 雇用形態
    qualifications TEXT,     -- 保有資格
    qualification_count INTEGER,
    desired_salary TEXT,     -- 希望給与
    desired_workstyle TEXT,  -- 希望勤務形態
    mobility_pattern TEXT,   -- 移動パターン
    count INTEGER,           -- 集計値
    percentage REAL,         -- 割合
    lat REAL,                -- 緯度（マップ用）
    lng REAL                 -- 経度（マップ用）
);
```

#### インデックス
| インデックス名 | カラム | 用途 |
|---------------|--------|------|
| idx_prefecture | prefecture | 都道府県フィルタ |
| idx_municipality | prefecture, municipality | 市区町村フィルタ |
| idx_row_type | row_type | データ種別フィルタ |
| idx_pref_type | prefecture, row_type | 複合フィルタ |

#### row_type一覧（15種以上）
| row_type | 説明 | 件数目安 |
|----------|------|---------|
| APPLICANT | 求職者基本情報 | 数万件 |
| DESIRED | 希望勤務地 | 数十万件 |
| MAP_METRICS | 地図用集計 | 数千件 |
| FLOW_EDGE | 移動フロー | 数千件 |
| WORKSTYLE_MOBILITY | 雇用形態×移動距離 | 135,422件 |
| PREFECTURE_SUMMARY | 都道府県サマリー | 47件 |
| MUNICIPALITY_SUMMARY | 市区町村サマリー | 1,896件 |
| QUALIFICATION_PERSONA | 資格×ペルソナ | 56,715件 |
| QUALIFICATION_DETAIL | 資格詳細 | 23,006件 |
| RESIDENCE_FLOW | 居住地→希望勤務地 | 多数 |
| DESIRED_AREA_PATTERN | 希望勤務地パターン | 多数 |
| URGENCY_DISTRIBUTION | 緊急度分布 | 5,439件 |

### 6.5 キャッシュ戦略

#### 2層キャッシュ構成
```python
# レガシーキャッシュ（TTL付き）
_cache: dict = {}           # 30分TTL、最大100件
_cache_time: dict = {}

# 永続キャッシュ（TTLなし）
_static_cache: dict = {
    "prefectures": None,        # 都道府県リスト
    "municipalities": {},       # 都道府県→市区町村
    "filtered_data": {},        # 地域別データ
}
```

#### キャッシュ効果
100人が同時に「東京都」を選択しても、DBクエリは初回の1回のみ。

---

## 第7章: データパイプライン

### 7.1 Python処理フロー

#### 入力CSVの主要カラム
| カラム | 例 | 意味 |
|--------|-----|------|
| member_id | ID_1234 | 候補者の一意ID |
| age_gender | 49歳 女性 | 年齢・性別の混在表記 |
| location | 京都府京都市左京区 | 現住所 |
| status | 在職中 | 就業状況 |
| employment_status | 契約社員 | 雇用形態 |
| desired_area | 京都府京都市/大阪府大阪市 | 希望勤務地リスト |
| desired_workstyle | 日勤のみ | 希望勤務形態 |
| desired_start | 今すぐに / 2025/12 | 入社希望時期 |
| qualifications | 介護福祉士, 実務者研修 | 資格リスト |

#### 処理ステップ
| ステップ | モジュール | 主な処理内容 |
|---------|----------|-------------|
| 正規化 | DataNormalizer | 住所分解、希望勤務地配列化、緊急度・資格算出 |
| 品質検証 | DataQualityValidator | 欠損・サンプル数チェック、品質判定 |
| Phase別エクスポート | JobMedleyAnalyzerV2 | Phase1/2/3/6/7/8/10のCSV生成 |
| geocache管理 | JobMedleyAnalyzerV2 | 座標キャッシュ管理 |

### 7.2 出力ファイル一覧

#### Phase1（基礎集計）
- Applicants.csv: 申請者基本情報
- DesiredWork.csv: 希望勤務地詳細
- AggDesired.csv: 希望勤務地集計
- MapMetrics.csv: 座標付き集計

#### Phase2（統計検定）
- ChiSquareTests.csv: カイ二乗検定結果
- ANOVATests.csv: 分散分析結果

#### Phase3（ペルソナ分析）
- PersonaSummary.csv: クラスタ別指標
- PersonaDetails.csv: 個票＋クラスタメタ

#### Phase6（フロー分析）
- MunicipalityFlowEdges.csv: 居住地→希望地エッジ
- MunicipalityFlowNodes.csv: ノード係数
- ProximityAnalysis.csv: 近接性サマリー

#### Phase7（高度分析）
- SupplyDensityMap.csv: 供給密度
- QualificationDistribution.csv: 資格分布
- AgeGenderCrossAnalysis.csv: 年齢×性別クロス
- MobilityScore.csv: 移動許容度
- DetailedPersonaProfile.csv: 詳細プロファイル

#### Phase8（学歴分析）
- EducationDistribution.csv: 学歴分布
- EducationAgeCross.csv: 学歴×年齢クロス

#### Phase10（緊急度分析）
- UrgencyDistribution.csv: 緊急度分布
- UrgencyAgeCross.csv: 緊急度×年齢クロス
- UrgencyEmploymentCross.csv: 緊急度×雇用形態クロス

---

## 第8章: ダッシュボードUI

### 8.1 タブ構成（7タブ）

| # | タブ名 | 主な機能 |
|---|--------|---------|
| 1 | 📊 市場概況 | KPI、年齢分布、性別・雇用形態分布、TOP10 |
| 2 | 👥 人材属性 | 資格分布、年齢×性別クロス、ペルソナ分析 |
| 3 | 🗺️ 地域・移動パターン | 移動パターン円グラフ、フロー分析 |
| 4 | ⚖️ 需給バランス | 需給ギャップ、レアリティ分析 |
| 5 | 📈 雇用形態分析 | 雇用形態×移動パターンのヒートマップ |
| 6 | 🗺️ 求人地図 | Google Apps Script連携 |
| 7 | 📍 人材地図 | Leaflet統合（開発中） |

### 8.2 フィルター機能

- **都道府県プルダウン**: 47都道府県（北から南順のJIS順）
- **市区町村プルダウン**: 都道府県連動で自動更新

### 8.3 認証

- メールアドレス + パスワード認証
- ドメイン制限: f-a-c.co.jp / cyxen.co.jp のみ

---

## 第9章: デモシナリオ

### シナリオ1: 新規施設開設の採用計画

```
1. 開設予定地（例: 京都府京都市）を選択
2. 市場概況で求職者数を確認 → 「1,305人の求職者がいます」
3. 資格分布で必要資格の保有者を確認 → 「介護福祉士: 456人」
4. 年齢分布でターゲット層を特定 → 「40代が最多、次いで50代」
5. 移動パターンで採用エリアを検討 → 「近隣市からの流入も期待可能」

結論: 採用計画の数値的根拠が得られた
```

### シナリオ2: 採用難の原因分析

```
1. 自施設のある地域を選択
2. 人材組み合わせ分析で現在の採用要件を入力
3. 該当者数を確認 → 「たった12人しかいない（0.9%）」
4. 条件を緩和して再検索 → 「年齢上限を上げると85人に」

結論: 採用要件が市場と乖離していた。条件緩和を提案
```

### シナリオ3: 競合分析

```
1. 自施設エリアの需給バランスを確認
2. 供給（求職者数）と需要（求人数）を比較
3. 需給ギャップから採用難易度を判定
4. 近隣エリアとの比較で戦略立案

結論: 隣の市の方が供給過多で採用しやすい
```

---

## 第10章: 実データサンプル

### 東京都全体（2025年12月時点）

| 指標 | 数値 |
|------|------|
| 総求職者数 | 132,690人 |
| 女性比率 | 65.0% |
| 最多ペルソナ | 50代×女性（19.6%） |
| 資格保有者TOP | 調理師（12,015人） |

### 人材組み合わせ検索例

| 条件 | 該当者数 | レアリティ |
|------|---------|-----------|
| 30代・男性・介護福祉士 | 45人 | ⭐⭐⭐ 超希少 |
| 40代・女性・介護福祉士 | 約200人 | ⭐⭐ やや希少 |
| 50代・女性・資格不問 | 約26,000人 | ⭐ 一般的 |

### 移動パターン分布（全国平均）

| パターン | 割合 |
|---------|------|
| 地元志向（同一市区町村） | 49% |
| 近隣移動（隣接市区町村） | 34% |
| 広域移動（都道府県跨ぎ） | 17% |

---

## 第11章: 運用・デプロイ

### 11.1 Render設定

| 項目 | 値 |
|------|-----|
| サービス名 | visualizationj-job-ap-analyzer-gui |
| プラン | Starter ($7/月) |
| リージョン | Oregon |
| ビルドコマンド | pip install -r requirements.txt |
| スタートコマンド | python main.py |

### 11.2 環境変数

| 変数名 | 説明 |
|--------|------|
| TURSO_DATABASE_URL | Turso接続URL |
| TURSO_AUTH_TOKEN | 認証トークン |
| PYTHON_VERSION | 3.11 |

### 11.3 Turso無料プラン制限

| 項目 | 制限 | 現在使用 |
|------|------|---------|
| ストレージ | 9 GB | ~500 MB |
| Row Reads | 1B/月 | ~0.3% |
| Row Writes | 25M/月 | インポート時のみ |

### 11.4 コスト構造

| 項目 | 月額コスト |
|------|-----------|
| Render (Starter) | $7 |
| Turso | 無料 |
| **合計** | **$7/月** |

---

## 第12章: ファイル構成

```
nicegui_app/
├── main.py                 # メインアプリ (約2000行)
├── db_helper.py            # DB接続＆キャッシュ (約1700行)
├── choropleth_helper.py    # 地図ヘルパー
├── requirements.txt        # 依存パッケージ
├── .env.production         # 本番環境変数
├── turso_fast_import.py    # データインポートスクリプト
└── docs/                   # ドキュメント
    ├── SYSTEM_OVERVIEW_20251225.md
    ├── SALES_MATERIAL_20251225.md
    ├── DATA_IMPORT_RULES.md
    └── VIDEO_PREPARATION.md
```

---

## 第13章: セキュリティ

### 13.1 データ保護
- **個人情報**: 集計データのみ使用（個人特定不可）
- **認証**: ログイン必須、ドメイン制限
- **通信**: HTTPS暗号化

### 13.2 アクセス制御
- 許可ドメイン: f-a-c.co.jp / cyxen.co.jp
- パスワード認証

---

## 第14章: 今後の展開計画

### 14.1 人材地図の拡張（計画中）

**Step 1: フィルタUI追加**
- 雇用区分フィルタ（正職員/パート/その他）
- 年代フィルタ（20代/30代/40代/50代以上）
- 性別フィルタ

**Step 2: 流入元可視化**
- 市区町村クリックで流入元を色分け表示
- カラースケール: 赤（主要）→オレンジ→黄→灰（少数）

**Step 3: 流出/流入バランス**
- 濃い青（流入優位）→白（バランス）→濃い赤（流出優位）

**Step 4: 競合地域可視化**
- 同じ求職者が希望する他地域を表示

### 14.2 複数職種対応（将来計画）

```
NiceGUI App（1つ）
    ↓ 職種プルダウン: [介護▼]
    ├─→ Turso 介護 DB
    ├─→ Turso 看護 DB
    └─→ Turso PT/OT DB
```

**コストメリット**: アプリは $7 固定（複数職種追加しても同じ）

---

## 第15章: FAQ

### Q1: データはどこから来ていますか？
A: ジョブメドレーに登録している求職者の匿名化・集計データを使用しています。個人を特定する情報は含まれていません。

### Q2: どのくらいの頻度で更新されますか？
A: 定期的に更新されます。最新のデータで分析が可能です。

### Q3: 他の職種（看護師、PT/OTなど）にも対応していますか？
A: 現在は介護職がメインですが、今後他職種への展開を予定しています。

### Q4: 自社の応募データと連携できますか？
A: 現時点では対応していませんが、将来的な機能拡張として検討中です。

### Q5: スマートフォンからも使えますか？
A: PC・タブレット対応です。スマートフォンでも表示は可能ですが、PC推奨です。

### Q6: データの信頼性は？
A: ジョブメドレー（国内最大級の医療・介護求人サイト）のデータを使用。全国47都道府県、1,700以上の市区町村をカバー。

---

## 第16章: 用語集

| 用語 | 説明 |
|------|------|
| ペルソナ | 年齢×性別の組み合わせによる人材分類 |
| レアリティ分析 | 条件に合致する人材の希少性を分析する機能 |
| 移動パターン | 居住地と希望勤務地の関係性（地元/近隣/広域） |
| 需給バランス | 求職者数（供給）と求人数（需要）の比較 |
| フロー分析 | 居住地から希望勤務地への人材移動の流れ |
| KPI | Key Performance Indicator（重要業績評価指標） |
| row_type | データベース内のデータ種別を示す識別子 |

---

## 第17章: トラブルシューティング

| 症状 | 原因 | 対処 |
|------|------|------|
| ログイン後白画面 | Turso接続エラー | 環境変数確認 |
| 「データがありません」 | キャッシュ不整合 | refresh_all_cache() |
| グラフが表示されない | データ未取得 | 都道府県を再選択 |
| 動作が遅い | キャッシュ未ヒット | 初回アクセス後は高速化 |

---

## 第18章: 連絡先・参考リンク

- **本番URL**: https://visualizationj-job-ap-analyzer-gui.onrender.com
- **Turso Dashboard**: https://turso.tech/app
- **Render Dashboard**: https://dashboard.render.com
- **NiceGUI Docs**: https://nicegui.io/documentation

---

*このドキュメントは2025年12月30日時点の情報に基づいています。*
