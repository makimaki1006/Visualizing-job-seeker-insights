# Phase 2 完成版テスト手順（簡素化版）

**作成日**: 2025年10月27日
**対象**: Phase 2実装完了後の動作確認
**所要時間**: 約10分

---

## 📋 前提条件

✅ `python run_complete.py` 実行済み
✅ GASファイルのコピペ完了（3ファイル）:
- MunicipalityFlowNetworkViz.gs
- CompleteIntegratedDashboard.gs
- Phase7CompleteMenuIntegration.gs → `MenuIntegration.gs` にコピー（`onOpen()` に改名）

---

## 🚀 テスト手順

### ステップ1: Googleスプレッドシート準備

1. Googleスプレッドシートを開く
2. **拡張機能** > **Apps Script** をクリック
3. GASエディタで **ファイル** > **すべてを保存**
4. Googleスプレッドシートに戻り、**完全にリロード（Ctrl+Shift+R）**

**確認ポイント**:
- メニューバーに **📊 データ処理** が表示される
- **📈 Phase 7高度分析** サブメニューが表示される

---

### ステップ2: Phase 7データ一括アップロード（最も重要）

#### 2-1. メニューから起動

メニュー: **📊 データ処理** > **📈 Phase 7高度分析** > **📥 データインポート** > **📤 一括アップロード（全7ファイル）**

#### 2-2. ダイアログ操作

1. **ダイアログが開く** （950x700px）
2. 以下の7つのエリアに対応するCSVファイルを選択:

| # | エリア | ファイル名 | 場所 |
|---|--------|-----------|------|
| 1 | 🗺️ 人材供給密度マップ | SupplyDensityMap.csv | `gas_output_phase7/` |
| 2 | 🎓 資格別人材分布 | QualificationDistribution.csv | `gas_output_phase7/` |
| 3 | 👥 年齢×性別クロス分析 | AgeGenderCrossAnalysis.csv | `gas_output_phase7/` |
| 4 | 🚗 移動許容度スコアリング | MobilityScore.csv | `gas_output_phase7/` |
| 5 | 📊 ペルソナ詳細プロファイル | DetailedPersonaProfile.csv | `gas_output_phase7/` |
| 6 | 🗺️ ペルソナ地図データ | PersonaMapData.csv | `gas_output_phase7/` |
| 7 | 🚗 ペルソナ×移動許容度 | PersonaMobilityCross.csv | `gas_output_phase7/` |

**ファイル選択方法**:
- エリアをクリック → ファイル選択ダイアログ → CSVファイルを選択
- **または** ファイルをドラッグ&ドロップ

#### 2-3. アップロード実行

1. 全7ファイルが選択されたことを確認（サマリーエリアに「7 / 7」と表示）
2. **🚀 アップロード開始** ボタンをクリック
3. プログレスバーが表示される
4. 完了メッセージ「✅ 7ファイルのアップロードが完了しました！」を確認

**所要時間**: 約30秒〜1分

---

### ステップ3: Phase 7シート確認

Googleスプレッドシート下部のシートタブで以下の7シートが作成されていることを確認:

- [ ] `Phase7_SupplyDensity`
- [ ] `Phase7_QualificationDist`
- [ ] `Phase7_AgeGenderCross`
- [ ] `Phase7_MobilityScore`
- [ ] `Phase7_PersonaProfile`
- [ ] `PersonaMapData`
- [ ] `PersonaMobilityCross`

**各シートの確認ポイント**:
- ヘッダー行が太字・グレー背景
- データ行が存在する
- 列幅が自動調整されている

---

### ステップ4: ネットワーク中心性データのインポート（手動CSV読み込み）

#### 4-1. CentralityRanking.csvをインポート

1. Googleスプレッドシート下部の **+** をクリック
2. シート名を `CentralityRanking` に変更
3. **ファイル** > **インポート** をクリック
4. **アップロード** タブで以下のファイルを選択:

```
C:\Users\fuji1\OneDrive\Pythonスクリプト保管\job_medley_project\gas_output_insights\CentralityRanking.csv
```

5. インポート設定:
   - **インポート場所**: 現在のシートを置換
   - **区切り文字**: 自動検出
6. **インポート** をクリック

#### 4-2. 確認

- [ ] `CentralityRanking` シートに **20行**（ヘッダー + 20ハブ自治体）が表示される
- [ ] 列: `rank`, `municipality`, `composite_score`, `pagerank`, `betweenness_centrality`, etc.
- [ ] 1位: 京都府京都市伏見区（複合スコア: 0.2256）

---

### ステップ5: 完全統合ダッシュボード表示確認

#### 5-1. ダッシュボード起動

メニュー: **📊 データ処理** > **📈 Phase 7高度分析** > **🎯 統合ダッシュボード** > **🌐 完全統合ダッシュボード（Phase 1+6+7+Network）**

#### 5-2. ダッシュボード表示確認

**ダイアログサイズ**: 1700x1000px

**タブ確認**（9タブ）:
- [ ] 📊 統合概要
- [ ] 📍 Phase 1: 基礎集計
- [ ] 🌊 Phase 6: フロー分析
- [ ] 🔗 **ネットワーク中心性** ← **NEW**
- [ ] 🗺️ Phase 7: 供給密度
- [ ] 🎓 Phase 7: 資格分布
- [ ] 👥 Phase 7: 年齢×性別
- [ ] 🚗 Phase 7: 移動許容度
- [ ] 📋 Phase 7: ペルソナ

#### 5-3. ネットワーク中心性タブ確認（Phase 2新機能）

1. **🔗 ネットワーク中心性** タブをクリック
2. 以下が表示されることを確認:

**統計サマリー**:
- ノード数: 804
- エッジ数: 6,861
- ハブ自治体数: 20

**TOP 10ハブ自治体（棒グラフ）**:
- 1位: 京都府京都市伏見区（複合スコア: 0.2256）
- 2位: 京都府京都市西京区（複合スコア: 0.1180）
- 3位: 京都府京都市山科区（複合スコア: 0.1158）

**中心性ランキングテーブル（TOP 20）**:
- テーブルに20行が表示される
- 列: 順位、自治体、複合スコア、PageRank、媒介中心性、純フロー

---

### ステップ6: その他の機能確認（任意）

#### 6-1. 自治体間フローネットワーク図（Phase 2-1）

メニュー: **📊 データ処理** > **📈 Phase 7高度分析** > **📊 個別分析** > **🔗 自治体間フローネットワーク図**

**確認ポイント**:
- D3.js Force-Directed Graph が表示される
- ノード（自治体）が表示される
- エッジ（フロー）が表示される
- ズーム、パン、ドラッグ操作が可能

#### 6-2. アップロード状況確認

メニュー: **📊 データ処理** > **📈 Phase 7高度分析** > **📥 データインポート** > **✅ アップロード状況確認**

**確認ポイント**:
- 全7ファイルに「✓」マークが表示される
- 各ファイルの行数×列数が表示される
- 「完了: 7/7ファイル」と表示される

---

## ✅ テスト完了チェックリスト

### 必須項目

- [ ] Googleスプレッドシートのメニューに「📈 Phase 7高度分析」が表示される
- [ ] Phase 7データ一括アップロードで全7ファイルがアップロードできた
- [ ] 7つのPhase 7シート（`Phase7_*`, `PersonaMapData`, `PersonaMobilityCross`）が作成された
- [ ] `CentralityRanking` シートに20行のデータがインポートされた
- [ ] 完全統合ダッシュボードが正常に表示される
- [ ] ネットワーク中心性タブに統計サマリーとTOP 10ハブ自治体が表示される

### オプション項目

- [ ] 自治体間フローネットワーク図が表示され、インタラクティブ操作ができる
- [ ] アップロード状況確認で「7/7ファイル」完了が表示される

---

## 🚨 トラブルシューティング

### エラー1: 「関数が見つかりません」

**症状**: メニューをクリックしても何も起こらない

**原因**: 関数名が間違っている、またはファイルが保存されていない

**対処**:
1. Apps Scriptエディタで **ファイル** > **すべてを保存**
2. 関数名のスペルミスを確認（大文字・小文字も区別される）
3. Googleスプレッドシートをリロード（F5）

---

### エラー2: 「メニューが表示されない」

**症状**: Googleスプレッドシートに「📊 データ処理」メニューが表示されない

**原因**: `onOpen()` 関数が正しく実行されていない

**対処**:
1. Apps Scriptエディタで `MenuIntegration.gs` を開く
2. 関数名が `onOpen()` になっているか確認（`onOpen_Phase7Complete()` ではない）
3. Googleスプレッドシートを**完全に閉じて**再度開く

---

### エラー3: 「完全統合ダッシュボードでデータが表示されない」

**症状**: ダッシュボードは開くが、グラフが空

**原因**: `CentralityRanking` シートが存在しない、または空

**対処**:
1. Googleスプレッドシートに `CentralityRanking` シートを作成
2. `gas_output_insights/CentralityRanking.csv` をインポート
3. 20行（ヘッダー + 20ハブ自治体）が表示されることを確認

---

### エラー4: 「Phase 7シートが作成されない」

**症状**: アップロード完了メッセージが表示されるが、シートが見つからない

**原因**: GASスクリプトでエラーが発生している

**対処**:
1. Apps Scriptエディタで **表示** > **ログ** を確認
2. エラーメッセージを確認
3. `Phase7DirectUploader.gs` が正しくコピペされているか確認

---

## 📊 期待される結果

### Phase 7シート（7シート）

| シート名 | 行数（例） | 列数 | 説明 |
|---------|-----------|------|------|
| Phase7_SupplyDensity | 792 | 5 | 人材供給密度マップ |
| Phase7_QualificationDist | 20 | 3 | 資格別人材分布 |
| Phase7_AgeGenderCross | 42 | 4 | 年齢層×性別クロス分析 |
| Phase7_MobilityScore | 11,000+ | 6 | 移動許容度スコアリング |
| Phase7_PersonaProfile | 11 | 10 | ペルソナ詳細プロファイル |
| PersonaMapData | 792 | 7 | ペルソナ地図データ |
| PersonaMobilityCross | 11 | 6 | ペルソナ×移動許容度クロス |

### ネットワーク中心性データ（1シート）

| シート名 | 行数 | 列数 | 説明 |
|---------|------|------|------|
| CentralityRanking | 20 | 13 | TOP 20ハブ自治体中心性ランキング |

### 完全統合ダッシュボード

**表示内容**:
- KPI表示（6個）
- 9タブ（Phase 1, 6, 7, Network統合）
- インタラクティブグラフ（Google Charts + D3.js）

---

## 📝 次のステップ

テストが完了したら:

1. **データ更新**: `python run_complete.py` を実行して最新データを生成
2. **再アップロード**: メニュー > **📤 一括アップロード（全7ファイル）** で更新
3. **ステークホルダーレビュー**: ビジネス関係者にデモを実施
4. **本番運用開始**: Phase 2実装は本番投入可能な品質に達しています

---

**テスト完了お疲れ様でした！🎉**

Phase 2実装により、Phase 1+6+7+Networkの全機能が統合され、包括的なデータ可視化プラットフォームが完成しました。
