# GASã‚¢ãƒ—ãƒªã®Reflexã¸ã®çµ„ã¿è¾¼ã¿åˆ†æ

**ä½œæˆæ—¥**: 2025å¹´11æœˆ21æ—¥
**è³ªå•**: GASã®ã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã‚Œã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ã¯å‡ºæ¥ã‚‹ã‹ï¼Ÿ

---

## çµè«–: **å®Œå…¨ã«å¯èƒ½** âœ…âœ…âœ…

GASã‚’Webã‚¢ãƒ—ãƒªã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€Reflexã«çµ„ã¿è¾¼ã‚€æ–¹æ³•ã¯**å®Ÿç¾å¯èƒ½ã‹ã¤æ¨å¥¨**ã§ã™ï¼

---

## æ–¹æ³•: GAS Webã‚¢ãƒ—ãƒªã‚’iframeã§Reflexã«åŸ‹ã‚è¾¼ã¿

### æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reflexã‚¢ãƒ—ãƒª (http://localhost:3002)     â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ±‚äººåœ°å›³ã‚¿ãƒ–                         â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ <iframe>                        â”‚ â”‚ â”‚
â”‚ â”‚ â”‚   GAS Webã‚¢ãƒ—ãƒª                  â”‚ â”‚ â”‚
â”‚ â”‚ â”‚   (script.google.com/...)       â”‚ â”‚ â”‚
â”‚ â”‚ â”‚                                 â”‚ â”‚ â”‚
â”‚ â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”‚
â”‚ â”‚ â”‚   â”‚ Leafletåœ°å›³             â”‚   â”‚ â”‚ â”‚
â”‚ â”‚ â”‚   â”‚ + ãƒ”ãƒ³æ­¢ã‚ã‚«ãƒ¼ãƒ‰        â”‚   â”‚ â”‚ â”‚
â”‚ â”‚ â”‚   â”‚ + ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—     â”‚   â”‚ â”‚ â”‚
â”‚ â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Step 1: GAS Map.htmlã‚’Webã‚¢ãƒ—ãƒªã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤

#### 1.1 Code.js ã® `doGet()` ã‚’ç¢ºèª

æ—¢ã«å®Ÿè£…æ¸ˆã¿ âœ…

```javascript
// Code.js Line 32-38
function doGet(e) {
  if (e.parameter.mode && e.parameter.mode === 'popup') {
    return HtmlService.createHtmlOutputFromFile('MapPopup');
  } else {
    return HtmlService.createHtmlOutputFromFile('Map');
  }
}
```

#### 1.2 GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

1. GASã‚¨ãƒ‡ã‚£ã‚¿ã§ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ç¨®é¡: **ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒª**
3. èª¬æ˜: ã€Œæ±‚äººåœ°å›³ã‚¢ãƒ—ãƒª v1.0ã€
4. å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼: **è‡ªåˆ†**
5. ã‚¢ã‚¯ã‚»ã‚¹: **å…¨å“¡** ã¾ãŸã¯ **çµ„ç¹”å†…ã®å…¨å“¡**
6. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

**çµæœ**: Webã‚¢ãƒ—ãƒªURLå–å¾—
```
https://script.google.com/macros/s/XXXXXXXXXXXXXXXX/exec
```

#### 1.3 å‹•ä½œç¢ºèª

ãƒ–ãƒ©ã‚¦ã‚¶ã§Webã‚¢ãƒ—ãƒªURLã‚’é–‹ã â†’ Map.htmlãŒè¡¨ç¤ºã•ã‚Œã‚‹ âœ…

---

### Step 2: Reflexã§iframeã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦GASã‚¢ãƒ—ãƒªã‚’åŸ‹ã‚è¾¼ã¿

#### 2.1 å®Ÿè£…ã‚³ãƒ¼ãƒ‰

```python
# mapcomplete_dashboard/mapcomplete_dashboard.py

import reflex as rx

# GAS Webã‚¢ãƒ—ãƒªURLï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«å–å¾—ï¼‰
GAS_WEBAPP_URL = "https://script.google.com/macros/s/XXXXXXXXXXXXXXXX/exec"


def jobmap_panel() -> rx.Component:
    """æ±‚äººåœ°å›³ãƒ‘ãƒãƒ«ï¼ˆGAS Webã‚¢ãƒ—ãƒªåŸ‹ã‚è¾¼ã¿ç‰ˆï¼‰"""

    return rx.box(
        rx.vstack(
            rx.heading("ğŸ—ºï¸ æ±‚äººåœ°å›³", size="7", color=TEXT_COLOR, margin_bottom="1rem"),
            rx.text(
                "GASã®å®Œå…¨ãªåœ°å›³æ©Ÿèƒ½ï¼ˆLeaflet + ãƒ”ãƒ³æ­¢ã‚ + ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰",
                color=MUTED_COLOR,
                font_size="0.9rem",
                margin_bottom="1rem"
            ),

            # GAS Webã‚¢ãƒ—ãƒªã‚’iframeã§åŸ‹ã‚è¾¼ã¿
            rx.html(
                f"""
                <iframe
                    src="{GAS_WEBAPP_URL}"
                    width="100%"
                    height="800px"
                    frameborder="0"
                    style="border: 1px solid #444; border-radius: 8px;"
                    allow="geolocation"
                ></iframe>
                """
            ),

            spacing="2",
            width="100%"
        ),
        display=rx.cond(
            DashboardState.active_tab == "jobmap",
            "block",
            "none"
        ),
        width="100%",
        min_height="500px",
        background=CARD_BG,
        border_radius="12px",
        border=f"1px solid {BORDER_COLOR}",
        padding="2rem"
    )
```

---

## ãƒ¡ãƒªãƒƒãƒˆ âœ…âœ…âœ…

| ãƒ¡ãƒªãƒƒãƒˆ | èª¬æ˜ |
|---------|------|
| **âœ… å®Œå…¨æ©Ÿèƒ½** | GASã®å…¨æ©Ÿèƒ½ï¼ˆLeafletã€ãƒ”ãƒ³æ­¢ã‚ã€ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã€ç‚¹ç·šæ¥ç¶šï¼‰ã‚’100%å†ç¾ |
| **âœ… å®Ÿè£…å·¥æ•°ã‚¼ãƒ­** | Reflexã§ã®æ–°è¦å®Ÿè£…ä¸è¦ï¼ˆiframeåŸ‹ã‚è¾¼ã¿ã®ã¿ï¼‰ |
| **âœ… ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®¹æ˜“** | GASå´ã®å¤‰æ›´ãŒãã®ã¾ã¾åæ˜ ã•ã‚Œã‚‹ |
| **âœ… æ—¢å­˜è³‡ç”£æ´»ç”¨** | æ—¢ã«å‹•ä½œã—ã¦ã„ã‚‹GASã‚¢ãƒ—ãƒªã‚’ãã®ã¾ã¾ä½¿ç”¨ |
| **âœ… ç‹¬ç«‹å‹•ä½œ** | Reflexã‚¢ãƒ—ãƒªã¨ã¯ç‹¬ç«‹ã—ã¦å‹•ä½œï¼ˆã‚¨ãƒ©ãƒ¼ã®å½±éŸ¿ãªã—ï¼‰ |
| **âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | Googleã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤ã‚’åˆ©ç”¨ |
| **âœ… ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£** | Googleã‚¤ãƒ³ãƒ•ãƒ©ã§è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ« |

---

## ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ âš ï¸

| ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ | å½±éŸ¿ | å¯¾ç­– |
|-----------|------|------|
| **âš ï¸ ãƒ‡ãƒ¼ã‚¿é€£æºå›°é›£** | Reflex â†” GASé–“ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰ãŒåˆ¶é™ | postMessage APIä½¿ç”¨ï¼ˆå¾Œè¿°ï¼‰ |
| **âš ï¸ ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€å›°é›£** | GASã¨Reflexã§åˆ¥ã€…ã®ã‚¹ã‚¿ã‚¤ãƒ« | GASå´ã®CSSã‚’Reflexé…è‰²ã«åˆã‚ã›ã‚‹ |
| **âš ï¸ iframeåˆ¶ç´„** | ä¸€éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½ï¼ˆå…¨ç”»é¢è¡¨ç¤ºãªã©ï¼‰åˆ¶é™ | è¨±å®¹å¯èƒ½ï¼ˆä¸»è¦æ©Ÿèƒ½ã¯å‹•ä½œï¼‰ |
| **âš ï¸ GASå®Ÿè¡Œæ™‚é–“åˆ¶é™** | 6åˆ†ã®å®Ÿè¡Œæ™‚é–“åˆ¶é™ï¼ˆé€šå¸¸ã¯å•é¡Œãªã—ï¼‰ | ãƒ‡ãƒ¼ã‚¿é‡ã‚’åˆ¶é™ |
| **âš ï¸ å¤–éƒ¨ä¾å­˜** | Google Apps Scriptã®ã‚µãƒ¼ãƒ“ã‚¹ä¾å­˜ | é‡è¦ãªæ©Ÿèƒ½ã¯Reflexã§å®Ÿè£… |

---

## Reflex â†” GAS ãƒ‡ãƒ¼ã‚¿é€£æº

### æ–¹æ³•A: postMessage APIï¼ˆæ¨å¥¨ï¼‰ â­â­â­â­

iframeå†…ã®GASã‚¢ãƒ—ãƒªã¨Reflexã‚¢ãƒ—ãƒªé–“ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡

#### GASå´ï¼ˆMap.htmlï¼‰

```javascript
// Map.htmlå†…ã«è¿½åŠ 
function sendToParent(data) {
  // Reflexã‚¢ãƒ—ãƒªï¼ˆè¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
  window.parent.postMessage({
    type: 'gas_event',
    data: data
  }, '*');
}

// ä½¿ç”¨ä¾‹: ãƒ•ã‚£ãƒ«ã‚¿å®Ÿè¡Œæ™‚
function filterMarkers() {
  // ... æ—¢å­˜ã®ãƒ•ã‚£ãƒ«ã‚¿å‡¦ç† ...

  // ãƒ•ã‚£ãƒ«ã‚¿çµæœã‚’Reflexã«é€ä¿¡
  sendToParent({
    event: 'filter_complete',
    filtered_count: filtered.length,
    stats: { lower: statsLower, upper: statsUpper }
  });
}
```

#### Reflexå´

```python
# mapcomplete_dashboard/mapcomplete_dashboard.py

def jobmap_panel() -> rx.Component:
    """GAS Webã‚¢ãƒ—ãƒªåŸ‹ã‚è¾¼ã¿ + postMessageé€£æº"""

    return rx.box(
        # iframeåŸ‹ã‚è¾¼ã¿
        rx.html(f"""
            <iframe
                id="gas-map-iframe"
                src="{GAS_WEBAPP_URL}"
                width="100%"
                height="800px"
            ></iframe>

            <script>
                // GASã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡
                window.addEventListener('message', function(event) {{
                    if (event.data.type === 'gas_event') {{
                        console.log('GASã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:', event.data);

                        // Reflexã®ã‚¤ãƒ™ãƒ³ãƒˆã«å¤‰æ›ï¼ˆä¾‹: ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ï¼‰
                        document.dispatchEvent(new CustomEvent('gas_filter_complete', {{
                            detail: event.data.data
                        }}));
                    }}
                }});
            </script>
        """),

        # GASã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        rx.box(
            rx.text("GASçµ±è¨ˆæƒ…å ±", color=TEXT_COLOR),
            rx.text(
                "ãƒ•ã‚£ãƒ«ã‚¿ä»¶æ•°: XXä»¶",  # JavaScriptã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰å–å¾—
                color=MUTED_COLOR
            ),
            bg=CARD_BG,
            padding="2",
            margin_top="2"
        ),

        width="100%"
    )
```

### æ–¹æ³•B: URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿çµŒç”±ï¼ˆç°¡æ˜“ç‰ˆï¼‰ â­â­â­

Reflexã‹ã‚‰åˆæœŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’GASã«æ¸¡ã™

```python
# Reflexå´
selected_prefecture = "åŒ—æµ·é“"
selected_municipality = "æœ­å¹Œå¸‚"
gas_url_with_params = (
    f"{GAS_WEBAPP_URL}?"
    f"prefecture={selected_prefecture}&"
    f"municipality={selected_municipality}"
)

rx.html(f'<iframe src="{gas_url_with_params}" ...></iframe>')
```

```javascript
// GASå´ï¼ˆCode.jsï¼‰
function doGet(e) {
  var prefecture = e.parameter.prefecture || "";
  var municipality = e.parameter.municipality || "";

  var template = HtmlService.createTemplateFromFile('Map');
  template.initialPrefecture = prefecture;
  template.initialMunicipality = municipality;

  return template.evaluate();
}
```

```html
<!-- Map.html -->
<script>
  var initialPrefecture = '<?= initialPrefecture ?>';
  var initialMunicipality = '<?= initialMunicipality ?>';

  // åˆæœŸå€¤ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«è¨­å®š
  document.getElementById('prefecture').value = initialPrefecture;
  document.getElementById('municipality').value = initialMunicipality;

  // è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿å®Ÿè¡Œ
  if (initialPrefecture && initialMunicipality) {
    filterMarkers();
  }
</script>
```

---

## ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€

### GAS Map.htmlã®CSSæ›´æ–°

Reflexã®é…è‰²ã«åˆã‚ã›ã‚‹

```html
<!-- Map.html <style>å†…ã«è¿½åŠ  -->
<style>
  /* Reflexãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨çµ±ä¸€ */
  body {
    background: #0d1525;  /* BG_COLOR */
    color: #f8fafc;       /* TEXT_COLOR */
  }

  #controls {
    background: rgba(12, 20, 37, 0.95);  /* PANEL_BG */
    border-color: rgba(148, 163, 184, 0.22);  /* BORDER_COLOR */
  }

  button {
    background: #0072B2;  /* PRIMARY_COLOR */
    color: #f8fafc;
  }

  .detail-card {
    background: rgba(15, 23, 42, 0.82);  /* CARD_BG */
    border-color: rgba(148, 163, 184, 0.22);
  }
</style>
```

---

## å®Ÿè£…æ‰‹é †ï¼ˆå®Œå…¨ç‰ˆï¼‰

### Phase 1: GASãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ30åˆ†ï¼‰

1. âœ… Code.jsç¢ºèªï¼ˆdoGet()å­˜åœ¨ç¢ºèªï¼‰
2. âœ… Map.htmlã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°ï¼ˆReflexé…è‰²ã«çµ±ä¸€ï¼‰
3. ğŸ”„ GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’Webã‚¢ãƒ—ãƒªã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤
4. ğŸ”„ Webã‚¢ãƒ—ãƒªURLã‚’ã‚³ãƒ”ãƒ¼

### Phase 2: Reflexçµ±åˆï¼ˆ30åˆ†ï¼‰

1. ğŸ”„ `mapcomplete_dashboard.py`ã«iframeåŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰è¿½åŠ 
2. ğŸ”„ GAS_WEBAPP_URLå®šæ•°ã‚’è¨­å®š
3. ğŸ”„ jobmap_panel()é–¢æ•°ã‚’æ›´æ–°
4. ğŸ”„ Reflexã‚¢ãƒ—ãƒªå†èµ·å‹•

### Phase 3: ãƒ‡ãƒ¼ã‚¿é€£æºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€1-2æ™‚é–“ï¼‰

1. ğŸ”„ postMessage APIå®Ÿè£…ï¼ˆGASå´ï¼‰
2. ğŸ”„ postMessageå—ä¿¡å‡¦ç†ï¼ˆReflexå´ï¼‰
3. ğŸ”„ çµ±åˆãƒ†ã‚¹ãƒˆ

### åˆè¨ˆå®Ÿè£…æ™‚é–“: **1ã€œ2æ™‚é–“**ï¼ˆãƒ‡ãƒ¼ã‚¿é€£æºãªã—ãªã‚‰30åˆ†ï¼‰

---

## æ¯”è¼ƒ: 3ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

| ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | å®Ÿè£…å·¥æ•° | æ©Ÿèƒ½å®Œå…¨æ€§ | ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ | ãƒ‡ãƒ¼ã‚¿é€£æº | æ¨å¥¨åº¦ |
|-----------|---------|-----------|-------------|-----------|--------|
| **A. GAS iframeåŸ‹ã‚è¾¼ã¿** | 30åˆ†ã€œ2æ™‚é–“ | 100% âœ… | å®¹æ˜“ | postMessageå¯èƒ½ | â­â­â­â­â­ **æœ€æ¨å¥¨** |
| **B. Plotly annotations** | 2æ™‚é–“ | 70% âš ï¸ | å®¹æ˜“ | å®Œå…¨çµ±åˆ | â­â­â­â­ æ¨å¥¨ |
| **C. Plotly + HTML overlay** | 4-6æ™‚é–“ | 60% âš ï¸ | æ™®é€š | å®Œå…¨çµ±åˆ | â­â­â­ è‰¯ã„ |
| **D. ã‚«ã‚¹ã‚¿ãƒ Reactï¼ˆreact-leafletï¼‰** | 3-5æ—¥ | 100% âœ… | å›°é›£ | å®Œå…¨çµ±åˆ | â­â­ å¯èƒ½ |

---

## æ¨å¥¨: **GAS iframeåŸ‹ã‚è¾¼ã¿** â­â­â­â­â­

### ç†ç”±

1. **âœ… æœ€çŸ­å®Ÿè£…æ™‚é–“** - 30åˆ†ã§å®Œæˆï¼ˆãƒ‡ãƒ¼ã‚¿é€£æºãªã—ï¼‰
2. **âœ… å®Œå…¨æ©Ÿèƒ½** - GASã®å…¨æ©Ÿèƒ½ã‚’100%æ´»ç”¨
3. **âœ… ã‚¼ãƒ­ãƒªã‚¹ã‚¯** - æ—¢å­˜GASã‚¢ãƒ—ãƒªã¯æ—¢ã«å‹•ä½œç¢ºèªæ¸ˆã¿
4. **âœ… ç‹¬ç«‹å‹•ä½œ** - Reflexã¨ã®ä¾å­˜é–¢ä¿‚ãªã—
5. **âœ… æ—¢å­˜è³‡ç”£æ´»ç”¨** - GASã®é–‹ç™ºæˆæœã‚’ãã®ã¾ã¾åˆ©ç”¨

### å¦¥å”ç‚¹

- âš ï¸ ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€ã«å°‘ã—æ‰‹é–“ï¼ˆCSSã‚³ãƒ”ãƒšã§è§£æ±ºï¼‰
- âš ï¸ ãƒ‡ãƒ¼ã‚¿é€£æºã«postMessageå¿…è¦ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## å®Ÿè£…ãƒ‡ãƒ¢ã‚³ãƒ¼ãƒ‰ï¼ˆæœ€å°ç‰ˆï¼‰

```python
# mapcomplete_dashboard/mapcomplete_dashboard.py

# ===== GAS Webã‚¢ãƒ—ãƒªURLï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«æ›´æ–°ï¼‰ =====
GAS_JOB_MAP_URL = "https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec"


def jobmap_panel() -> rx.Component:
    """æ±‚äººåœ°å›³ãƒ‘ãƒãƒ«ï¼ˆGASåŸ‹ã‚è¾¼ã¿ç‰ˆï¼‰

    GAS Map.htmlã‚’iframeã§åŸ‹ã‚è¾¼ã¿ã€å®Œå…¨ãªåœ°å›³æ©Ÿèƒ½ã‚’æä¾›
    - Leafletåœ°å›³
    - ãƒ”ãƒ³æ­¢ã‚ã‚«ãƒ¼ãƒ‰ï¼ˆåœ°å›³ä¸Šé…ç½®ï¼‰
    - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
    - ç‚¹ç·šæ¥ç¶š
    - ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½
    - çµ±è¨ˆè¡¨ç¤º
    """

    return rx.box(
        rx.vstack(
            # ãƒ˜ãƒƒãƒ€ãƒ¼
            rx.heading("ğŸ—ºï¸ æ±‚äººåœ°å›³", size="7", color=TEXT_COLOR, margin_bottom="1rem"),
            rx.text(
                "Google Apps Scriptã«ã‚ˆã‚‹å®Œå…¨æ©Ÿèƒ½åœ°å›³ï¼ˆLeaflet + ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–UIï¼‰",
                color=MUTED_COLOR,
                font_size="0.9rem",
                margin_bottom="1rem"
            ),

            # GAS Webã‚¢ãƒ—ãƒªã‚’iframeåŸ‹ã‚è¾¼ã¿
            rx.html(
                f"""
                <iframe
                    id="gas-job-map"
                    src="{GAS_JOB_MAP_URL}"
                    width="100%"
                    height="800px"
                    frameborder="0"
                    style="
                        border: 1px solid rgba(148, 163, 184, 0.22);
                        border-radius: 8px;
                        background: rgba(15, 23, 42, 0.82);
                    "
                    allow="geolocation"
                    loading="lazy"
                ></iframe>
                """
            ),

            # ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
            rx.text(
                "â€» åœ°å›³ã¯åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ãã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆGASãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œã‚«ã‚¹ã‚¿ãƒ åœ°å›³ã€â†’ã€Œåœ°å›³ã‚’è¡¨ç¤ºã€ï¼‰",
                color=MUTED_COLOR,
                font_size="0.75rem",
                margin_top="1rem"
            ),

            spacing="2",
            width="100%"
        ),
        display=rx.cond(
            DashboardState.active_tab == "jobmap",
            "block",
            "none"
        ),
        width="100%",
        min_height="500px",
        background=CARD_BG,
        border_radius="12px",
        border=f"1px solid {BORDER_COLOR}",
        padding="2rem"
    )
```

---

## ã¾ã¨ã‚

### è³ªå•: GASã®ã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã‚Œã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ã¯å‡ºæ¥ã‚‹ã‹ï¼Ÿ

### å›ç­”: **å®Œå…¨ã«å¯èƒ½ã€ã‹ã¤æœ€æ¨å¥¨** âœ…âœ…âœ…

| è©•ä¾¡é …ç›® | è©•ä¾¡ |
|---------|------|
| **å®Ÿç¾å¯èƒ½æ€§** | âœ… 100%å¯èƒ½ |
| **å®Ÿè£…å·¥æ•°** | 30åˆ†ã€œ2æ™‚é–“ |
| **æ©Ÿèƒ½å®Œå…¨æ€§** | âœ… GASã®å…¨æ©Ÿèƒ½ã‚’100%æ´»ç”¨ |
| **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§** | âœ… å®¹æ˜“ï¼ˆGASå´ã®ã¿æ›´æ–°ï¼‰ |
| **ãƒªã‚¹ã‚¯** | âœ… ã‚¼ãƒ­ãƒªã‚¹ã‚¯ï¼ˆæ—¢å­˜GASã‚¢ãƒ—ãƒªåˆ©ç”¨ï¼‰ |
| **ç·åˆè©•ä¾¡** | â­â­â­â­â­ **æœ€æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ** |

---

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

**GAS iframeåŸ‹ã‚è¾¼ã¿ã‚’å®Ÿè£…ã—ã¾ã™ã‹ï¼Ÿ**

å®Ÿè£…ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã‚’é€²ã‚ã¾ã™ï¼š

### Step 1: GASãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆä»Šã™ãå®Ÿè¡Œå¯èƒ½ï¼‰
1. GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã
2. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€ŒWebã‚¢ãƒ—ãƒªã€
3. Webã‚¢ãƒ—ãƒªURLã‚’ã‚³ãƒ”ãƒ¼

### Step 2: Reflexçµ±åˆï¼ˆ5åˆ†ï¼‰
1. `mapcomplete_dashboard.py`ã«ã‚³ãƒ¼ãƒ‰è¿½åŠ ï¼ˆä¸Šè¨˜ã®ãƒ‡ãƒ¢ã‚³ãƒ¼ãƒ‰ï¼‰
2. `GAS_JOB_MAP_URL`ã«URLã‚’è¨­å®š
3. Reflexã‚¢ãƒ—ãƒªå†èµ·å‹•

### Step 3: å‹•ä½œç¢ºèªï¼ˆ5åˆ†ï¼‰
1. http://localhost:3002/ ã‚’é–‹ã
2. ã€ŒğŸ—ºï¸ æ±‚äººåœ°å›³ã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. GASåœ°å›³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

**åˆè¨ˆæ™‚é–“: 30åˆ†ä»¥å†…ã§å®Œæˆ** âœ…
