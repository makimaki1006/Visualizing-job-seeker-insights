# 完全機能棚卸し（2025年11月21日）

## 現状のデータ構成

### V3 CSVデータ
- **総行数**: 17,631行
- **カラム数**: 36カラム
- **row_type**: 8種類

| row_type | 行数 | 割合 |
|----------|------|------|
| RARITY | 4,950行 | 28.1% |
| AGE_GENDER | 4,231行 | 24.0% |
| URGENCY_AGE | 2,942行 | 16.7% |
| URGENCY_EMPLOYMENT | 1,666行 | 9.4% |
| GAP | 966行 | 5.5% |
| FLOW | 966行 | 5.5% |
| COMPETITION | 966行 | 5.5% |
| SUMMARY | 944行 | 5.4% |

---

## 現在実装されているタブ（7個）

### タブ1: 📊 概要
**目的**: 全体サマリー表示

**KPIカード（4個）**:
1. 総申請者数
2. 平均年齢
3. 総需要
4. 総供給

**グラフ（2個）**:
1. 性別構成（円グラフ）
2. 年齢層別分布（横棒グラフ）

**使用データ**: SUMMARY行（944行）

---

### タブ2: 👥 年齢・性別
**目的**: 年齢層×性別クロス分析

**グラフ（3個）**:
1. 年齢層別人数（横棒グラフ）
2. 年齢層×性別クロス（グループ化棒グラフ）
3. 平均年齢（KPIカード）

**使用データ**: AGE_GENDER行（4,231行）

---

### タブ3: 🎯 ペルソナ
**目的**: ペルソナ分類別分析

**グラフ（2個）**:
1. ペルソナ分布（横棒グラフ）
2. ペルソナ詳細（テーブル？）

**使用データ**: PERSONA_MUNI行（V3 CSVに存在しない？）

**問題**: データソースが不明確

---

### タブ4: 🔥 緊急度
**目的**: 転職緊急度分析

**グラフ（2個）**:
1. 年齢層別緊急度（横棒グラフ）
2. 就業状況別緊急度（横棒グラフ）

**使用データ**: URGENCY_AGE行（2,942行）、URGENCY_EMPLOYMENT行（1,666行）

---

### タブ5: 💎 希少人材
**目的**: 希少性分析

**グラフ（4個）**:
1. 年齢層別希少性（横棒グラフ）
2. 性別別希少性（円グラフ）
3. 希少性レベル別（横棒グラフ）
4. 国家資格保有者ランキング（横棒グラフ）

**使用データ**: RARITY行（4,950行）

---

### タブ6: ⚖️ 需給バランス
**目的**: 需給ギャップ分析

**KPIカード（3個）**:
1. 総需要
2. 総供給
3. ギャップ

**グラフ（3個）**:
1. 需要 vs 供給（棒グラフ）
2. バランス（ドーナツチャート）
3. 地域別散布図（散布図）

**使用データ**: GAP行（966行）

---

### タブ7: 🏆 競合
**目的**: 競合環境分析

**グラフ（1個）**:
1. 性別分布（円グラフ）

**使用データ**: COMPETITION行（966行）

**問題**: 実装が非常に薄い（1グラフのみ）

---

## 実装されているグラフ総数

| タブ | KPIカード | グラフ | 合計 |
|------|----------|--------|------|
| 概要 | 4 | 2 | 6 |
| 年齢・性別 | 1 | 2 | 3 |
| ペルソナ | 0 | 2 | 2 |
| 緊急度 | 0 | 2 | 2 |
| 希少人材 | 0 | 4 | 4 |
| 需給バランス | 3 | 3 | 6 |
| 競合 | 0 | 1 | 1 |
| **合計** | **8** | **16** | **24** |

---

## 未使用のrow_type

### FLOW行（966行）
- **データ内容**: 流入・流出データ
- **現状**: 全く使用されていない
- **潜在的価値**: 地域間人材移動分析

### 主要カラムで未使用のもの

1. **total_applicants**（17,631行・100%データあり）
   - 総申請者数
   - 現状: 完全未使用

2. **rarity_score**（4,950行）
   - 希少性スコア
   - 現状: 未使用（希少性レベルは使用）

3. **avg_urgency_score**（4,608行）
   - 平均緊急度スコア
   - 現状: 未使用

4. **demand_supply_ratio**（966行）
   - 需給比率
   - 現状: 未使用

5. **national_license_rate**（966行）
   - 国家資格保有率
   - 現状: 未使用

---

## ユーザーが求める新機能（未実装）

### 1. 資格詳細分析
**要求**: 「どんな資格を持っている人がいるのか、その年齢・性別は？」

**現状**:
- 国家資格保有者ランキングのみ実装
- 個別資格名は表示されない（データにない）

**必要データ**:
- 生CSV（results_*.csv）の`qualifications`カラム
- V3 CSVには含まれていない

---

### 2. 学歴詳細分析
**要求**: 「どんな学歴を持っている人がいるのか、その年齢・性別は？」

**現状**: 完全未実装

**必要データ**:
- 生CSV（results_*.csv）の`career`カラム
- V3 CSVには含まれていない

---

### 3. 希望地域複数選択パターン
**要求**: 「選択中の市町村を希望している人は、他にどこを希望しているのか？」

**現状**: 完全未実装

**必要データ**:
- 生CSV（results_*.csv）の`desired_area`カラム
- V3 CSVには含まれていない

---

### 4. 居住地→希望地フロー
**要求**: 「選択中の市町村を希望している人は、どこに住んでいるのか？」

**現状**: 完全未実装

**必要データ**:
- 生CSV（results_*.csv）の`location`カラム（居住地）
- V3 CSVには含まれていない

---

### 5. 通勤距離許容度
**要求**: 「通勤距離はどの程度許容しているのか？年齢・性別ごとの差は？」

**現状**: 完全未実装

**必要データ**:
- 生CSV（results_*.csv）の`location`（居住地）と`desired_area`（希望地）
- 座標計算が必要
- V3 CSVには含まれていない

---

## 問題点の整理

### データ構造の問題

1. **V3 CSVでは詳細情報が失われている**
   - 集計済みデータのため、個別資格名・学歴・居住地が欠落
   - ユーザー要求の5機能は実装不可能

2. **生CSV（results_*.csv）が必要**
   - 個別詳細データを保持
   - 行数: 約5,000-10,000行（推定）

### UI設計の問題

1. **タブ数が多すぎる（現在7個）**
   - さらに5タブ追加すると12タブになり使いづらい

2. **実装が不均一**
   - 競合タブ: 1グラフのみ（薄い）
   - 需給バランスタブ: 6要素（充実）
   - ペルソナタブ: データソース不明

3. **row_typeの活用率が低い**
   - FLOW行: 完全未使用（966行が無駄）

---

## 提案: 機能の絞り込み

### 削減候補

#### オプション1: 薄いタブを統合
- **競合タブ**（1グラフ）→ 他タブに統合または削除
- **ペルソナタブ**（データ不明）→ 削除または再設計

#### オプション2: 未使用row_typeを削除
- **FLOW行**（966行）→ V3生成時に削除
- データ量削減: 17,631行 → 16,665行

#### オプション3: 新機能は1タブに統合
- 5つの新機能を「詳細分析タブ」1つにまとめる
- サブタブまたはドロップダウンで切り替え

### 追加データの最小化

#### オプション4: 生CSVは別テーブルとして保持
- V3 CSV: 17,631行（既存）
- 生CSV: 5,000-10,000行（新規・別テーブル）
- 合計: 約25,000行

#### オプション5: 生CSVをインメモリキャッシュのみ
- DBに保存せず、セッション中のみメモリ保持
- CSVアップロード時に読み込み、セッション終了で破棄
- DB行数: 17,631行のまま（増えない）

---

## 次のステップ

### 質問事項

1. **既存タブの削減**
   - 競合タブ（1グラフのみ）は削除してもよいか？
   - ペルソナタブ（データ不明）は削除してもよいか？

2. **新機能の優先順位**
   - 5つの新機能（資格、学歴、希望地域、居住地、通勤距離）
   - どれが最も重要か？（全て必要？）

3. **データ保存方法**
   - オプション4（別テーブル保存）→ 行数増加
   - オプション5（インメモリのみ）→ 行数増加なし
   - どちらを選ぶか？

4. **最終的なタブ数の目標**
   - 現在7タブ
   - 理想は何タブか？（3-5タブ？）

---

## 暫定推奨案

### タブ構成（5タブに削減）

```
1. 📊 概要（変更なし）
   - 全体サマリー

2. 👥 人材プロファイル（統合）
   - 年齢・性別・緊急度・希少性を統合

3. ⚖️ 需給分析（変更なし）
   - 需給バランス

4. 🔍 詳細検索（新規）
   - 資格、学歴、希望地域、居住地、通勤距離
   - サブタブで切り替え
   - データ: 生CSV（インメモリ）

5. 🏆 競合分析（拡張）
   - 競合環境（競合タブを拡張）
```

### データ構成

```
V3 CSV: 16,665行（FLOW削除後）
├─ SUMMARY: 944行
├─ AGE_GENDER: 4,231行
├─ RARITY: 4,950行
├─ URGENCY_AGE: 2,942行
├─ URGENCY_EMPLOYMENT: 1,666行
├─ GAP: 966行
└─ COMPETITION: 966行

生CSV: インメモリのみ（約5,000-10,000行）
- CSVアップロード時に読み込み
- セッション中のみ保持
- DB保存なし
```

### DB行数
- **現在**: 17,631行
- **削減後**: 16,665行（削減: 966行）
- **新規追加**: なし（インメモリ運用）

---

この方向性で進めてよろしいでしょうか？

具体的なご要望をお聞かせください。
