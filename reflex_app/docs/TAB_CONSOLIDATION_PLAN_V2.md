# タブ統合実装計画 V2（ビジネスニーズ中心版）

**作成日**: 2025年11月21日
**目的**: ユーザーの本質的な要件「どの地域にどのような人がいるのか」に応える構成

---

## ユーザー要件の再確認

### 本質的な問い

> 「どの地域にどのような人がいるのか」

### 具体的な5つの質問

1. **資格**: どんな資格を持っている人がいるのか、その性別、年齢は？
2. **学歴**: どんな学歴を持っている人がいるのか、その性別、年齢は？
3. **複数希望**: この市町村を希望している人は他にどんな市町村を希望しているのか、その性別、年齢は？
4. **居住地フロー**: この市町村を希望している人はどんな市町村に居住しているのか、その性別、年齢は？
5. **通勤距離**: この市町村を希望している人の通勤距離許容度は（性別、年齢ごと）？

---

## 従来のタブ構成の問題点

### 問題1: 抽象的なスコアリングが多い

| タブ | 問題 | ユーザー評価 |
|------|------|-------------|
| 💎 希少人材 | 抽象的な「希少度スコア」、新しい資格分析と被る | ❌ 不要 |
| 🔥 緊急度 | 計算根拠が不明確、ブラックボックス | ❌ 不要 |
| 🏆 競合 | 薄い実装（1グラフのみ）、ビジネス価値不明 | ❌ 不要 |

### 問題2: ユーザーの5つの質問に答えていない

**現在のV3では答えられない質問**:
- ✅ 「どんな資格を持っている人がいるのか？」→ データなし
- ✅ 「どんな学歴を持っている人がいるのか？」→ データなし
- ✅ 「他にどんな市町村を希望しているのか？」→ データなし
- ✅ 「どんな市町村に居住しているのか？」→ データなし
- ✅ 「通勤距離許容度は？」→ データなし

---

## 新しい4タブ構成（ビジネスニーズ中心）

### タブ1: 📊 市場概況

**目的**: 地域全体の市場規模を把握

**KPI 4個**:
- 総申請者数
- 対象地域数
- 平均年齢
- 性別比率

**グラフ 3個**:
1. 性別分布（円グラフ）
2. 年齢層分布（棒グラフ）
3. 年齢×性別クロス（棒グラフ）

**使用row_type**: SUMMARY (944行), AGE_GENDER (4,231行)
**合計**: 5,175行

---

### タブ2: 👥 人材属性（最重要）

**目的**: どんな人材がいるのかを詳細に把握

#### セクション2-1: ペルソナ分析（就業状況×資格×年齢）

**KPI 3個**:
- ペルソナ総数
- 最多ペルソナ
- ペルソナ平均年齢

**グラフ 5個**:
1. ペルソナTOP10分布（棒グラフ）
2. ペルソナ構成比（円グラフ）
3. ペルソナ×就業状況クロス（ヒートマップ）
4. ペルソナ×性別クロス（ヒートマップ）
5. ペルソナ×年齢クロス（ヒートマップ）

**使用row_type**: PERSONA_MUNI (要生成、推定2,500行)

#### セクション2-2: 資格詳細分析 🆕

**目的**: ユーザー要件1「どんな資格を持っている人がいるのか、その性別、年齢は？」

**KPI 3個**:
- 資格種類数
- 国家資格保有率
- 平均資格数

**グラフ 5個**:
1. 資格別人数ランキング（棒グラフ）
2. 資格×年齢クロス（ヒートマップ）
3. 資格×性別クロス（ヒートマップ）
4. 国家資格TOP10（棒グラフ）
5. 資格×就業状況クロス（ヒートマップ）

**使用row_type**: QUALIFICATION_DETAIL 🆕 (推定3,000行)

**データ形式**:
```csv
row_type,prefecture,municipality,qualification_name,is_national_license,age_group,gender,employment_status,count
QUALIFICATION_DETAIL,京都府,京都市,介護福祉士,TRUE,30-34,女性,就業中,45
QUALIFICATION_DETAIL,京都府,京都市,介護福祉士,TRUE,35-39,女性,就業中,38
QUALIFICATION_DETAIL,京都府,京都市,介護福祉士,TRUE,30-34,女性,離職中,12
```

#### セクション2-3: 学歴詳細分析 🆕

**目的**: ユーザー要件2「どんな学歴を持っている人がいるのか、その性別、年齢は？」

**KPI 2個**:
- 最多学歴
- 大卒以上割合

**グラフ 4個**:
1. 学歴分布（棒グラフ）
2. 学歴×年齢クロス（ヒートマップ）
3. 学歴×性別クロス（ヒートマップ）
4. 卒業年度分布（折れ線グラフ）

**使用row_type**: EDUCATION_DETAIL 🆕 (推定2,000行)

**データ形式**:
```csv
row_type,prefecture,municipality,education_level,graduation_year,age_group,gender,count
EDUCATION_DETAIL,京都府,京都市,大学卒,2015,25-29,女性,23
EDUCATION_DETAIL,京都府,京都市,大学卒,2015,25-29,男性,18
EDUCATION_DETAIL,京都府,京都市,専門学校卒,2018,20-24,女性,15
```

**タブ2合計**: 約7,500行（PERSONA_MUNI 2,500 + QUALIFICATION_DETAIL 3,000 + EDUCATION_DETAIL 2,000）

---

### タブ3: 🗺️ 地域・移動パターン

**目的**: 人材の地域的な動きを把握

#### セクション3-1: 複数希望地パターン 🆕

**目的**: ユーザー要件3「この市町村を希望している人は他にどんな市町村を希望しているのか？」

**KPI 2個**:
- 平均希望地域数
- 複数希望率

**グラフ 3個**:
1. 併願TOP10市町村（棒グラフ）
2. 併願パターンマトリクス（ヒートマップ）
3. 併願×年齢クロス（棒グラフ）

**使用row_type**: DESIRED_AREA_PATTERN 🆕 (推定2,000行)

**データ形式**:
```csv
row_type,prefecture,municipality,co_desired_municipality,age_group,gender,count
DESIRED_AREA_PATTERN,京都府,京都市,大阪市,30-34,女性,67
DESIRED_AREA_PATTERN,京都府,京都市,神戸市,30-34,女性,45
DESIRED_AREA_PATTERN,京都府,京都市,大津市,35-39,女性,38
```

#### セクション3-2: 居住地→希望地フロー 🆕

**目的**: ユーザー要件4「この市町村を希望している人はどんな市町村に居住しているのか？」

**KPI 2個**:
- 流入TOP1市町村
- 流入率

**グラフ 4個**:
1. 流入元TOP10（棒グラフ）
2. 流入元×希望地マトリクス（ヒートマップ）
3. 流入×年齢クロス（棒グラフ）
4. 流入×性別比率（円グラフ）

**使用row_type**: RESIDENCE_FLOW 🆕 (推定2,500行)

**データ形式**:
```csv
row_type,prefecture,municipality,residence_municipality,age_group,gender,count
RESIDENCE_FLOW,京都府,京都市,大阪市,30-34,女性,89
RESIDENCE_FLOW,京都府,京都市,神戸市,30-34,女性,56
RESIDENCE_FLOW,京都府,京都市,京都市,30-34,女性,234
```

#### セクション3-3: 通勤距離許容度 🆕

**目的**: ユーザー要件5「通勤距離はどの程度許容しているのか（性別、年齢ごと）？」

**KPI 3個**:
- 平均許容距離
- 遠距離OK率（20km以上）
- 近距離希望率（5km以内）

**グラフ 4個**:
1. 許容距離分布（棒グラフ）
2. 許容距離×年齢クロス（ヒートマップ）
3. 許容距離×性別クロス（ヒートマップ）
4. 許容距離×就業状況クロス（ヒートマップ）

**使用row_type**: COMMUTE_TOLERANCE 🆕 (推定2,000行)

**データ形式**:
```csv
row_type,prefecture,municipality,distance_range,age_group,gender,employment_status,count
COMMUTE_TOLERANCE,京都府,京都市,0-5km,30-34,女性,就業中,45
COMMUTE_TOLERANCE,京都府,京都市,5-10km,30-34,女性,就業中,78
COMMUTE_TOLERANCE,京都府,京都市,10-20km,30-34,女性,就業中,56
COMMUTE_TOLERANCE,京都府,京都市,20km以上,30-34,女性,就業中,23
```

**タブ3合計**: 約6,500行（DESIRED_AREA_PATTERN 2,000 + RESIDENCE_FLOW 2,500 + COMMUTE_TOLERANCE 2,000）

---

### タブ4: ⚖️ 需給バランス

**目的**: 採用難易度を把握

**KPI 4個**:
- 総需要数
- 総供給数
- 不足地域数
- 需給比率

**グラフ 5個**:
1. 需給ギャップ比較（棒グラフ）
2. 需給バランス状況（散布図）
3. 人材不足ランキングTOP10（棒グラフ）
4. 人材過剰ランキングTOP10（棒グラフ）
5. 需給比率ランキング（棒グラフ）

**使用row_type**: GAP (966行)

---

## データ量の変化

### 削除対象（ビジネス価値が低い）

| row_type | 現在行数 | 削除理由 |
|----------|----------|----------|
| RARITY | 4,950行 | 抽象的なスコアリング、新資格分析と被る |
| URGENCY_AGE | 2,942行 | 計算根拠不明、ブラックボックス |
| URGENCY_EMPLOYMENT | 1,666行 | 計算根拠不明、ブラックボックス |
| FLOW | 966行 | UI未統合、未使用 |
| COMPETITION | 966行 | 薄い実装（1グラフのみ） |
| **削除合計** | **11,490行** | **-65.2%削減** |

### 追加対象（ビジネス価値が高い）

| row_type | 追加行数 | 追加理由 |
|----------|----------|----------|
| PERSONA_MUNI | +2,500行 | ユーザー最重要（ペルソナ分析） |
| QUALIFICATION_DETAIL | +3,000行 | ユーザー要件1（資格詳細） |
| EDUCATION_DETAIL | +2,000行 | ユーザー要件2（学歴詳細） |
| DESIRED_AREA_PATTERN | +2,000行 | ユーザー要件3（併願パターン） |
| RESIDENCE_FLOW | +2,500行 | ユーザー要件4（居住地フロー） |
| COMMUTE_TOLERANCE | +2,000行 | ユーザー要件5（通勤距離） |
| **追加合計** | **+14,000行** | **ユーザー要件に直結** |

### 最終的なデータ量

```
現在V3:   17,631行

削減:     -11,490行（RARITY、URGENCY、FLOW、COMPETITION）
追加:     +14,000行（PERSONA_MUNI + 5新機能）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
新V3:     20,141行（+14.2%増加）

維持するrow_type:
- SUMMARY: 944行
- AGE_GENDER: 4,231行
- GAP: 966行
- PERSONA_MUNI: 2,500行（新規）
- QUALIFICATION_DETAIL: 3,000行（新規）
- EDUCATION_DETAIL: 2,000行（新規）
- DESIRED_AREA_PATTERN: 2,000行（新規）
- RESIDENCE_FLOW: 2,500行（新規）
- COMMUTE_TOLERANCE: 2,000行（新規）
```

**評価**:
- ✅ **データ量増加は最小限**: +14.2%（前提案は+41.6%）
- ✅ **ビジネス価値最大化**: ユーザーの5つの質問すべてに回答可能
- ✅ **タブ数削減**: 7タブ → 4タブ（使いやすさ向上）
- ✅ **無駄なデータ削除**: -11,490行（抽象的スコアリング削除）

---

## 実装優先度と工数見積もり

### フェーズ1: データ生成（優先度: 🔴 最高）

**タスク1.1: PERSONA_MUNIデータ生成**
- **元データ**: Phase 3 `PersonaSummaryByMunicipality.csv`
- **推定行数**: +2,500行
- **工数**: 4時間

**タスク1.2: 5つの新row_type生成**
- **QUALIFICATION_DETAIL**: Phase 1の資格データから生成
- **EDUCATION_DETAIL**: Phase 8の学歴データから生成
- **DESIRED_AREA_PATTERN**: Phase 1の希望地データから併願分析
- **RESIDENCE_FLOW**: Phase 1の居住地データから流入分析
- **COMMUTE_TOLERANCE**: Phase 1の通勤距離データから許容度集計
- **推定行数合計**: +11,500行
- **工数**: 16時間（各3-4時間）

**タスク1.3: 不要なrow_type削除**
- **削除対象**: RARITY, URGENCY_AGE, URGENCY_EMPLOYMENT, FLOW, COMPETITION
- **削減行数**: -11,490行
- **工数**: 2時間

**タスク1.4: V3再生成とテスト**
- **実行**: `python generate_mapcomplete_complete_sheets_v4.py`（新スクリプト）
- **検証**: 行数確認、データ品質チェック
- **工数**: 2時間

**フェーズ1合計工数**: 24時間（約3日）

---

### フェーズ2: UI実装（優先度: 🟡 高）

**タスク2.1: タブ1「市場概況」実装**
- **変更箇所**: `page_overview()`
- **工数**: 2時間

**タスク2.2: タブ2「人材属性」実装**
- **セクション2-1**: ペルソナ分析（5グラフ）
- **セクション2-2**: 資格詳細分析（5グラフ）🆕
- **セクション2-3**: 学歴詳細分析（4グラフ）🆕
- **新規関数**: 約15個
- **工数**: 10時間

**タスク2.3: タブ3「地域・移動パターン」実装**
- **セクション3-1**: 複数希望地パターン（3グラフ）🆕
- **セクション3-2**: 居住地→希望地フロー（4グラフ）🆕
- **セクション3-3**: 通勤距離許容度（4グラフ）🆕
- **新規関数**: 約11個
- **工数**: 8時間

**タスク2.4: タブ4「需給バランス」実装**
- **変更**: なし（既存維持）
- **工数**: 0時間

**タスク2.5: メインページのタブ構成変更**
- **変更**: 7タブ → 4タブ
- **工数**: 1時間

**フェーズ2合計工数**: 21時間（約2.5日）

---

### フェーズ3: テスト・品質保証（優先度: 🟡 高）

**タスク3.1: ユニットテスト**
- **新規関数テスト**: 26個
- **工数**: 6時間

**タスク3.2: E2Eテスト**
- **4タブ全体テスト**: データロード、フィルタ動作
- **工数**: 3時間

**タスク3.3: ブラウザ実機テスト**
- **実際のユーザーフロー**: CSV → 全タブ確認
- **工数**: 2時間

**タスク3.4: Pylintチェック**
- **基準**: スコア8.0以上
- **工数**: 1時間

**フェーズ3合計工数**: 12時間（約1.5日）

---

## 総合工数見積もり

| フェーズ | 内容 | 工数 | 優先度 |
|---------|------|------|--------|
| フェーズ1 | データ生成（6 row_types追加、5 row_types削除） | 24時間（3日） | 🔴 最高 |
| フェーズ2 | UI実装（4タブ構築） | 21時間（2.5日） | 🟡 高 |
| フェーズ3 | テスト・品質保証 | 12時間（1.5日） | 🟡 高 |
| **合計** | **全フェーズ** | **57時間（約7日）** | - |

---

## 新しい4タブでできること

### ユーザーの5つの質問への回答

| 質問 | 対応タブ | 対応グラフ | 使用row_type |
|------|---------|-----------|-------------|
| **1. 資格は？** | タブ2（人材属性） | 資格×年齢×性別クロス、資格TOP10 | QUALIFICATION_DETAIL |
| **2. 学歴は？** | タブ2（人材属性） | 学歴×年齢×性別クロス、学歴分布 | EDUCATION_DETAIL |
| **3. 併願は？** | タブ3（地域・移動） | 併願TOP10、併願マトリクス | DESIRED_AREA_PATTERN |
| **4. 居住地は？** | タブ3（地域・移動） | 流入元TOP10、流入マトリクス | RESIDENCE_FLOW |
| **5. 通勤距離は？** | タブ3（地域・移動） | 許容距離×年齢×性別クロス | COMMUTE_TOLERANCE |

### ビジネスシーン例

**シーン1: 京都市で介護福祉士を採用したい**

```
タブ1（市場概況）:
→ 「京都市の総申請者数: 1,234人」

タブ2（人材属性）:
→ セクション2-2（資格詳細）:
  「介護福祉士: 345人」
  「年齢層: 30-34歳が最多（123人）」
  「性別: 女性78%」
  「就業状況: 就業中65%、離職中35%」

→ セクション2-3（学歴詳細）:
  「専門学校卒: 54%」
  「大学卒: 28%」

→ セクション2-1（ペルソナ）:
  「就業中×介護福祉士×30代: 67人」

タブ3（地域・移動）:
→ セクション3-2（居住地フロー）:
  「大阪市から67人、神戸市から45人が京都市を希望」

→ セクション3-3（通勤距離）:
  「30代女性の80%は10km以内を希望」
  「離職中の人は20km以上もOKが40%」

タブ4（需給バランス）:
→ 「京都市は人材不足ランキング3位」
  「需給比率: 0.45（供給不足）」
```

**意思決定**:
- ✅ **ターゲット明確**: 30代女性、介護福祉士、専門学校卒、通勤10km以内
- ✅ **採用戦略**: 大阪市・神戸市からの流入を狙う、通勤手当充実
- ✅ **緊急度**: 需給比率0.45で人材不足、早急な採用活動が必要

---

## V1との比較

### V1（前提案）の問題点

| 項目 | V1 | 問題 |
|------|----|----|
| タブ数 | 5タブ | 希少人材・緊急度タブが不要 |
| データ量 | +41.6%増加 | 増加が大きい |
| ビジネス価値 | 抽象的スコアリング多数 | ユーザー要件に非対応 |
| 工数 | 41時間（5日） | - |

### V2（新提案）の改善点

| 項目 | V2 | 改善 |
|------|----|----|
| タブ数 | 4タブ | ✅ 1タブ削減（使いやすさ向上） |
| データ量 | +14.2%増加 | ✅ 増加率を1/3に削減 |
| ビジネス価値 | ユーザーの5質問すべてに対応 | ✅ ビジネスニーズに直結 |
| 工数 | 57時間（7日） | ⚠️ +2日増（新機能実装のため） |

---

## リスクと対策

### リスク1: 元データに必要な情報がない

**懸念**: 通勤距離許容度や併願パターンが元CSVにない可能性

**対策**:
1. **事前検証**: 元CSV（results_*.csv）のカラム確認
2. **代替案**: データがない場合は該当セクションをスキップ
3. **段階的実装**: データがあるものから優先実装

**検証コマンド**:
```bash
# 元CSVのカラム確認
head -1 C:\Users\fuji1\OneDrive\Pythonスクリプト保管\out\results_20251027_180947.csv
```

### リスク2: データ生成の複雑度が高い

**懸念**: 5つの新row_type生成が複雑で、バグが混入しやすい

**対策**:
1. **1つずつ実装**: 優先順位をつけて段階的実装
2. **ユニットテスト**: 各row_type生成関数に対してテスト作成
3. **データ検証**: 生成後に異常値チェック（NULL、負の値など）

**優先順位**:
1. PERSONA_MUNI（既存データから生成可能）← 最優先
2. QUALIFICATION_DETAIL（元データに資格カラムがある）
3. EDUCATION_DETAIL（Phase 8データ利用）
4. RESIDENCE_FLOW（元データに居住地カラムがある）
5. DESIRED_AREA_PATTERN（複数希望地の抽出が必要）
6. COMMUTE_TOLERANCE（通勤距離計算が必要）

### リスク3: 工数が予定より増える

**懸念**: 57時間（7日）が楽観的すぎる可能性

**対策**:
1. **バッファ追加**: 実工数×1.5倍を見込む（約10日）
2. **MVP実装**: 最初は主要グラフのみ実装（80%ルール）
3. **段階的リリース**: タブごとにリリース（タブ2 → タブ3 → 統合）

---

## 成功基準

### 定量的基準

1. **タブ数削減**: 7タブ → 4タブ ✅
2. **データ量増加**: +14.2%（2万行以下を維持）✅
3. **ユーザー質問対応率**: 5/5 = 100% ✅
4. **テスト成功率**: 100%
5. **Pylintスコア**: 8.0以上

### 定性的基準

1. **ビジネス価値**: ユーザーの5つの質問すべてに回答可能
2. **使いやすさ**: 4タブで直感的なナビゲーション
3. **具体性**: 抽象的スコアではなく、具体的な人材属性
4. **意思決定支援**: 「どの地域にどのような人がいるのか」が明確

---

## 次のステップ

### ステップ1: ユーザー確認

以下を確認：
- [ ] 4タブ構成（市場概況、人材属性、地域・移動、需給バランス）に同意
- [ ] 5つの新機能（資格、学歴、併願、居住地フロー、通勤距離）が要件を満たしているか
- [ ] 希少人材・緊急度タブ削除に同意
- [ ] データ量+14.2%増加を許容
- [ ] 工数7-10日を承認

### ステップ2: 元データ検証

**最優先タスク**: 元CSVに必要なカラムがあるか確認
- [ ] 資格カラム存在確認
- [ ] 学歴カラム存在確認
- [ ] 希望地（複数）カラム存在確認
- [ ] 居住地カラム存在確認
- [ ] 通勤距離カラム存在確認

### ステップ3: 段階的実装開始

**フェーズ1-1**: PERSONA_MUNIデータ生成（最優先）
**フェーズ1-2**: QUALIFICATION_DETAIL生成（次優先）
**フェーズ1-3**: 残り4つの新row_type生成

---

## まとめ

**V2の強み**:
- ✅ **ユーザー中心**: 5つの質問すべてに回答
- ✅ **データ効率**: +14.2%増加（V1は+41.6%）
- ✅ **無駄削減**: 抽象的スコアリング削除（-11,490行）
- ✅ **使いやすさ**: 4タブで迷わない

**投資対効果**:
- **工数**: 7-10日
- **効果**: ユーザーのビジネスニーズに100%対応
- **ROI**: 非常に高い（ビジネス価値直結）

**推奨アクション**:
✅ **元データ検証を最優先で実施**（必要カラムの存在確認）
✅ **承認後、PERSONA_MUNI生成から開始**（段階的実装）
