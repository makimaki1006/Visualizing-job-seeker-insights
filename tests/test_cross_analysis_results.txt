
=== ユニットテスト開始 ===


=== 統合テスト開始 ===


=== E2Eテスト開始 ===


=== 回帰テスト開始 ===

Test 1: getAxisLabel()

Test 2: extractAxisValue()

Test 3: buildCrossMatrix()

Test 4: 資格パース処理

Test 5: 転職意欲スコア変換
Test 6: normalizePayload() + city.applicants配置

Test 7: getAllApplicantsForCity()

Test 8: executeCrossTabulation() フルフロー
Test 9: renderCross() → executeCrossTabulation() 完全フロー

Test 10: 資格バイネーム選択 E2Eフロー

Test 11: 複数軸パターンE2E
Test 12: Phase 12-14データ処理の回帰テスト

Test 13: 既存レンダリング関数の回帰テスト

Test 14: タブ切り替えの回帰テスト

Test 15: パフォーマンス回帰テスト

================================================================================
テスト結果サマリー
================================================================================

【ユニットテスト】
  成功: 34件 / 失敗: 0件 / 合計: 34件

  ✅ PASSED: getAxisLabel("age_bucket") = "年齢層" (expected: "年齢層")
  ✅ PASSED: getAxisLabel("gender") = "性別" (expected: "性別")
  ✅ PASSED: getAxisLabel("qual:介護福祉士") = "介護福祉士" (expected: "介護福祉士")
  ✅ PASSED: getAxisLabel("qual:看護師") = "看護師" (expected: "看護師")
  ✅ PASSED: getAxisLabel("unknown") = "unknown" (expected: "unknown")
  ✅ PASSED: extractAxisValue(applicant[1], "age_bucket") = "30代" (expected: "30代")
  ✅ PASSED: extractAxisValue(applicant[1], "gender") = "女性" (expected: "女性")
  ✅ PASSED: extractAxisValue(applicant[1], "qual:介護福祉士") = "あり" (expected: "あり")
  ✅ PASSED: extractAxisValue(applicant[1], "qual:看護師") = "なし" (expected: "なし")
  ✅ PASSED: extractAxisValue(applicant[1], "urgency_level") = "高" (expected: "高")
  ✅ PASSED: extractAxisValue(applicant[2], "urgency_level") = "最高" (expected: "最高")
  ✅ PASSED: extractAxisValue(applicant[3], "qual:看護師") = "あり" (expected: "あり")
  ✅ PASSED: extractAxisValue(applicant[4], "urgency_level") = "最高" (expected: "最高")
  ✅ PASSED: extractAxisValue(applicant[5], "urgency_level") = "中" (expected: "中")
  ✅ PASSED: rows.length = 2 (expected: 2)
  ✅ PASSED: cols.length = 3 (expected: 3)
  ✅ PASSED: matrix['女性']['30代'] = 2 (expected: 2)
  ✅ PASSED: matrix['女性']['50代'] = 1 (expected: 1)
  ✅ PASSED: matrix['男性']['30代'] = 1 (expected: 1)
  ✅ PASSED: "介護福祉士,自動車運転免許".includes("介護福祉士") = true (expected: true)
  ✅ PASSED: "介護福祉士,自動車運転免許".includes("看護師") = false (expected: false)
  ✅ PASSED: "看護師".includes("看護師") = true (expected: true)
  ✅ PASSED: "".includes("介護福祉士") = false (expected: false)
  ✅ PASSED: "介護職員初任者研修（旧ヘルパー2級）,自動車運転免許".includes("介護職員初任者研修（旧ヘルパー2級）") = true (expected: true)
  ✅ PASSED: convertUrgencyScore(10) = "最高" (expected: "最高")
  ✅ PASSED: convertUrgencyScore(8) = "最高" (expected: "最高")
  ✅ PASSED: convertUrgencyScore(7) = "高" (expected: "高")
  ✅ PASSED: convertUrgencyScore(6) = "高" (expected: "高")
  ✅ PASSED: convertUrgencyScore(5) = "中" (expected: "中")
  ✅ PASSED: convertUrgencyScore(4) = "中" (expected: "中")
  ✅ PASSED: convertUrgencyScore(3) = "低" (expected: "低")
  ✅ PASSED: convertUrgencyScore(0) = "低" (expected: "低")
  ✅ PASSED: convertUrgencyScore(null) = "不明" (expected: "不明")
  ✅ PASSED: convertUrgencyScore(undefined) = "不明" (expected: "不明")

【統合テスト】
  成功: 15件 / 失敗: 0件 / 合計: 15件

  ✅ PASSED: cities.length = 2 (expected: 2)
  ✅ PASSED: 京都府京都市伏見区の申請者数 = 4 (expected: 4)
  ✅ PASSED: 大阪府大阪市北区の申請者数 = 1 (expected: 1)
  ✅ PASSED: Case 1: applicants.length = 4 (expected: 4)
  ✅ PASSED: Case 2: applicants.length = 4 (expected: 4)
  ✅ PASSED: Case 3: applicants.length = 0 (expected: 0)
  ✅ PASSED: Test Case 1: rows includes '女性'
  ✅ PASSED: Test Case 1: rows includes '男性'
  ✅ PASSED: Test Case 1: cols includes '30代'
  ✅ PASSED: Test Case 1: matrix['女性']['30代'] = 1 (expected: 1)
  ✅ PASSED: Test Case 2: rows includes 'あり'
  ✅ PASSED: Test Case 2: rows includes 'なし'
  ✅ PASSED: Test Case 2: matrix['あり']['30代'] = 1 (expected: 1)
  ✅ PASSED: Test Case 3: rows includes '高'
  ✅ PASSED: Test Case 3: rows includes '最高'

【E2Eテスト】
  成功: 14件 / 失敗: 0件 / 合計: 14件

  ✅ PASSED: Step 1: データ取得成功 (4件)
  ✅ PASSED: Step 2: クロス集計実行成功 (rows: 2)
  ✅ PASSED: Step 2: クロス集計実行成功 (cols: 3)
  ✅ PASSED: Step 3: テーブル生成成功
  ✅ PASSED: Step 4: CSV生成成功 (36 bytes)
  ✅ PASSED: 介護福祉士 'あり' が存在
  ✅ PASSED: 介護福祉士 'なし' が存在
  ✅ PASSED: 介護福祉士あり×30代 = 1
  ✅ PASSED: 資格保有率計算成功: 25.0%
  ✅ PASSED: 年齢層×性別: クロス集計成功 (2×3)
  ✅ PASSED: 年齢層×就業状態: クロス集計成功 (3×3)
  ✅ PASSED: 性別×転職意欲: クロス集計成功 (3×2)
  ✅ PASSED: 年齢層×自動車運転免許: クロス集計成功 (1×3)
  ✅ PASSED: 年齢層×看護師: クロス集計成功 (2×3)

【回帰テスト】
  成功: 21件 / 失敗: 0件 / 合計: 21件

  ✅ PASSED: Phase 12: demand_count = 1748 (expected: 1748)
  ✅ PASSED: Phase 12: supply_count = 1200 (expected: 1200)
  ✅ PASSED: Phase 13: all_records.length = 1 (expected: 1)
  ✅ PASSED: Phase 14: total_applicants = 1748 (expected: 1748)
  ✅ PASSED: クロス分析: applicants.length = 4 (expected: 4)
  ✅ PASSED: renderGap(): demand_count = 1748 (expected: 1748)
  ✅ PASSED: renderGap(): supply_count = 1200 (expected: 1200)
  ✅ PASSED: renderGap(): gap = 548 (expected: 548)
  ✅ PASSED: renderGap(): city.applicantsが存在するがrenderGap()に影響しない
  ✅ PASSED: renderRarity(): all_records.length = 2 (expected: 2)
  ✅ PASSED: renderRarity(): city.applicantsが存在するがrenderRarity()に影響しない
  ✅ PASSED: renderCompetition(): total_applicants = 1748 (expected: 1748)
  ✅ PASSED: renderCompetition(): city.applicantsが存在するがrenderCompetition()に影響しない
  ✅ PASSED: タブ数 = 4 (expected: 4)
  ✅ PASSED: 'gap'タブが存在
  ✅ PASSED: 'rarity'タブが存在
  ✅ PASSED: 'competition'タブが存在
  ✅ PASSED: 'cross'タブが存在
  ✅ PASSED: 1,000件処理時間 = 1ms (expected: < 100ms)
  ✅ PASSED: 大量データ処理成功: rows.length = 2
  ✅ PASSED: 大量データ処理成功: cols.length = 4

================================================================================
総合結果: 84件成功 / 0件失敗 / 合計84件
成功率: 100.0%
================================================================================

✅ 全てのテストに成功しました！

=== JSON出力 ===

{
  "timestamp": "2025-11-03T02:18:08.648Z",
  "summary": {
    "total": 84,
    "passed": 84,
    "failed": 0,
    "success_rate": "100.0%"
  },
  "categories": [
    {
      "name": "ユニットテスト",
      "passed": 34,
      "failed": 0,
      "total": 34,
      "results": [
        "✅ PASSED: getAxisLabel(\"age_bucket\") = \"年齢層\" (expected: \"年齢層\")",
        "✅ PASSED: getAxisLabel(\"gender\") = \"性別\" (expected: \"性別\")",
        "✅ PASSED: getAxisLabel(\"qual:介護福祉士\") = \"介護福祉士\" (expected: \"介護福祉士\")",
        "✅ PASSED: getAxisLabel(\"qual:看護師\") = \"看護師\" (expected: \"看護師\")",
        "✅ PASSED: getAxisLabel(\"unknown\") = \"unknown\" (expected: \"unknown\")",
        "✅ PASSED: extractAxisValue(applicant[1], \"age_bucket\") = \"30代\" (expected: \"30代\")",
        "✅ PASSED: extractAxisValue(applicant[1], \"gender\") = \"女性\" (expected: \"女性\")",
        "✅ PASSED: extractAxisValue(applicant[1], \"qual:介護福祉士\") = \"あり\" (expected: \"あり\")",
        "✅ PASSED: extractAxisValue(applicant[1], \"qual:看護師\") = \"なし\" (expected: \"なし\")",
        "✅ PASSED: extractAxisValue(applicant[1], \"urgency_level\") = \"高\" (expected: \"高\")",
        "✅ PASSED: extractAxisValue(applicant[2], \"urgency_level\") = \"最高\" (expected: \"最高\")",
        "✅ PASSED: extractAxisValue(applicant[3], \"qual:看護師\") = \"あり\" (expected: \"あり\")",
        "✅ PASSED: extractAxisValue(applicant[4], \"urgency_level\") = \"最高\" (expected: \"最高\")",
        "✅ PASSED: extractAxisValue(applicant[5], \"urgency_level\") = \"中\" (expected: \"中\")",
        "✅ PASSED: rows.length = 2 (expected: 2)",
        "✅ PASSED: cols.length = 3 (expected: 3)",
        "✅ PASSED: matrix['女性']['30代'] = 2 (expected: 2)",
        "✅ PASSED: matrix['女性']['50代'] = 1 (expected: 1)",
        "✅ PASSED: matrix['男性']['30代'] = 1 (expected: 1)",
        "✅ PASSED: \"介護福祉士,自動車運転免許\".includes(\"介護福祉士\") = true (expected: true)",
        "✅ PASSED: \"介護福祉士,自動車運転免許\".includes(\"看護師\") = false (expected: false)",
        "✅ PASSED: \"看護師\".includes(\"看護師\") = true (expected: true)",
        "✅ PASSED: \"\".includes(\"介護福祉士\") = false (expected: false)",
        "✅ PASSED: \"介護職員初任者研修（旧ヘルパー2級）,自動車運転免許\".includes(\"介護職員初任者研修（旧ヘルパー2級）\") = true (expected: true)",
        "✅ PASSED: convertUrgencyScore(10) = \"最高\" (expected: \"最高\")",
        "✅ PASSED: convertUrgencyScore(8) = \"最高\" (expected: \"最高\")",
        "✅ PASSED: convertUrgencyScore(7) = \"高\" (expected: \"高\")",
        "✅ PASSED: convertUrgencyScore(6) = \"高\" (expected: \"高\")",
        "✅ PASSED: convertUrgencyScore(5) = \"中\" (expected: \"中\")",
        "✅ PASSED: convertUrgencyScore(4) = \"中\" (expected: \"中\")",
        "✅ PASSED: convertUrgencyScore(3) = \"低\" (expected: \"低\")",
        "✅ PASSED: convertUrgencyScore(0) = \"低\" (expected: \"低\")",
        "✅ PASSED: convertUrgencyScore(null) = \"不明\" (expected: \"不明\")",
        "✅ PASSED: convertUrgencyScore(undefined) = \"不明\" (expected: \"不明\")"
      ]
    },
    {
      "name": "統合テスト",
      "passed": 15,
      "failed": 0,
      "total": 15,
      "results": [
        "✅ PASSED: cities.length = 2 (expected: 2)",
        "✅ PASSED: 京都府京都市伏見区の申請者数 = 4 (expected: 4)",
        "✅ PASSED: 大阪府大阪市北区の申請者数 = 1 (expected: 1)",
        "✅ PASSED: Case 1: applicants.length = 4 (expected: 4)",
        "✅ PASSED: Case 2: applicants.length = 4 (expected: 4)",
        "✅ PASSED: Case 3: applicants.length = 0 (expected: 0)",
        "✅ PASSED: Test Case 1: rows includes '女性'",
        "✅ PASSED: Test Case 1: rows includes '男性'",
        "✅ PASSED: Test Case 1: cols includes '30代'",
        "✅ PASSED: Test Case 1: matrix['女性']['30代'] = 1 (expected: 1)",
        "✅ PASSED: Test Case 2: rows includes 'あり'",
        "✅ PASSED: Test Case 2: rows includes 'なし'",
        "✅ PASSED: Test Case 2: matrix['あり']['30代'] = 1 (expected: 1)",
        "✅ PASSED: Test Case 3: rows includes '高'",
        "✅ PASSED: Test Case 3: rows includes '最高'"
      ]
    },
    {
      "name": "E2Eテスト",
      "passed": 14,
      "failed": 0,
      "total": 14,
      "results": [
        "✅ PASSED: Step 1: データ取得成功 (4件)",
        "✅ PASSED: Step 2: クロス集計実行成功 (rows: 2)",
        "✅ PASSED: Step 2: クロス集計実行成功 (cols: 3)",
        "✅ PASSED: Step 3: テーブル生成成功",
        "✅ PASSED: Step 4: CSV生成成功 (36 bytes)",
        "✅ PASSED: 介護福祉士 'あり' が存在",
        "✅ PASSED: 介護福祉士 'なし' が存在",
        "✅ PASSED: 介護福祉士あり×30代 = 1",
        "✅ PASSED: 資格保有率計算成功: 25.0%",
        "✅ PASSED: 年齢層×性別: クロス集計成功 (2×3)",
        "✅ PASSED: 年齢層×就業状態: クロス集計成功 (3×3)",
        "✅ PASSED: 性別×転職意欲: クロス集計成功 (3×2)",
        "✅ PASSED: 年齢層×自動車運転免許: クロス集計成功 (1×3)",
        "✅ PASSED: 年齢層×看護師: クロス集計成功 (2×3)"
      ]
    },
    {
      "name": "回帰テスト",
      "passed": 21,
      "failed": 0,
      "total": 21,
      "results": [
        "✅ PASSED: Phase 12: demand_count = 1748 (expected: 1748)",
        "✅ PASSED: Phase 12: supply_count = 1200 (expected: 1200)",
        "✅ PASSED: Phase 13: all_records.length = 1 (expected: 1)",
        "✅ PASSED: Phase 14: total_applicants = 1748 (expected: 1748)",
        "✅ PASSED: クロス分析: applicants.length = 4 (expected: 4)",
        "✅ PASSED: renderGap(): demand_count = 1748 (expected: 1748)",
        "✅ PASSED: renderGap(): supply_count = 1200 (expected: 1200)",
        "✅ PASSED: renderGap(): gap = 548 (expected: 548)",
        "✅ PASSED: renderGap(): city.applicantsが存在するがrenderGap()に影響しない",
        "✅ PASSED: renderRarity(): all_records.length = 2 (expected: 2)",
        "✅ PASSED: renderRarity(): city.applicantsが存在するがrenderRarity()に影響しない",
        "✅ PASSED: renderCompetition(): total_applicants = 1748 (expected: 1748)",
        "✅ PASSED: renderCompetition(): city.applicantsが存在するがrenderCompetition()に影響しない",
        "✅ PASSED: タブ数 = 4 (expected: 4)",
        "✅ PASSED: 'gap'タブが存在",
        "✅ PASSED: 'rarity'タブが存在",
        "✅ PASSED: 'competition'タブが存在",
        "✅ PASSED: 'cross'タブが存在",
        "✅ PASSED: 1,000件処理時間 = 1ms (expected: < 100ms)",
        "✅ PASSED: 大量データ処理成功: rows.length = 2",
        "✅ PASSED: 大量データ処理成功: cols.length = 4"
      ]
    }
  ]
}
